
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "_source\auto_galleries\data\plot_5_drift_test.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download__source_auto_galleries_data_plot_5_drift_test.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr__source_auto_galleries_data_plot_5_drift_test.py:


========================================
Data Drift Test
========================================

.. GENERATED FROM PYTHON SOURCE LINES 9-10

Import modeva modules

.. GENERATED FROM PYTHON SOURCE LINES 10-13

.. code-block:: Python

    import numpy as np
    from modeva import DataSet








.. GENERATED FROM PYTHON SOURCE LINES 14-15

Load TaiwanCredit Dataset

.. GENERATED FROM PYTHON SOURCE LINES 15-19

.. code-block:: Python

    ds = DataSet()
    ds.load("TaiwanCredit")
    ds.set_random_split()








.. GENERATED FROM PYTHON SOURCE LINES 20-21

Test data drift between train and test sets

.. GENERATED FROM PYTHON SOURCE LINES 21-26

.. code-block:: Python

    results = ds.data_drift_test(dataset1="train",
                                 dataset2="test",
                                 distance_metric='PSI')
    results.plot("summary")






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

                <!DOCTYPE html>
                <html lang="en" style="height: 100%">
                <head>
                <meta charset="utf-8">
                </head>
                <body style="height: 100%; margin: 0">

            
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts-gl/2.0.8/echarts-gl.min.js"></script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>
                <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"></script>
            
                <div id="1737119429.350691" style="height: 600px; width: 600px; overflow: auto"></div>
            
                <script type="text/javascript">
                var dom = document.getElementById('1737119429.350691');
                dom.innerHTML = ""
                dom.setAttribute('_echarts_instance_', '')
                var myChart = echarts.init(dom, null, {
                    renderer: 'canvas',
                    useDirtyRect: false
                    });
                var app = {};

                var option;
        option = {"chart_id": "1737119429.350691", "link_id": null, "figname": "", "title": {"show": true, "text": "PSI", "link": "", "target": "blank", "textStyle": {"fontStyle": "normal", "fontWeight": "bolder", "fontFamily": "sans-serif", "fontSize": 15, "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "subtext": "", "sublink": "", "subtarget": "blank", "textAlign": "center", "textVerticalAlign": "auto", "padding": 0, "itemGap": 10, "z": 2, "left": "50.0%", "top": "5%", "right": "auto", "bottom": "auto", "backgroundColor": "transparent", "borderColor": "#ccc", "changed_name_key": {"id_": "id"}}, "grid": {"show": true, "width": "auto", "height": "auto", "z": 2, "left": "5%", "top": "10%", "right": "10%", "bottom": "5%", "borderColor": "#ccc", "borderWidth": 1, "containLabel": true, "backgroundColor": "transparent", "changed_name_key": {"id_": "id"}}, "legend": null, "brush": null, "yAxis": [{"show": true, "data": ["FlagDefault", "EDUCATION", "MARRIAGE", "PAY_AMT4", "SEX", "PAY_AMT6", "BILL_AMT2", "BILL_AMT3", "BILL_AMT6", "BILL_AMT4", "PAY_AMT1", "LIMIT_BAL", "PAY_AMT2", "PAY_3", "BILL_AMT1", "AGE", "PAY_2", "PAY_5", "PAY_AMT5", "PAY_4", "PAY_1", "PAY_AMT3", "BILL_AMT5", "PAY_6"], "type": "category", "position": "bottom", "name": "", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": "auto", "splitNumber": 5, "logBase": 10, "axisLine": {"show": false}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": true, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": 40.0}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "xAxis": [{"show": true, "type": "value", "position": "bottom", "name": "", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": 30, "min": -0.0007593, "max": 0.004135, "splitNumber": 5, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": null}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "parallelAxis": null, "series": [{"type": "bar", "colorBy": "series", "z": 2, "legendHoverLink": true, "stack": "", "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "label": {"show": false, "color": "black", "position": null, "fontSize": 12}, "itemStyle": {}, "seriesLayoutBy": "column", "data": [{"value": [0.00023121423632887995, "FlagDefault"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.00032923840118432126, "EDUCATION"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0004882856863935958, "MARRIAGE"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0006424532314061337, "PAY_AMT4"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0006908050596517038, "SEX"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0007579573697916724, "PAY_AMT6"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.000900883389955219, "BILL_AMT2"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.000939344986379882, "BILL_AMT3"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0011966959984206537, "BILL_AMT6"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.001493654985399232, "BILL_AMT4"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0015319912416776548, "PAY_AMT1"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0015622409967131134, "LIMIT_BAL"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0015756509947512647, "PAY_AMT2"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0015901961409447764, "PAY_3"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0017796224398125074, "BILL_AMT1"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0018640222652642723, "AGE"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0019584099157602883, "PAY_2"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0020533001016404227, "PAY_5"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.002209515151632732, "PAY_AMT5"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0023451731436740205, "PAY_4"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0026559496235309685, "PAY_1"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.002749477027815062, "PAY_AMT3"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0030751853859310773, "BILL_AMT5"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.003144331780671541, "PAY_6"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "#1f77b4", "coordinateSystem": "cartesian2d", "showBackground": true, "backgroundStyle": {"color": "rgba(180, 180, 180, 0.2)"}, "barWidth": "90%", "barGap": "0", "barCategoryGap": "20%", "largeThreshold": 400, "progressive": 5000, "progressiveThreshold": 3000, "progressiveChunkMode": "mod", "orient": "horizontal", "x_value": ["FlagDefault", "EDUCATION", "MARRIAGE", "PAY_AMT4", "SEX", "PAY_AMT6", "BILL_AMT2", "BILL_AMT3", "BILL_AMT6", "BILL_AMT4", "PAY_AMT1", "LIMIT_BAL", "PAY_AMT2", "PAY_3", "BILL_AMT1", "AGE", "PAY_2", "PAY_5", "PAY_AMT5", "PAY_4", "PAY_1", "PAY_AMT3", "BILL_AMT5", "PAY_6"], "tooltip_type": "axis", "hist": false, "data_value": [["FlagDefault", "0.00023121423632887995"], ["EDUCATION", "0.00032923840118432126"], ["MARRIAGE", "0.0004882856863935958"], ["PAY_AMT4", "0.0006424532314061337"], ["SEX", "0.0006908050596517038"], ["PAY_AMT6", "0.0007579573697916724"], ["BILL_AMT2", "0.000900883389955219"], ["BILL_AMT3", "0.000939344986379882"], ["BILL_AMT6", "0.0011966959984206537"], ["BILL_AMT4", "0.001493654985399232"], ["PAY_AMT1", "0.0015319912416776548"], ["LIMIT_BAL", "0.0015622409967131134"], ["PAY_AMT2", "0.0015756509947512647"], ["PAY_3", "0.0015901961409447764"], ["BILL_AMT1", "0.0017796224398125074"], ["AGE", "0.0018640222652642723"], ["PAY_2", "0.0019584099157602883"], ["PAY_5", "0.0020533001016404227"], ["PAY_AMT5", "0.002209515151632732"], ["PAY_4", "0.0023451731436740205"], ["PAY_1", "0.0026559496235309685"], ["PAY_AMT3", "0.002749477027815062"], ["BILL_AMT5", "0.0030751853859310773"], ["PAY_6", "0.003144331780671541"]]}], "visualMap": null, "toolbox": {"show": true, "orient": "horizontal", "itemSize": 15, "itemGap": 8, "showTitle": true, "feature": {"dataZoom": {}, "saveAsImage": {}}, "z": 2, "left": "auto", "top": "auto", "right": "1%", "bottom": "auto", "width": "auto", "height": "auto", "popup": true, "changed_name_key": {"id_": "id"}}, "tooltip": {"show": true, "custom_tooltip": false, "trigger": "item", "axisPointer": {"show": true}, "showContent": true, "triggerOn": "mousemove|click", "hideDelay": 100, "enterable": true, "renderMode": "html", "confine": true, "transitionDuration": 0.4, "precision": 4, "borderColor": "#333", "padding": 5, "order": "seriesAsc"}, "dataZoom": null, "event": null, "graphic": null, "radar": null, "figsize": {"width": 600, "height": 600}, "color": ["#1f77b4", "#aec7e8", "#ff7f0e", "#ffbb78", "#2ca02c", "#98df8a", "#d62728", "#ff9896", "#9467bd", "#c5b0d5", "#8c564b", "#c49c94", "#e377c2", "#f7b6d2", "#7f7f7f", "#c7c7c7", "#bcbd22", "#dbdb8d", "#17becf", "#9edae5"], "save_img": false, "auto_size": true, "style": {"overflow": "auto"}, "port": "5006"};function setInnerHTML(elm, html) {
      elm.innerHTML = html;
  
      Array.from(elm.querySelectorAll("script"))
        .forEach( oldScriptEl => {
          const newScriptEl = document.createElement("script");
      
          Array.from(oldScriptEl.attributes).forEach( attr => {
            newScriptEl.setAttribute(attr.name, attr.value) 
          });
      
          const scriptText = document.createTextNode(oldScriptEl.innerHTML);
          newScriptEl.appendChild(scriptText);
      
          oldScriptEl.parentNode.replaceChild(newScriptEl, oldScriptEl);
      });
    };

    function getScreenSize(option) {
      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_result_save', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'height': screen.height, 'width': screen.width},
                                  'event_id': 'screen_size'})
          });
          fetch(testRequest).then(response => {});
      return 
    }
    function support_scientific_notation(option) {
      if (Array.isArray(option['yAxis'])) {
        for (var tar_ind = 0; tar_ind < option['yAxis'].length; tar_ind++) {
          if (option['yAxis'][tar_ind]['type'] === 'value') {
            option['yAxis'][tar_ind]['axisLabel']['formatter'] = function(val) {
              const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                        '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                        '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
              function toSuperscript(val) {
                if (val.toString().length > 5 && !val.toString().includes('.')) {
                  val = Number(val).toExponential().toString();
                  if (val.includes('-')) {
                    val = val.split('-');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁻' + val1
                  }
                  else if (val.includes('+')) {
                    val = val.split('+');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁺' + val1
                  }
                }
                else {
                  return val
                }
              }
              return toSuperscript(val)
            }
          }
        }
      }
      else {
        if (option['yAxis']['type'] === 'value') {
          option['yAxis']['axisLabel']['formatter'] = function(val) {
            const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                    '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                    '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
            function toSuperscript(val) {
              if (val.toString().length > 5 && !val.toString().includes('.')) {
                val = Number(val).toExponential().toString();
                if (val.includes('-')) {
                  val = val.split('-');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁻' + val1
                }
                else if (val.includes('+')) {
                  val = val.split('+');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁺' + val1
                }
              }
              else {
                return val
              }
            }
            return toSuperscript(val)
          }
        }
      };
      return option;
    };

    function auto_component_size(option) {
      if (typeof option['figsize']['width'] === 'string' || option['figsize']['width'] instanceof String) {
        if (option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['width'].includes('px')) {
          var width = parseFloat(option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = option['figsize']['width']
      }

      if (typeof option['figsize']['height'] === 'string' || option['figsize']['height'] instanceof String) {
        if (option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['height'].includes('px')) {
          var height = parseFloat(option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height']
      }

      var relative_ratio = Math.min(width / 700, height / 400)
      if ('xAxis3D' in option) {
        var keys = ['xAxis3D', 'yAxis3D', 'zAxis3D']
      }
      else {
        var keys = ['xAxis', 'yAxis']
      }
      for (single_key of keys) {
        for (var ind = 0; ind < option[single_key].length; ind++) {
          option[single_key][ind]['nameTextStyle']['fontSize'] = Math.max(7, option[single_key][ind]['nameTextStyle']['fontSize'] * relative_ratio);
          option[single_key][ind]['axisLabel']['fontSize'] = Math.max(7, option[single_key][ind]['axisLabel']['fontSize'] * relative_ratio);
        }
      }
      if (option['series']) {
        for (var ind = 0; ind < option['series'].length; ind++) {
          if (['heatmap', 'bar'].includes(option['series'][ind]['type'])) {
            if (option['series'][ind]['label']) {
              option['series'][ind]['label']['fontSize'] = Math.max(7, option['series'][ind]['label']['fontSize'] * relative_ratio);
            }
          }
        }
      }
      if (option['title']) {
        if (Array.isArray(option['title'])) {
          for (var ind = 0; ind < option['title'].length; ind++) {
            option['title'][ind]['textStyle']['fontSize'] = Math.max(9, option['title'][ind]['textStyle']['fontSize'] * relative_ratio);
          }
        }
        else {
          option['title']['textStyle']['fontSize'] = Math.max(9, option['title']['textStyle']['fontSize'] * relative_ratio);
        }
      }
      if (option['legend']) {
        option['legend']['itemHeight'] = option['legend']['itemHeight'] * relative_ratio;
        option['legend']['itemWidth'] = option['legend']['itemWidth'] * relative_ratio;
        option['legend']['textStyle']['fontSize'] = Math.max(7, option['legend']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['visualMap']) {
        option['visualMap']['itemHeight'] = option['visualMap']['itemHeight'] * relative_ratio;
        option['visualMap']['itemWidth'] = option['visualMap']['itemWidth'] * relative_ratio;
        option['visualMap']['textStyle']['fontSize'] = Math.max(7, option['visualMap']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['toolbox']) {
        option['toolbox']['itemSize'] = Math.max(8, option['toolbox']['itemSize'] * relative_ratio)
        option['toolbox']['itemGap'] = Math.max(4, option['toolbox']['itemGap'] * relative_ratio);
      }
      if (option['graphic']) {
        for (var ind = 0; ind < option['graphic'].length; ind++) {
          for (var ind2 = 0; ind2 < option['graphic'][ind]['children'].length; ind2++) {
            var new_font = Math.max(7, 12 * relative_ratio);
            option['graphic'][ind]['children'][ind2]['style']['font'] = new_font.toString() + 'px Microsoft YaHei';
          }
        }
      }
      return option;
    }

    function save_img(echarts_instance, option) {
      const base64_str = echarts_instance.getDataURL({
          pixelRatio: 2,
          backgroundColor: '#fff',
          width: option['figsize']['width'],
          height: option['figsize']['height']
      });

      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_image_save', {
        method: 'post',
        headers: {
          'Content-Type': 'application/json;charset=utf-8;',
          'Access-Control-Allow-Origin':'*',
          'Access-Control-Allow-Credentials': 'true',
          'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
        },
        body: JSON.stringify({'figname': option['figname'],
                              'base64_str': base64_str})
      });
      fetch(testRequest).then(response => {});
    };


    function auto_axis_namegap(echarts_instance, auto_axis_list, axis_type) {
      const globalModel = echarts_instance._api.getModel()
      const figsize = globalModel.option.figsize
      const ctx = document.createElement('canvas').getContext('2d')
      if (typeof globalModel.option['figsize']['width'] === 'string' || globalModel.option['figsize']['width'] instanceof String) {
        if (globalModel.option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(globalModel.option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['width'].includes('px')) {
          var width = parseFloat(globalModel.option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = globalModel.option['figsize']['width'];
      }

      if (typeof globalModel.option['figsize']['height'] === 'string' || globalModel.option['figsize']['height'] instanceof String) {
        if (globalModel.option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(globalModel.option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['height'].includes('px')) {
          var height = parseFloat(globalModel.option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height'];
      }
      var relative_ratio = Math.min(width / 700, height / 400);
      if (axis_type==='2d') {
        const yAxisList = globalModel.option.yAxis
        const xAxisList = globalModel.option.xAxis

        for (var axis_idx of auto_axis_list) {
          const yAxis = yAxisList[axis_idx]
          const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
          const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
          ctx.save()
          ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
  
          const yAxisComponent = globalModel.getComponent('yAxis', axis_idx)?.axis
          if (yAxis.type === 'value') {
            var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
          }
          else {
            var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
          }
          var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
          axisLabelMargin = axisLabelMargin * relative_ratio
          yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
          ctx.restore()
        };
  
        for (var axis_idx of [...Array(xAxisList.length).keys()]) {
          var new_gap = Math.max(xAxisList[axis_idx].nameGap * relative_ratio, 12);
          if (figsize['height'] < 400) {
            new_gap = Math.min(20, new_gap);
          }
          xAxisList[axis_idx].nameGap = new_gap;
        }
  
        echarts_instance.setOption({
          yAxis: yAxisList,
          xAxis: xAxisList
        })
      }
      else {
        const yAxisList = globalModel.option.yAxis3D
        const xAxisList = globalModel.option.xAxis3D
        const zAxisList = globalModel.option.zAxis3D

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < xAxisList.length) {
            const xAxis = xAxisList[axis_idx]
            const fontSize = xAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = xAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const xAxisComponent = globalModel.getComponent('xAxis3D', axis_idx)?.axis
            if (xAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = xAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            xAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < yAxisList.length) {
            const yAxis = yAxisList[axis_idx]
            const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const yAxisComponent = globalModel.getComponent('yAxis3D', axis_idx)?.axis
            if (yAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < zAxisList.length) {
            const zAxis = zAxisList[axis_idx]
            const fontSize = zAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = zAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const zAxisComponent = globalModel.getComponent('zAxis3D', axis_idx)?.axis
            if (zAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = zAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            zAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };
        echarts_instance.setOption({
          yAxis3D: yAxisList,
          xAxis3D: xAxisList,
          zAxis3D: zAxisList
        });
        }
  
    };

    function custom_scatter_size(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['symbolSize'] === 'array_size') {
          var ind_ = option['series'][ind]['data_dict']['size']
          option['series'][ind]['symbolSize'] = function (data) {return data[ind_];}
        }
      }
      return option;
  
    };

    function show_scatter_label(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['label'] === 'show_label') {
          var ind_ = option['series'][ind]['data_dict']['label']
          option['series'][ind]['label'] = {
            show: true,
            formatter: function (params) {return params.data.value[ind_]; }
          }
        }
      }
      return option;
    };

    function hide_min_max_axis_label(option) {
      for (var ind = 0; ind < option['xAxis3D'].length; ind++) {
        if (option['xAxis3D'][ind]['type'] == 'value') {
          var x_min = option['xAxis3D'][ind]['min']
          var x_max = option['xAxis3D'][ind]['max']
          option['xAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==x_min || value==x_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['yAxis3D'].length; ind++) {
        if (option['yAxis3D'][ind]['type'] == 'value') {  
          var y_min = option['yAxis3D'][ind]['min']
          var y_max = option['yAxis3D'][ind]['max']
          option['yAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==y_min || value==y_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['zAxis3D'].length; ind++) {
        if (option['zAxis3D'][ind]['type'] == 'value') {
          var z_min = option['zAxis3D'][ind]['min']
          var z_max = option['zAxis3D'][ind]['max']
          option['zAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==z_min || value==z_max){}
            else {return value}
          }
       }
      }
      return option;
    }

    function custom_axis_label(option) {
      if (Array.isArray(option['xAxis'])) {
        for (var ind = 0; ind < option['xAxis'].length; ind++) {
          if (option['xAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['xAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['xAxis'][ind]['axisLabel']['formatter_func'].body)
            option['xAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['xAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['xAxis']['axisLabel']['formatter_func'].arguments,
                               option['xAxis']['axisLabel']['formatter_func'].body)
          option['xAxis']['axisLabel']['formatter'] = f
        }
      }
      if (Array.isArray(option['yAxis'])) {
        for (var ind = 0; ind < option['yAxis'].length; ind++) {
          if (option['yAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['yAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['yAxis'][ind]['axisLabel']['formatter_func'].body)
            option['yAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['yAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['yAxis']['axisLabel']['formatter_func'].arguments,
                               option['yAxis']['axisLabel']['formatter_func'].body)
          option['yAxis']['axisLabel']['formatter'] = f
        }
      }
      return option;
    }

    function custom_tooltip(option, dimension=2) {

      if (dimension === 2) {
        var xaxis_key = 'xAxis'
        var yaxis_key = 'yAxis'
      }

      else if (dimension === 3) {
        var xaxis_key = 'xAxis3D'
        var yaxis_key = 'yAxis3D'
        var zaxis_key = 'zAxis3D'
      }

      if (option['radar']) {
        var radar_names = []
        for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
          radar_names.push(option['radar']['indicator'][ind_]['name']) 
        }
      }
  
  
      if (option[xaxis_key]['name'] !== null && option[xaxis_key]['name'] !== '' && Array.isArray(option[xaxis_key])!==true) {
        var xaxis_name = option[xaxis_key]['name'];
      }
      else {
        var xaxis_name = 'X';
      }

      if (option[yaxis_key]['name'] !== null && option[yaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
        var yaxis_name = option[yaxis_key]['name'];
      }
      else {
        var yaxis_name = 'Y';
      }

      if (typeof zaxis_key !== 'undefined') {
        if (option[zaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
          var zaxis_name = option[zaxis_key]['name'];
        }
        else {
          var zaxis_name = 'Z';
        }
      }
  
      if (option['tooltip']) {
        if (option['tooltip']['precision']) {
          var precision = option['tooltip']['precision']
          option['tooltip']['valueFormatter'] = (value) =>  Math.round(Number(value) * (10**precision)) / (10**precision)
        }

        for (var ind_ = 0; ind_ < option['series'].length; ind_++) {
          if (option['series'][ind_]['tooltip']) {
            if (option['series'][ind_]['tooltip']['precision']) {
              var precision = option['series'][ind_]['tooltip']['precision']
              const fix = precision_ => value => Math.round(Number(value) * (10**precision_)) / (10**precision_),
              fix_p = fix(precision);
              option['series'][ind_]['tooltip']['valueFormatter'] = function (value) {
                return fix_p(value)
              } 
            }
          }
        }

        if (option['series'].length === 1) {
          if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][0]['type'])) {
            option['tooltip']['formatter'] = function(params) {
              if (params.seriesName.includes('series')) {
                var series_name = ''
              }
          
              else {
                var series_name = params.seriesName + '<br>'
              }
      
              if (params.seriesType === 'scatter') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                  + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                  +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                }
            
              }
  
              else if (params.seriesType === 'heatmap') {
                formatter = params.name + ', ' + option['yAxis'][0]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
              }
      
              else if (params.seriesType === 'scatter3D') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                    + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                    +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                    +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                }
              }
          
              else if (params.seriesType === 'radar') {
                formatter = params.name  + '<br>';
                for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                  if (ind_ !== option['radar']['indicator'].length - 1) {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                  }
                  else {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                  }
                }
              }
            return formatter;
            }
          }
        }
        else {
          for (var out_ind_ = 0; out_ind_ < option['series'].length; out_ind_++) {
            if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][out_ind_]['type'])) {
              if (option['series'][out_ind_]['tooltip']) {
              }
              else {
                option['series'][out_ind_]['tooltip'] = {}
              }
              option['series'][out_ind_]['tooltip']['formatter'] = function(params) {
                if (params.seriesName.includes('series')) {
                  var series_name = ''
                }
            
                else {
                  var series_name = params.seriesName + '<br>'
                }
        
                if (params.seriesType === 'scatter') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                  }
                }
    
                else if (params.seriesType === 'heatmap') {
                  if ('data' in option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]) {
                    formatter = params.name + ', ' + option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
                  }
                  else {
                    formatter = Math.round(params.data[2] * 10000) / 10000
                  }
                
                }
        
                else if (params.seriesType === 'scatter3D') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                      +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                  }
                }
            
                else if (params.seriesType === 'radar') {
                  formatter = params.name  + '<br>';
                  for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                    if (ind_ !== option['radar']['indicator'].length - 1) {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                    }
                    else {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                    }
                  }
                }
              return formatter;
              }
            }
          }
        }
      }
      return option;
    };

    function support_brush_event(option) {
      if (option['event']['type_'] === 'brushselected') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var last_selected = [];
        bind_chart.on(option['event']['type_'], (params) => {
          var brushed = [];
          var brushComponent = params.batch[0];
          for (var sIdx = 0; sIdx < brushComponent.selected.length; sIdx++) {
            var rawIndices = brushComponent.selected[sIdx].dataIndex;
            brushed.push(rawIndices);
          }
          var brushed_all = brushed[0];

          if (JSON.stringify(last_selected) !== JSON.stringify(brushed_all)) {

            // Update memory
            let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
              method: 'post',
              headers: {
                  'Content-Type': 'application/json;charset=utf-8;',
                  'Access-Control-Allow-Origin':'*',
                  'Access-Control-Allow-Credentials': 'true',
                  'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
              },
              body: JSON.stringify({'js_func_input':{'selected': brushed_all},
                                    'event_id': option['event']['event_id']})
            });
            var dom_dict = {}
            fetch(testRequest).then(response => {
              var result = response.json();
              result.then(res => {
                dom_dict[res['link_id']] = document.getElementById(res['link_id']);
                setInnerHTML(dom_dict[res['link_id']], res['html']);
              });
            });
            last_selected = brushed_all;
          }
                            
        // bind_chart.setOption(option);
        })
      }
      return option;
    };

    function support_click_event(option) {
      if (option['event']['type_'] === 'click') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        if (option['series'][0]['orient'] === 'vertical') {
          var value_idx = 0
        }
        else {
          var value_idx = 1
        }
    

        bind_chart.on(option['event']['type_'], (params) => {
          if (option['event']['task'] === 'singleselect') {
            for (var ind_2 = 0; ind_2 < option['series'][0]['data'].length; ind_2++) {
              if (option['series'][0]['data'][ind_2]['itemStyle']['color'] !== '#1f77b4') {
                option['series'][0]['data'][ind_2]['itemStyle']['color'] = '#1f77b4';
              }
            }
            var idx = option['series'][0]['x_value'].indexOf(params.value[value_idx])
            option['series'][0]['data'][idx]['itemStyle']['color'] = '#ff7f0e';

            var selected = params.value[value_idx];
          }
          else {
            console.log(params);
          }
      
          let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'selected': selected},
                                  'event_id': option['event']['event_id']})
          });
          var dom_dict = {}
          fetch(testRequest).then(response => {
            var result = response.json();
            result.then(res => {
              dom_dict[res['link_id']] = document.getElementById(res['link_id']);
              setInnerHTML(dom_dict[res['link_id']], res['html']);
            });
          });
          bind_chart.setOption(option);
        });
      }
      return option;
    };function support_popup(option, height, width, inner_html) {
      option['toolbox']['feature']['myFeature'] = {
        show: true,
        title: 'Open in new window',
        icon: 'image://http://127.0.0.1:5001/resources/popup_icon',
        onclick: function (){
          var height_ = Math.min(screen.height, Math.round(1.5 * parseInt(height.slice(0,-2))))
          var width_ = Math.min(screen.width, Math.round(1.5 * parseInt(width.slice(0,-2))))
          var left = (screen.width/2)-(width_/2);
          var top = (screen.height/2)-(height_/2);
          var win = window.open('template.html', '_blank',
            `height=${height_}px, width=${width_}px, top=${top}px, left=${left}px`,
          );
          win.document.write(`${inner_html}`);
          win.document.close();
        }
      };
      return option;
    };option = support_popup(option=option, height="600px", width="600px", inner_html=`

            <html lang="en" style="height: 100%; text-align: -webkit-center; align-content: center">
            <title>MoCharts</title>
            <head> <meta charset="utf-8"> </head>
            <body style="height: 100%; margin: 0">
        
        
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"><\/script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts-gl/2.0.8/echarts-gl.min.js"><\/script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"><\/script>
                <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"><\/script>
            

            <div id="1737119429.350691" style="height: 90%; width: 90%"></div>
            <script type="text/javascript">
                var dom = document.getElementById('1737119429.350691');
                var myChart = echarts.init(dom, null, {
                    renderer: 'canvas',
                    useDirtyRect: false
                    });
                var app = {};

                var option;
            option = {"chart_id": "1737119429.350691", "link_id": null, "figname": "", "title": {"show": true, "text": "PSI", "link": "", "target": "blank", "textStyle": {"fontStyle": "normal", "fontWeight": "bolder", "fontFamily": "sans-serif", "fontSize": 15, "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "subtext": "", "sublink": "", "subtarget": "blank", "textAlign": "center", "textVerticalAlign": "auto", "padding": 0, "itemGap": 10, "z": 2, "left": "50.0%", "top": "5%", "right": "auto", "bottom": "auto", "backgroundColor": "transparent", "borderColor": "#ccc", "changed_name_key": {"id_": "id"}}, "grid": {"show": true, "width": "auto", "height": "auto", "z": 2, "left": "5%", "top": "10%", "right": "10%", "bottom": "5%", "borderColor": "#ccc", "borderWidth": 1, "containLabel": true, "backgroundColor": "transparent", "changed_name_key": {"id_": "id"}}, "legend": null, "brush": null, "yAxis": [{"show": true, "data": ["FlagDefault", "EDUCATION", "MARRIAGE", "PAY_AMT4", "SEX", "PAY_AMT6", "BILL_AMT2", "BILL_AMT3", "BILL_AMT6", "BILL_AMT4", "PAY_AMT1", "LIMIT_BAL", "PAY_AMT2", "PAY_3", "BILL_AMT1", "AGE", "PAY_2", "PAY_5", "PAY_AMT5", "PAY_4", "PAY_1", "PAY_AMT3", "BILL_AMT5", "PAY_6"], "type": "category", "position": "bottom", "name": "", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": "auto", "splitNumber": 5, "logBase": 10, "axisLine": {"show": false}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": true, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": 40.0}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "xAxis": [{"show": true, "type": "value", "position": "bottom", "name": "", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": 30, "min": -0.0007593, "max": 0.004135, "splitNumber": 5, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": null}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "parallelAxis": null, "series": [{"type": "bar", "colorBy": "series", "z": 2, "legendHoverLink": true, "stack": "", "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "label": {"show": false, "color": "black", "position": null, "fontSize": 12}, "itemStyle": {}, "seriesLayoutBy": "column", "data": [{"value": [0.00023121423632887995, "FlagDefault"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.00032923840118432126, "EDUCATION"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0004882856863935958, "MARRIAGE"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0006424532314061337, "PAY_AMT4"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0006908050596517038, "SEX"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0007579573697916724, "PAY_AMT6"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.000900883389955219, "BILL_AMT2"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.000939344986379882, "BILL_AMT3"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0011966959984206537, "BILL_AMT6"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.001493654985399232, "BILL_AMT4"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0015319912416776548, "PAY_AMT1"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0015622409967131134, "LIMIT_BAL"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0015756509947512647, "PAY_AMT2"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0015901961409447764, "PAY_3"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0017796224398125074, "BILL_AMT1"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0018640222652642723, "AGE"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0019584099157602883, "PAY_2"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0020533001016404227, "PAY_5"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.002209515151632732, "PAY_AMT5"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0023451731436740205, "PAY_4"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0026559496235309685, "PAY_1"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.002749477027815062, "PAY_AMT3"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0030751853859310773, "BILL_AMT5"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.003144331780671541, "PAY_6"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "#1f77b4", "coordinateSystem": "cartesian2d", "showBackground": true, "backgroundStyle": {"color": "rgba(180, 180, 180, 0.2)"}, "barWidth": "90%", "barGap": "0", "barCategoryGap": "20%", "largeThreshold": 400, "progressive": 5000, "progressiveThreshold": 3000, "progressiveChunkMode": "mod", "orient": "horizontal", "x_value": ["FlagDefault", "EDUCATION", "MARRIAGE", "PAY_AMT4", "SEX", "PAY_AMT6", "BILL_AMT2", "BILL_AMT3", "BILL_AMT6", "BILL_AMT4", "PAY_AMT1", "LIMIT_BAL", "PAY_AMT2", "PAY_3", "BILL_AMT1", "AGE", "PAY_2", "PAY_5", "PAY_AMT5", "PAY_4", "PAY_1", "PAY_AMT3", "BILL_AMT5", "PAY_6"], "tooltip_type": "axis", "hist": false, "data_value": [["FlagDefault", "0.00023121423632887995"], ["EDUCATION", "0.00032923840118432126"], ["MARRIAGE", "0.0004882856863935958"], ["PAY_AMT4", "0.0006424532314061337"], ["SEX", "0.0006908050596517038"], ["PAY_AMT6", "0.0007579573697916724"], ["BILL_AMT2", "0.000900883389955219"], ["BILL_AMT3", "0.000939344986379882"], ["BILL_AMT6", "0.0011966959984206537"], ["BILL_AMT4", "0.001493654985399232"], ["PAY_AMT1", "0.0015319912416776548"], ["LIMIT_BAL", "0.0015622409967131134"], ["PAY_AMT2", "0.0015756509947512647"], ["PAY_3", "0.0015901961409447764"], ["BILL_AMT1", "0.0017796224398125074"], ["AGE", "0.0018640222652642723"], ["PAY_2", "0.0019584099157602883"], ["PAY_5", "0.0020533001016404227"], ["PAY_AMT5", "0.002209515151632732"], ["PAY_4", "0.0023451731436740205"], ["PAY_1", "0.0026559496235309685"], ["PAY_AMT3", "0.002749477027815062"], ["BILL_AMT5", "0.0030751853859310773"], ["PAY_6", "0.003144331780671541"]]}], "visualMap": null, "toolbox": {"show": true, "orient": "horizontal", "itemSize": 15, "itemGap": 8, "showTitle": true, "feature": {"dataZoom": {}, "saveAsImage": {}}, "z": 2, "left": "auto", "top": "auto", "right": "1%", "bottom": "auto", "width": "auto", "height": "auto", "popup": true, "changed_name_key": {"id_": "id"}}, "tooltip": {"show": true, "custom_tooltip": false, "trigger": "item", "axisPointer": {"show": true}, "showContent": true, "triggerOn": "mousemove|click", "hideDelay": 100, "enterable": true, "renderMode": "html", "confine": true, "transitionDuration": 0.4, "precision": 4, "borderColor": "#333", "padding": 5, "order": "seriesAsc"}, "dataZoom": null, "event": null, "graphic": null, "radar": null, "figsize": {"width": 600, "height": 600}, "color": ["#1f77b4", "#aec7e8", "#ff7f0e", "#ffbb78", "#2ca02c", "#98df8a", "#d62728", "#ff9896", "#9467bd", "#c5b0d5", "#8c564b", "#c49c94", "#e377c2", "#f7b6d2", "#7f7f7f", "#c7c7c7", "#bcbd22", "#dbdb8d", "#17becf", "#9edae5"], "save_img": false, "auto_size": true, "style": {"overflow": "auto"}, "port": "5006"};function setInnerHTML(elm, html) {
      elm.innerHTML = html;
  
      Array.from(elm.querySelectorAll("script"))
        .forEach( oldScriptEl => {
          const newScriptEl = document.createElement("script");
      
          Array.from(oldScriptEl.attributes).forEach( attr => {
            newScriptEl.setAttribute(attr.name, attr.value) 
          });
      
          const scriptText = document.createTextNode(oldScriptEl.innerHTML);
          newScriptEl.appendChild(scriptText);
      
          oldScriptEl.parentNode.replaceChild(newScriptEl, oldScriptEl);
      });
    };

    function getScreenSize(option) {
      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_result_save', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'height': screen.height, 'width': screen.width},
                                  'event_id': 'screen_size'})
          });
          fetch(testRequest).then(response => {});
      return 
    }
    function support_scientific_notation(option) {
      if (Array.isArray(option['yAxis'])) {
        for (var tar_ind = 0; tar_ind < option['yAxis'].length; tar_ind++) {
          if (option['yAxis'][tar_ind]['type'] === 'value') {
            option['yAxis'][tar_ind]['axisLabel']['formatter'] = function(val) {
              const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                        '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                        '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
              function toSuperscript(val) {
                if (val.toString().length > 5 && !val.toString().includes('.')) {
                  val = Number(val).toExponential().toString();
                  if (val.includes('-')) {
                    val = val.split('-');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁻' + val1
                  }
                  else if (val.includes('+')) {
                    val = val.split('+');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁺' + val1
                  }
                }
                else {
                  return val
                }
              }
              return toSuperscript(val)
            }
          }
        }
      }
      else {
        if (option['yAxis']['type'] === 'value') {
          option['yAxis']['axisLabel']['formatter'] = function(val) {
            const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                    '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                    '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
            function toSuperscript(val) {
              if (val.toString().length > 5 && !val.toString().includes('.')) {
                val = Number(val).toExponential().toString();
                if (val.includes('-')) {
                  val = val.split('-');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁻' + val1
                }
                else if (val.includes('+')) {
                  val = val.split('+');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁺' + val1
                }
              }
              else {
                return val
              }
            }
            return toSuperscript(val)
          }
        }
      };
      return option;
    };

    function auto_component_size(option) {
      if (typeof option['figsize']['width'] === 'string' || option['figsize']['width'] instanceof String) {
        if (option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['width'].includes('px')) {
          var width = parseFloat(option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = option['figsize']['width']
      }

      if (typeof option['figsize']['height'] === 'string' || option['figsize']['height'] instanceof String) {
        if (option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['height'].includes('px')) {
          var height = parseFloat(option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height']
      }

      var relative_ratio = Math.min(width / 700, height / 400)
      if ('xAxis3D' in option) {
        var keys = ['xAxis3D', 'yAxis3D', 'zAxis3D']
      }
      else {
        var keys = ['xAxis', 'yAxis']
      }
      for (single_key of keys) {
        for (var ind = 0; ind < option[single_key].length; ind++) {
          option[single_key][ind]['nameTextStyle']['fontSize'] = Math.max(7, option[single_key][ind]['nameTextStyle']['fontSize'] * relative_ratio);
          option[single_key][ind]['axisLabel']['fontSize'] = Math.max(7, option[single_key][ind]['axisLabel']['fontSize'] * relative_ratio);
        }
      }
      if (option['series']) {
        for (var ind = 0; ind < option['series'].length; ind++) {
          if (['heatmap', 'bar'].includes(option['series'][ind]['type'])) {
            if (option['series'][ind]['label']) {
              option['series'][ind]['label']['fontSize'] = Math.max(7, option['series'][ind]['label']['fontSize'] * relative_ratio);
            }
          }
        }
      }
      if (option['title']) {
        if (Array.isArray(option['title'])) {
          for (var ind = 0; ind < option['title'].length; ind++) {
            option['title'][ind]['textStyle']['fontSize'] = Math.max(9, option['title'][ind]['textStyle']['fontSize'] * relative_ratio);
          }
        }
        else {
          option['title']['textStyle']['fontSize'] = Math.max(9, option['title']['textStyle']['fontSize'] * relative_ratio);
        }
      }
      if (option['legend']) {
        option['legend']['itemHeight'] = option['legend']['itemHeight'] * relative_ratio;
        option['legend']['itemWidth'] = option['legend']['itemWidth'] * relative_ratio;
        option['legend']['textStyle']['fontSize'] = Math.max(7, option['legend']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['visualMap']) {
        option['visualMap']['itemHeight'] = option['visualMap']['itemHeight'] * relative_ratio;
        option['visualMap']['itemWidth'] = option['visualMap']['itemWidth'] * relative_ratio;
        option['visualMap']['textStyle']['fontSize'] = Math.max(7, option['visualMap']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['toolbox']) {
        option['toolbox']['itemSize'] = Math.max(8, option['toolbox']['itemSize'] * relative_ratio)
        option['toolbox']['itemGap'] = Math.max(4, option['toolbox']['itemGap'] * relative_ratio);
      }
      if (option['graphic']) {
        for (var ind = 0; ind < option['graphic'].length; ind++) {
          for (var ind2 = 0; ind2 < option['graphic'][ind]['children'].length; ind2++) {
            var new_font = Math.max(7, 12 * relative_ratio);
            option['graphic'][ind]['children'][ind2]['style']['font'] = new_font.toString() + 'px Microsoft YaHei';
          }
        }
      }
      return option;
    }

    function save_img(echarts_instance, option) {
      const base64_str = echarts_instance.getDataURL({
          pixelRatio: 2,
          backgroundColor: '#fff',
          width: option['figsize']['width'],
          height: option['figsize']['height']
      });

      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_image_save', {
        method: 'post',
        headers: {
          'Content-Type': 'application/json;charset=utf-8;',
          'Access-Control-Allow-Origin':'*',
          'Access-Control-Allow-Credentials': 'true',
          'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
        },
        body: JSON.stringify({'figname': option['figname'],
                              'base64_str': base64_str})
      });
      fetch(testRequest).then(response => {});
    };


    function auto_axis_namegap(echarts_instance, auto_axis_list, axis_type) {
      const globalModel = echarts_instance._api.getModel()
      const figsize = globalModel.option.figsize
      const ctx = document.createElement('canvas').getContext('2d')
      if (typeof globalModel.option['figsize']['width'] === 'string' || globalModel.option['figsize']['width'] instanceof String) {
        if (globalModel.option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(globalModel.option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['width'].includes('px')) {
          var width = parseFloat(globalModel.option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = globalModel.option['figsize']['width'];
      }

      if (typeof globalModel.option['figsize']['height'] === 'string' || globalModel.option['figsize']['height'] instanceof String) {
        if (globalModel.option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(globalModel.option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['height'].includes('px')) {
          var height = parseFloat(globalModel.option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height'];
      }
      var relative_ratio = Math.min(width / 700, height / 400);
      if (axis_type==='2d') {
        const yAxisList = globalModel.option.yAxis
        const xAxisList = globalModel.option.xAxis

        for (var axis_idx of auto_axis_list) {
          const yAxis = yAxisList[axis_idx]
          const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
          const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
          ctx.save()
          ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
  
          const yAxisComponent = globalModel.getComponent('yAxis', axis_idx)?.axis
          if (yAxis.type === 'value') {
            var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
          }
          else {
            var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
          }
          var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
          axisLabelMargin = axisLabelMargin * relative_ratio
          yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
          ctx.restore()
        };
  
        for (var axis_idx of [...Array(xAxisList.length).keys()]) {
          var new_gap = Math.max(xAxisList[axis_idx].nameGap * relative_ratio, 12);
          if (figsize['height'] < 400) {
            new_gap = Math.min(20, new_gap);
          }
          xAxisList[axis_idx].nameGap = new_gap;
        }
  
        echarts_instance.setOption({
          yAxis: yAxisList,
          xAxis: xAxisList
        })
      }
      else {
        const yAxisList = globalModel.option.yAxis3D
        const xAxisList = globalModel.option.xAxis3D
        const zAxisList = globalModel.option.zAxis3D

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < xAxisList.length) {
            const xAxis = xAxisList[axis_idx]
            const fontSize = xAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = xAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const xAxisComponent = globalModel.getComponent('xAxis3D', axis_idx)?.axis
            if (xAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = xAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            xAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < yAxisList.length) {
            const yAxis = yAxisList[axis_idx]
            const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const yAxisComponent = globalModel.getComponent('yAxis3D', axis_idx)?.axis
            if (yAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < zAxisList.length) {
            const zAxis = zAxisList[axis_idx]
            const fontSize = zAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = zAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const zAxisComponent = globalModel.getComponent('zAxis3D', axis_idx)?.axis
            if (zAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = zAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            zAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };
        echarts_instance.setOption({
          yAxis3D: yAxisList,
          xAxis3D: xAxisList,
          zAxis3D: zAxisList
        });
        }
  
    };

    function custom_scatter_size(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['symbolSize'] === 'array_size') {
          var ind_ = option['series'][ind]['data_dict']['size']
          option['series'][ind]['symbolSize'] = function (data) {return data[ind_];}
        }
      }
      return option;
  
    };

    function show_scatter_label(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['label'] === 'show_label') {
          var ind_ = option['series'][ind]['data_dict']['label']
          option['series'][ind]['label'] = {
            show: true,
            formatter: function (params) {return params.data.value[ind_]; }
          }
        }
      }
      return option;
    };

    function hide_min_max_axis_label(option) {
      for (var ind = 0; ind < option['xAxis3D'].length; ind++) {
        if (option['xAxis3D'][ind]['type'] == 'value') {
          var x_min = option['xAxis3D'][ind]['min']
          var x_max = option['xAxis3D'][ind]['max']
          option['xAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==x_min || value==x_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['yAxis3D'].length; ind++) {
        if (option['yAxis3D'][ind]['type'] == 'value') {  
          var y_min = option['yAxis3D'][ind]['min']
          var y_max = option['yAxis3D'][ind]['max']
          option['yAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==y_min || value==y_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['zAxis3D'].length; ind++) {
        if (option['zAxis3D'][ind]['type'] == 'value') {
          var z_min = option['zAxis3D'][ind]['min']
          var z_max = option['zAxis3D'][ind]['max']
          option['zAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==z_min || value==z_max){}
            else {return value}
          }
       }
      }
      return option;
    }

    function custom_axis_label(option) {
      if (Array.isArray(option['xAxis'])) {
        for (var ind = 0; ind < option['xAxis'].length; ind++) {
          if (option['xAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['xAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['xAxis'][ind]['axisLabel']['formatter_func'].body)
            option['xAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['xAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['xAxis']['axisLabel']['formatter_func'].arguments,
                               option['xAxis']['axisLabel']['formatter_func'].body)
          option['xAxis']['axisLabel']['formatter'] = f
        }
      }
      if (Array.isArray(option['yAxis'])) {
        for (var ind = 0; ind < option['yAxis'].length; ind++) {
          if (option['yAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['yAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['yAxis'][ind]['axisLabel']['formatter_func'].body)
            option['yAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['yAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['yAxis']['axisLabel']['formatter_func'].arguments,
                               option['yAxis']['axisLabel']['formatter_func'].body)
          option['yAxis']['axisLabel']['formatter'] = f
        }
      }
      return option;
    }

    function custom_tooltip(option, dimension=2) {

      if (dimension === 2) {
        var xaxis_key = 'xAxis'
        var yaxis_key = 'yAxis'
      }

      else if (dimension === 3) {
        var xaxis_key = 'xAxis3D'
        var yaxis_key = 'yAxis3D'
        var zaxis_key = 'zAxis3D'
      }

      if (option['radar']) {
        var radar_names = []
        for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
          radar_names.push(option['radar']['indicator'][ind_]['name']) 
        }
      }
  
  
      if (option[xaxis_key]['name'] !== null && option[xaxis_key]['name'] !== '' && Array.isArray(option[xaxis_key])!==true) {
        var xaxis_name = option[xaxis_key]['name'];
      }
      else {
        var xaxis_name = 'X';
      }

      if (option[yaxis_key]['name'] !== null && option[yaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
        var yaxis_name = option[yaxis_key]['name'];
      }
      else {
        var yaxis_name = 'Y';
      }

      if (typeof zaxis_key !== 'undefined') {
        if (option[zaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
          var zaxis_name = option[zaxis_key]['name'];
        }
        else {
          var zaxis_name = 'Z';
        }
      }
  
      if (option['tooltip']) {
        if (option['tooltip']['precision']) {
          var precision = option['tooltip']['precision']
          option['tooltip']['valueFormatter'] = (value) =>  Math.round(Number(value) * (10**precision)) / (10**precision)
        }

        for (var ind_ = 0; ind_ < option['series'].length; ind_++) {
          if (option['series'][ind_]['tooltip']) {
            if (option['series'][ind_]['tooltip']['precision']) {
              var precision = option['series'][ind_]['tooltip']['precision']
              const fix = precision_ => value => Math.round(Number(value) * (10**precision_)) / (10**precision_),
              fix_p = fix(precision);
              option['series'][ind_]['tooltip']['valueFormatter'] = function (value) {
                return fix_p(value)
              } 
            }
          }
        }

        if (option['series'].length === 1) {
          if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][0]['type'])) {
            option['tooltip']['formatter'] = function(params) {
              if (params.seriesName.includes('series')) {
                var series_name = ''
              }
          
              else {
                var series_name = params.seriesName + '<br>'
              }
      
              if (params.seriesType === 'scatter') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                  + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                  +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                }
            
              }
  
              else if (params.seriesType === 'heatmap') {
                formatter = params.name + ', ' + option['yAxis'][0]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
              }
      
              else if (params.seriesType === 'scatter3D') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                    + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                    +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                    +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                }
              }
          
              else if (params.seriesType === 'radar') {
                formatter = params.name  + '<br>';
                for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                  if (ind_ !== option['radar']['indicator'].length - 1) {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                  }
                  else {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                  }
                }
              }
            return formatter;
            }
          }
        }
        else {
          for (var out_ind_ = 0; out_ind_ < option['series'].length; out_ind_++) {
            if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][out_ind_]['type'])) {
              if (option['series'][out_ind_]['tooltip']) {
              }
              else {
                option['series'][out_ind_]['tooltip'] = {}
              }
              option['series'][out_ind_]['tooltip']['formatter'] = function(params) {
                if (params.seriesName.includes('series')) {
                  var series_name = ''
                }
            
                else {
                  var series_name = params.seriesName + '<br>'
                }
        
                if (params.seriesType === 'scatter') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                  }
                }
    
                else if (params.seriesType === 'heatmap') {
                  if ('data' in option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]) {
                    formatter = params.name + ', ' + option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
                  }
                  else {
                    formatter = Math.round(params.data[2] * 10000) / 10000
                  }
                
                }
        
                else if (params.seriesType === 'scatter3D') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                      +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                  }
                }
            
                else if (params.seriesType === 'radar') {
                  formatter = params.name  + '<br>';
                  for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                    if (ind_ !== option['radar']['indicator'].length - 1) {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                    }
                    else {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                    }
                  }
                }
              return formatter;
              }
            }
          }
        }
      }
      return option;
    };

    function support_brush_event(option) {
      if (option['event']['type_'] === 'brushselected') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var last_selected = [];
        bind_chart.on(option['event']['type_'], (params) => {
          var brushed = [];
          var brushComponent = params.batch[0];
          for (var sIdx = 0; sIdx < brushComponent.selected.length; sIdx++) {
            var rawIndices = brushComponent.selected[sIdx].dataIndex;
            brushed.push(rawIndices);
          }
          var brushed_all = brushed[0];

          if (JSON.stringify(last_selected) !== JSON.stringify(brushed_all)) {

            // Update memory
            let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
              method: 'post',
              headers: {
                  'Content-Type': 'application/json;charset=utf-8;',
                  'Access-Control-Allow-Origin':'*',
                  'Access-Control-Allow-Credentials': 'true',
                  'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
              },
              body: JSON.stringify({'js_func_input':{'selected': brushed_all},
                                    'event_id': option['event']['event_id']})
            });
            var dom_dict = {}
            fetch(testRequest).then(response => {
              var result = response.json();
              result.then(res => {
                dom_dict[res['link_id']] = document.getElementById(res['link_id']);
                setInnerHTML(dom_dict[res['link_id']], res['html']);
              });
            });
            last_selected = brushed_all;
          }
                            
        // bind_chart.setOption(option);
        })
      }
      return option;
    };

    function support_click_event(option) {
      if (option['event']['type_'] === 'click') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        if (option['series'][0]['orient'] === 'vertical') {
          var value_idx = 0
        }
        else {
          var value_idx = 1
        }
    

        bind_chart.on(option['event']['type_'], (params) => {
          if (option['event']['task'] === 'singleselect') {
            for (var ind_2 = 0; ind_2 < option['series'][0]['data'].length; ind_2++) {
              if (option['series'][0]['data'][ind_2]['itemStyle']['color'] !== '#1f77b4') {
                option['series'][0]['data'][ind_2]['itemStyle']['color'] = '#1f77b4';
              }
            }
            var idx = option['series'][0]['x_value'].indexOf(params.value[value_idx])
            option['series'][0]['data'][idx]['itemStyle']['color'] = '#ff7f0e';

            var selected = params.value[value_idx];
          }
          else {
            console.log(params);
          }
      
          let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'selected': selected},
                                  'event_id': option['event']['event_id']})
          });
          var dom_dict = {}
          fetch(testRequest).then(response => {
            var result = response.json();
            result.then(res => {
              dom_dict[res['link_id']] = document.getElementById(res['link_id']);
              setInnerHTML(dom_dict[res['link_id']], res['html']);
            });
          });
          bind_chart.setOption(option);
        });
      }
      return option;
    };option = support_scientific_notation(option=option);option = custom_tooltip(option=option, dimension=2);option = custom_axis_label(option=option);option = auto_component_size(option=option);getScreenSize(option=option);

                myChart.setOption(option);
                window.addEventListener('resize', function () {
                    myChart.resize();
                    var option_copy = JSON.parse(JSON.stringify(option));
                    option_copy['figsize']['height'] = myChart.getHeight();
                    option_copy['figsize']['width'] = myChart.getWidth();
                    // option_copy = auto_component_size(option_copy);
                    myChart.setOption(option_copy);
                });
            <\/script>
            </body>
            </html>
        <style>
    .dg.main.taller-than-window .close-button {
        border-top: 1px solid #ddd;
    }

    .dg.main .close-button {
        background-color: #e8e8e8;
    }
 
    .dg.main .close-button:hover {
        background-color: #ddd;
    }

    .dg {
        color: #555;
        text-shadow: none !important;
    }

    .dg.main::-webkit-scrollbar {
        background: #fafafa;
    }

    .dg.main::-webkit-scrollbar-thumb {
        background: #bbb;
    }
 
    .dg li:not(.folder) {
        background: #fafafa;
        border-bottom: 1px solid #ddd;
    }
 
    .dg li.save-row .button {
        text-shadow: none !important;
    }

    .dg li.title {
        background: #e8e8e8 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;
    }

    .dg .cr.function:hover,.dg .cr.boolean:hover {
        background: #fff;
    }
 
    .dg .c input[type=text] {
        background: #e9e9e9;
    }
 
    .dg .c input[type=text]:hover {
        background: #eee;
    }
 
    .dg .c input[type=text]:focus {
        background: #eee;
        color: #555;
    }
 
    .dg .c .slider {
        background: #e9e9e9;
    }

    .dg .c .slider:hover {
        background: #eee;
    }<\/style>`);option = support_scientific_notation(option=option);option = custom_tooltip(option=option, dimension=2);option = custom_axis_label(option=option);option = auto_component_size(option=option);getScreenSize(option=option);

                if (option && typeof option === 'object') {
                    myChart.setOption(option);
                    }

                auto_axis_namegap(echarts_instance=myChart, auto_axis_list=[0], axis_type="2d");

            </script>
            </body>
            </html>
    
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 27-28

Density difference for variable PAY_1

.. GENERATED FROM PYTHON SOURCE LINES 28-30

.. code-block:: Python

    results.plot(("density", "PAY_1"))






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

                <!DOCTYPE html>
                <html lang="en" style="height: 100%">
                <head>
                <meta charset="utf-8">
                </head>
                <body style="height: 100%; margin: 0">

            
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts-gl/2.0.8/echarts-gl.min.js"></script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>
                <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"></script>
            
                <div id="1737119429.4012003" style="height: 600px; width: 600px; overflow: auto"></div>
            
                <script type="text/javascript">
                var dom = document.getElementById('1737119429.4012003');
                dom.innerHTML = ""
                dom.setAttribute('_echarts_instance_', '')
                var myChart = echarts.init(dom, null, {
                    renderer: 'canvas',
                    useDirtyRect: false
                    });
                var app = {};

                var option;
        option = {"chart_id": "1737119429.4012003", "link_id": null, "figname": "", "title": {"show": true, "text": "Density Comparison (PSI = 0.0027)", "link": "", "target": "blank", "textStyle": {"fontStyle": "normal", "fontWeight": "bolder", "fontFamily": "sans-serif", "fontSize": 15, "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "subtext": "", "sublink": "", "subtarget": "blank", "textAlign": "center", "textVerticalAlign": "auto", "padding": 0, "itemGap": 10, "z": 2, "left": "45.0%", "top": "5%", "right": "auto", "bottom": "auto", "backgroundColor": "transparent", "borderColor": "#ccc", "changed_name_key": {"id_": "id"}}, "grid": {"show": true, "width": "auto", "height": "auto", "z": 2, "left": "5%", "top": "10%", "right": "20%", "bottom": "5%", "borderColor": "#ccc", "borderWidth": 1, "containLabel": true, "backgroundColor": "transparent", "changed_name_key": {"id_": "id"}}, "legend": {"show": true, "type": "plain", "width": "auto", "height": "auto", "orient": "vertical", "align": "auto", "itemWidth": 25, "itemHeight": 14, "symbolRotate": "inherit", "selectedMode": true, "padding": 5, "itemGap": 10, "z": 4, "left": "auto", "top": "10%", "right": "1%", "bottom": "auto", "borderColor": "#ccc", "borderWidth": 1, "inactiveColor": "#ccc", "inactiveBorderColor": "#ccc", "inactiveBorderWidth": "auto", "selected": {}, "textStyle": {"overflow": "truncate", "fontSize": 12}, "pageButtonItemGap": 5, "pageButtonPosition": "end", "pageFormatter": "{current}/{total}", "pageIconColor": "#2f4554", "pageIconInactiveColor": "#aaa", "pageIconSize": 15, "animationDurationUpdate": 800, "selectorItemGap": 7, "selectorButtonGap": 10}, "brush": null, "yAxis": [{"show": true, "data": [0.0052178624722770415, 0.028419115680658576, 0.1038879682557188, 0.25489229472424474, 0.4197444118404787, 0.46392727890943225, 0.344153480106419, 0.17136335031183894, 0.05745514711262427, 0.015128942673772211, 0.020072955489263616, 0.09681939318463213, 0.3454599241675757, 0.8289224566087299, 1.3350051079366563, 1.4430753740046967, 1.0469643986215533, 0.5098164590711055, 0.16666816250617106, 0.03710319019490838, 0.009679027068166575, 0.02292201187171301, 0.07832347117719973, 0.183727316609877, 0.28938801428887684, 0.3059339566607275, 0.21707600905878147, 0.10338125845624634, 0.0330816297122892, 0.007516939850636538, 0.004269377679417406, 0.016650344786802274, 0.05660694135202513, 0.129908129546353, 0.20011838089336378, 0.2069070504080857, 0.14358213917853832, 0.06687511532612349, 0.02091140139889981, 0.004451410016538923, 0.001101231647711703, 0.002467838522121789, 0.008061908263613905, 0.018088310290043902, 0.027251283741961563, 0.027556010313738475, 0.01870176613089479, 0.008519024552010757, 0.0026058857266801597, 0.0005493780087532928, 0.0001820440870947277, 0.0005352543415014506, 0.0017289024921683005, 0.003794578098303888, 0.005591075010104124, 0.0055292450799196285, 0.0036700602552503917, 0.0016350052692234874, 0.0004889890883984013, 9.931461204109918e-05, 2.176533820147466e-05, 4.194619408477332e-05, 0.0001304326439643214, 0.0002798901347636394, 0.0004033276634638914, 0.00039009430615711063, 0.0002532320487755826, 0.00011034095076566938, 3.2395697759159795e-05, 7.689994059293085e-06, 1.0261061005203017e-05, 4.4014970712430416e-05, 0.00013747646884173335, 0.00028866496105366655, 0.000406827070258058, 0.00038482442474221273, 0.0002443161525920746, 0.00010410665530447316, 2.9774300582829534e-05, 5.715331222909812e-06, 7.363393359398798e-07, 6.367242053351976e-08, 3.6954003872388188e-09, 1.4396738335942493e-10, 5.106355384311407e-12, 6.555927257421488e-11, 2.1438813675237727e-09, 4.710223606808517e-08, 6.945751132390553e-07, 6.8743821872561975e-06, 4.5665150135185667e-05, 0.00020359769999288345, 0.0006092529021204672, 0.0012236553319980722, 0.0016495191758996474, 0.0014924245747809748, 0.0009062837145674459, 0.00036937944268700015, 0.00010104574464234067, 1.8552399901429463e-05], "type": "value", "position": "bottom", "name": "", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": "auto", "min": -0.64, "max": 2.44, "splitNumber": 5, "logBase": 10, "axisLine": {"show": false}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": 40.0}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "xAxis": [{"show": true, "data": [-1.4777655112529708, -1.377204591833719, -1.276643672414467, -1.1760827529952151, -1.075521833575963, -0.9749609141567113, -0.8743999947374593, -0.7738390753182074, -0.6732781558989555, -0.5727172364797035, -0.4721563170604517, -0.37159539764119964, -0.2710344782219478, -0.17047355880269577, -0.06991263938344394, 0.030648280035808106, 0.13120919945505993, 0.23177011887431176, 0.3323310382935638, 0.43289195771281563, 0.5334528771320675, 0.6340137965513195, 0.7345747159705716, 0.8351356353898236, 0.9356965548090752, 1.0362574742283273, 1.1368183936475793, 1.237379313066831, 1.337940232486083, 1.438501151905335, 1.539062071324587, 1.6396229907438387, 1.7401839101630907, 1.8407448295823428, 1.9413057490015944, 2.0418666684208464, 2.1424275878400985, 2.2429885072593505, 2.343549426678602, 2.444110346097854, 2.5446712655171058, 2.6452321849363583, 2.74579310435561, 2.8463540237748615, 2.946914943194114, 3.0474758626133656, 3.148036782032618, 3.2485977014518697, 3.3491586208711213, 3.4497195402903738, 3.5502804597096254, 3.650841379128877, 3.7514022985481295, 3.851963217967381, 3.9525241373866327, 4.053085056805886, 4.153645976225137, 4.254206895644389, 4.35476781506364, 4.455328734482892, 4.555889653902145, 4.656450573321397, 4.757011492740649, 4.8575724121599, 4.958133331579152, 5.058694250998403, 5.159255170417657, 5.259816089836908, 5.36037700925616, 5.460937928675412, 5.561498848094663, 5.662059767513917, 5.762620686933168, 5.86318160635242, 5.963742525771671, 6.064303445190923, 6.164864364610175, 6.265425284029428, 6.36598620344868, 6.466547122867931, 6.567108042287183, 6.667668961706436, 6.768229881125688, 6.868790800544939, 6.969351719964191, 7.069912639383443, 7.170473558802694, 7.271034478221948, 7.371595397641199, 7.472156317060451, 7.572717236479702, 7.673278155898954, 7.773839075318207, 7.874399994737459, 7.974960914156711, 8.075521833575962, 8.176082752995214, 8.276643672414465, 8.377204591833719, 8.47776551125297], "type": "value", "position": "bottom", "name": "PAY_1", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": 30, "min": -3.4689, "max": 10.4689, "splitNumber": 5, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": null}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "parallelAxis": null, "series": [{"type": "line", "name": "train", "colorBy": "series", "z": 2, "legendHoverLink": true, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "areaStyle": {"opacity": 0.8}, "emphasis": {"focus": "series"}, "seriesLayoutBy": "column", "data": [[-1.3740562315916558, 0.006754886999488502], [-1.2755904491352588, 0.052856652399286705], [-1.1771246666788615, 0.22168403755772442], [-1.0786588842224645, 0.49833615111047586], [-0.9801931017660674, 0.6004316364852998], [-0.8817273193096704, 0.38775547870375265], [-0.7832615368532733, 0.13421638499285032], [-0.6847957543968761, 0.024900923763183105], [-0.5863299719404791, 0.0025054585564912722], [-0.48786418948408206, 0.0010145931700307395], [-0.3893984070276849, 0.01420435030304932], [-0.29093262457128777, 0.12245855096958584], [-0.19246684211489073, 0.56601107647223], [-0.0940010596584937, 1.4022135209059932], [0.004464722797903553, 1.8619009506507982], [0.10293050525430059, 1.3251108173734514], [0.20139628771069762, 0.5054765676028933], [0.29986207016709465, 0.1033482892234142], [0.3983278526234917, 0.011328960979179402], [0.49679363507988894, 0.0007789326064984145], [0.595259417536286, 0.002037130938223996], [0.6937251999926832, 0.01916122174560485], [0.7921909824490803, 0.09760059597747475], [0.8906567649054773, 0.2664666892161119], [0.9891225473618743, 0.3899299543805533], [1.0875883298182714, 0.30583238700062443], [1.1860541122746684, 0.12856819678442302], [1.2845198947310654, 0.028969242367027855], [1.382985677187463, 0.003499974283906709], [1.48145145964386, 0.00027685479080993874], [1.579917242100257, 0.0009924713515954671], [1.678383024556654, 0.010312347937152305], [1.776848807013051, 0.05788818500207063], [1.875314589469448, 0.17417332496363733], [1.973780371925845, 0.2808837181461786], [2.072246154382242, 0.24278658736027758], [2.1707119368386394, 0.11248018407488376], [2.269177719295037, 0.027930619388877875], [2.3676435017514335, 0.0037174789641611357], [2.466109284207831, 0.0002687062517626181], [2.5645750666642275, 8.59641357359381e-05], [2.663040849120625, 0.000875387671026468], [2.7615066315770225, 0.005414237153769955], [2.859972414033419, 0.017952711928679324], [2.9584381964898165, 0.031906284584600826], [3.056903978946213, 0.03039314273179971], [3.1553697614026106, 0.015517729859111649], [3.253835543859007, 0.004246527895012467], [3.3523013263154047, 0.0006228750169960561], [3.450767108771802, 4.947282488319862e-05], [3.5492328912281987, 1.4063202102821312e-05], [3.647698673684596, 0.0001526851103161348], [3.746164456140993, 0.0010406516349359908], [3.8446302385973903, 0.0038027638424320367], [3.943096021053787, 0.007448121934286969], [4.041561803510184, 0.007818931400168986], [4.140027585966582, 0.0043994788094246316], [4.238493368422978, 0.0013268085720317107], [4.336959150879376, 0.00021447336998683876], [4.4354249333357725, 1.869923087036585e-05], [4.53389071579217, 3.940698532853347e-06], [4.6323564982485665, 4.316668710890784e-05], [4.730822280704964, 0.0003241718071671682], [4.829288063161361, 0.0013054803185125327], [4.927753845617758, 0.0028178573277729043], [5.026219628074156, 0.0032600245838691365], [5.124685410530552, 0.0020215102711019835], [5.22315119298695, 0.0006718684305145819], [5.321616975443346, 0.0001196871483772028], [5.420082757899744, 1.1454502714707359e-05], [5.51854854035614, 1.3561701189879649e-06], [5.617014322812538, 1.193222740590942e-05], [5.715480105268934, 9.866924826422214e-05], [5.813945887725332, 0.0004379025789167417], [5.912411670181729, 0.001041663443468075], [6.010877452638126, 0.0013280992996611632], [6.109343235094523, 0.0009075840912927135], [6.20780901755092, 0.0003324270891885287], [6.306274800007317, 6.526204081081644e-05], [6.404740582463714, 6.8806139743517405e-06], [6.5032063649201115, 8.157049152604675e-07], [6.601672147376509, 7.305425828566663e-06], [6.700137929832906, 6.655719160499533e-05], [6.798603712289303, 0.0003255305278779214], [6.8970694947457005, 0.00085338084840421], [6.995535277202096, 0.001199077535302767], [7.094001059658494, 0.0009030355411973637], [7.192466842114891, 0.0003645151846696064], [7.290932624571289, 7.886433575311902e-05], [7.389398407027686, 9.157673616388024e-06], [7.487864189484082, 1.002426074919621e-06], [7.586329971940479, 8.162068052143941e-06], [7.684795754396877, 8.189158589839621e-05], [7.783261536853274, 0.0004414044539096747], [7.88172731930967, 0.0012752317869433544], [7.980193101766067, 0.001974671025494365], [8.078658884222465, 0.001638904246142831], [8.177124666678862, 0.0007290639253158545], [8.27559044913526, 0.00017383244595247353], [8.374056231591656, 2.221515128093145e-05]], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "linear", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "symbol": "none", "coordinateSystem": "cartesian2d", "symbolSize": 4, "symbolOffset": [0, 0], "showSymbol": true, "showAllSymbol": "auto", "smooth": true, "xlim": [-1.3740562315916558, 8.374056231591656], "tooltip_trigger": "item"}, {"type": "line", "name": "test", "colorBy": "series", "z": 2, "legendHoverLink": true, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "areaStyle": {"opacity": 0.8}, "emphasis": {"focus": "series"}, "seriesLayoutBy": "column", "data": [[-1.4777655112529708, 0.0052178624722770415], [-1.377204591833719, 0.028419115680658576], [-1.276643672414467, 0.1038879682557188], [-1.1760827529952151, 0.25489229472424474], [-1.075521833575963, 0.4197444118404787], [-0.9749609141567113, 0.46392727890943225], [-0.8743999947374593, 0.344153480106419], [-0.7738390753182074, 0.17136335031183894], [-0.6732781558989555, 0.05745514711262427], [-0.5727172364797035, 0.015128942673772211], [-0.4721563170604517, 0.020072955489263616], [-0.37159539764119964, 0.09681939318463213], [-0.2710344782219478, 0.3454599241675757], [-0.17047355880269577, 0.8289224566087299], [-0.06991263938344394, 1.3350051079366563], [0.030648280035808106, 1.4430753740046967], [0.13120919945505993, 1.0469643986215533], [0.23177011887431176, 0.5098164590711055], [0.3323310382935638, 0.16666816250617106], [0.43289195771281563, 0.03710319019490838], [0.5334528771320675, 0.009679027068166575], [0.6340137965513195, 0.02292201187171301], [0.7345747159705716, 0.07832347117719973], [0.8351356353898236, 0.183727316609877], [0.9356965548090752, 0.28938801428887684], [1.0362574742283273, 0.3059339566607275], [1.1368183936475793, 0.21707600905878147], [1.237379313066831, 0.10338125845624634], [1.337940232486083, 0.0330816297122892], [1.438501151905335, 0.007516939850636538], [1.539062071324587, 0.004269377679417406], [1.6396229907438387, 0.016650344786802274], [1.7401839101630907, 0.05660694135202513], [1.8407448295823428, 0.129908129546353], [1.9413057490015944, 0.20011838089336378], [2.0418666684208464, 0.2069070504080857], [2.1424275878400985, 0.14358213917853832], [2.2429885072593505, 0.06687511532612349], [2.343549426678602, 0.02091140139889981], [2.444110346097854, 0.004451410016538923], [2.5446712655171058, 0.001101231647711703], [2.6452321849363583, 0.002467838522121789], [2.74579310435561, 0.008061908263613905], [2.8463540237748615, 0.018088310290043902], [2.946914943194114, 0.027251283741961563], [3.0474758626133656, 0.027556010313738475], [3.148036782032618, 0.01870176613089479], [3.2485977014518697, 0.008519024552010757], [3.3491586208711213, 0.0026058857266801597], [3.4497195402903738, 0.0005493780087532928], [3.5502804597096254, 0.0001820440870947277], [3.650841379128877, 0.0005352543415014506], [3.7514022985481295, 0.0017289024921683005], [3.851963217967381, 0.003794578098303888], [3.9525241373866327, 0.005591075010104124], [4.053085056805886, 0.0055292450799196285], [4.153645976225137, 0.0036700602552503917], [4.254206895644389, 0.0016350052692234874], [4.35476781506364, 0.0004889890883984013], [4.455328734482892, 9.931461204109918e-05], [4.555889653902145, 2.176533820147466e-05], [4.656450573321397, 4.194619408477332e-05], [4.757011492740649, 0.0001304326439643214], [4.8575724121599, 0.0002798901347636394], [4.958133331579152, 0.0004033276634638914], [5.058694250998403, 0.00039009430615711063], [5.159255170417657, 0.0002532320487755826], [5.259816089836908, 0.00011034095076566938], [5.36037700925616, 3.2395697759159795e-05], [5.460937928675412, 7.689994059293085e-06], [5.561498848094663, 1.0261061005203017e-05], [5.662059767513917, 4.4014970712430416e-05], [5.762620686933168, 0.00013747646884173335], [5.86318160635242, 0.00028866496105366655], [5.963742525771671, 0.000406827070258058], [6.064303445190923, 0.00038482442474221273], [6.164864364610175, 0.0002443161525920746], [6.265425284029428, 0.00010410665530447316], [6.36598620344868, 2.9774300582829534e-05], [6.466547122867931, 5.715331222909812e-06], [6.567108042287183, 7.363393359398798e-07], [6.667668961706436, 6.367242053351976e-08], [6.768229881125688, 3.6954003872388188e-09], [6.868790800544939, 1.4396738335942493e-10], [6.969351719964191, 5.106355384311407e-12], [7.069912639383443, 6.555927257421488e-11], [7.170473558802694, 2.1438813675237727e-09], [7.271034478221948, 4.710223606808517e-08], [7.371595397641199, 6.945751132390553e-07], [7.472156317060451, 6.8743821872561975e-06], [7.572717236479702, 4.5665150135185667e-05], [7.673278155898954, 0.00020359769999288345], [7.773839075318207, 0.0006092529021204672], [7.874399994737459, 0.0012236553319980722], [7.974960914156711, 0.0016495191758996474], [8.075521833575962, 0.0014924245747809748], [8.176082752995214, 0.0009062837145674459], [8.276643672414465, 0.00036937944268700015], [8.377204591833719, 0.00010104574464234067], [8.47776551125297, 1.8552399901429463e-05]], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "linear", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "symbol": "none", "coordinateSystem": "cartesian2d", "symbolSize": 4, "symbolOffset": [0, 0], "showSymbol": true, "showAllSymbol": "auto", "smooth": true, "xlim": [-1.4777655112529708, 8.47776551125297], "tooltip_trigger": "item"}], "visualMap": null, "toolbox": {"show": true, "orient": "horizontal", "itemSize": 15, "itemGap": 8, "showTitle": true, "feature": {"dataZoom": {}, "saveAsImage": {}}, "z": 2, "left": "auto", "top": "auto", "right": "1%", "bottom": "auto", "width": "auto", "height": "auto", "popup": true, "changed_name_key": {"id_": "id"}}, "tooltip": {"show": true, "custom_tooltip": false, "trigger": "item", "axisPointer": {"show": true}, "showContent": true, "triggerOn": "mousemove|click", "hideDelay": 100, "enterable": true, "renderMode": "html", "confine": true, "transitionDuration": 0.4, "precision": 4, "borderColor": "#333", "padding": 5, "order": "seriesAsc"}, "dataZoom": null, "event": null, "graphic": null, "radar": null, "figsize": {"width": 600, "height": 600}, "color": ["#1f77b4", "#aec7e8", "#ff7f0e", "#ffbb78", "#2ca02c", "#98df8a", "#d62728", "#ff9896", "#9467bd", "#c5b0d5", "#8c564b", "#c49c94", "#e377c2", "#f7b6d2", "#7f7f7f", "#c7c7c7", "#bcbd22", "#dbdb8d", "#17becf", "#9edae5"], "save_img": false, "auto_size": true, "style": {"overflow": "auto"}, "port": "5006"};function setInnerHTML(elm, html) {
      elm.innerHTML = html;
  
      Array.from(elm.querySelectorAll("script"))
        .forEach( oldScriptEl => {
          const newScriptEl = document.createElement("script");
      
          Array.from(oldScriptEl.attributes).forEach( attr => {
            newScriptEl.setAttribute(attr.name, attr.value) 
          });
      
          const scriptText = document.createTextNode(oldScriptEl.innerHTML);
          newScriptEl.appendChild(scriptText);
      
          oldScriptEl.parentNode.replaceChild(newScriptEl, oldScriptEl);
      });
    };

    function getScreenSize(option) {
      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_result_save', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'height': screen.height, 'width': screen.width},
                                  'event_id': 'screen_size'})
          });
          fetch(testRequest).then(response => {});
      return 
    }
    function support_scientific_notation(option) {
      if (Array.isArray(option['yAxis'])) {
        for (var tar_ind = 0; tar_ind < option['yAxis'].length; tar_ind++) {
          if (option['yAxis'][tar_ind]['type'] === 'value') {
            option['yAxis'][tar_ind]['axisLabel']['formatter'] = function(val) {
              const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                        '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                        '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
              function toSuperscript(val) {
                if (val.toString().length > 5 && !val.toString().includes('.')) {
                  val = Number(val).toExponential().toString();
                  if (val.includes('-')) {
                    val = val.split('-');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁻' + val1
                  }
                  else if (val.includes('+')) {
                    val = val.split('+');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁺' + val1
                  }
                }
                else {
                  return val
                }
              }
              return toSuperscript(val)
            }
          }
        }
      }
      else {
        if (option['yAxis']['type'] === 'value') {
          option['yAxis']['axisLabel']['formatter'] = function(val) {
            const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                    '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                    '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
            function toSuperscript(val) {
              if (val.toString().length > 5 && !val.toString().includes('.')) {
                val = Number(val).toExponential().toString();
                if (val.includes('-')) {
                  val = val.split('-');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁻' + val1
                }
                else if (val.includes('+')) {
                  val = val.split('+');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁺' + val1
                }
              }
              else {
                return val
              }
            }
            return toSuperscript(val)
          }
        }
      };
      return option;
    };

    function auto_component_size(option) {
      if (typeof option['figsize']['width'] === 'string' || option['figsize']['width'] instanceof String) {
        if (option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['width'].includes('px')) {
          var width = parseFloat(option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = option['figsize']['width']
      }

      if (typeof option['figsize']['height'] === 'string' || option['figsize']['height'] instanceof String) {
        if (option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['height'].includes('px')) {
          var height = parseFloat(option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height']
      }

      var relative_ratio = Math.min(width / 700, height / 400)
      if ('xAxis3D' in option) {
        var keys = ['xAxis3D', 'yAxis3D', 'zAxis3D']
      }
      else {
        var keys = ['xAxis', 'yAxis']
      }
      for (single_key of keys) {
        for (var ind = 0; ind < option[single_key].length; ind++) {
          option[single_key][ind]['nameTextStyle']['fontSize'] = Math.max(7, option[single_key][ind]['nameTextStyle']['fontSize'] * relative_ratio);
          option[single_key][ind]['axisLabel']['fontSize'] = Math.max(7, option[single_key][ind]['axisLabel']['fontSize'] * relative_ratio);
        }
      }
      if (option['series']) {
        for (var ind = 0; ind < option['series'].length; ind++) {
          if (['heatmap', 'bar'].includes(option['series'][ind]['type'])) {
            if (option['series'][ind]['label']) {
              option['series'][ind]['label']['fontSize'] = Math.max(7, option['series'][ind]['label']['fontSize'] * relative_ratio);
            }
          }
        }
      }
      if (option['title']) {
        if (Array.isArray(option['title'])) {
          for (var ind = 0; ind < option['title'].length; ind++) {
            option['title'][ind]['textStyle']['fontSize'] = Math.max(9, option['title'][ind]['textStyle']['fontSize'] * relative_ratio);
          }
        }
        else {
          option['title']['textStyle']['fontSize'] = Math.max(9, option['title']['textStyle']['fontSize'] * relative_ratio);
        }
      }
      if (option['legend']) {
        option['legend']['itemHeight'] = option['legend']['itemHeight'] * relative_ratio;
        option['legend']['itemWidth'] = option['legend']['itemWidth'] * relative_ratio;
        option['legend']['textStyle']['fontSize'] = Math.max(7, option['legend']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['visualMap']) {
        option['visualMap']['itemHeight'] = option['visualMap']['itemHeight'] * relative_ratio;
        option['visualMap']['itemWidth'] = option['visualMap']['itemWidth'] * relative_ratio;
        option['visualMap']['textStyle']['fontSize'] = Math.max(7, option['visualMap']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['toolbox']) {
        option['toolbox']['itemSize'] = Math.max(8, option['toolbox']['itemSize'] * relative_ratio)
        option['toolbox']['itemGap'] = Math.max(4, option['toolbox']['itemGap'] * relative_ratio);
      }
      if (option['graphic']) {
        for (var ind = 0; ind < option['graphic'].length; ind++) {
          for (var ind2 = 0; ind2 < option['graphic'][ind]['children'].length; ind2++) {
            var new_font = Math.max(7, 12 * relative_ratio);
            option['graphic'][ind]['children'][ind2]['style']['font'] = new_font.toString() + 'px Microsoft YaHei';
          }
        }
      }
      return option;
    }

    function save_img(echarts_instance, option) {
      const base64_str = echarts_instance.getDataURL({
          pixelRatio: 2,
          backgroundColor: '#fff',
          width: option['figsize']['width'],
          height: option['figsize']['height']
      });

      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_image_save', {
        method: 'post',
        headers: {
          'Content-Type': 'application/json;charset=utf-8;',
          'Access-Control-Allow-Origin':'*',
          'Access-Control-Allow-Credentials': 'true',
          'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
        },
        body: JSON.stringify({'figname': option['figname'],
                              'base64_str': base64_str})
      });
      fetch(testRequest).then(response => {});
    };


    function auto_axis_namegap(echarts_instance, auto_axis_list, axis_type) {
      const globalModel = echarts_instance._api.getModel()
      const figsize = globalModel.option.figsize
      const ctx = document.createElement('canvas').getContext('2d')
      if (typeof globalModel.option['figsize']['width'] === 'string' || globalModel.option['figsize']['width'] instanceof String) {
        if (globalModel.option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(globalModel.option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['width'].includes('px')) {
          var width = parseFloat(globalModel.option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = globalModel.option['figsize']['width'];
      }

      if (typeof globalModel.option['figsize']['height'] === 'string' || globalModel.option['figsize']['height'] instanceof String) {
        if (globalModel.option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(globalModel.option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['height'].includes('px')) {
          var height = parseFloat(globalModel.option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height'];
      }
      var relative_ratio = Math.min(width / 700, height / 400);
      if (axis_type==='2d') {
        const yAxisList = globalModel.option.yAxis
        const xAxisList = globalModel.option.xAxis

        for (var axis_idx of auto_axis_list) {
          const yAxis = yAxisList[axis_idx]
          const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
          const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
          ctx.save()
          ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
  
          const yAxisComponent = globalModel.getComponent('yAxis', axis_idx)?.axis
          if (yAxis.type === 'value') {
            var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
          }
          else {
            var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
          }
          var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
          axisLabelMargin = axisLabelMargin * relative_ratio
          yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
          ctx.restore()
        };
  
        for (var axis_idx of [...Array(xAxisList.length).keys()]) {
          var new_gap = Math.max(xAxisList[axis_idx].nameGap * relative_ratio, 12);
          if (figsize['height'] < 400) {
            new_gap = Math.min(20, new_gap);
          }
          xAxisList[axis_idx].nameGap = new_gap;
        }
  
        echarts_instance.setOption({
          yAxis: yAxisList,
          xAxis: xAxisList
        })
      }
      else {
        const yAxisList = globalModel.option.yAxis3D
        const xAxisList = globalModel.option.xAxis3D
        const zAxisList = globalModel.option.zAxis3D

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < xAxisList.length) {
            const xAxis = xAxisList[axis_idx]
            const fontSize = xAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = xAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const xAxisComponent = globalModel.getComponent('xAxis3D', axis_idx)?.axis
            if (xAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = xAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            xAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < yAxisList.length) {
            const yAxis = yAxisList[axis_idx]
            const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const yAxisComponent = globalModel.getComponent('yAxis3D', axis_idx)?.axis
            if (yAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < zAxisList.length) {
            const zAxis = zAxisList[axis_idx]
            const fontSize = zAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = zAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const zAxisComponent = globalModel.getComponent('zAxis3D', axis_idx)?.axis
            if (zAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = zAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            zAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };
        echarts_instance.setOption({
          yAxis3D: yAxisList,
          xAxis3D: xAxisList,
          zAxis3D: zAxisList
        });
        }
  
    };

    function custom_scatter_size(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['symbolSize'] === 'array_size') {
          var ind_ = option['series'][ind]['data_dict']['size']
          option['series'][ind]['symbolSize'] = function (data) {return data[ind_];}
        }
      }
      return option;
  
    };

    function show_scatter_label(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['label'] === 'show_label') {
          var ind_ = option['series'][ind]['data_dict']['label']
          option['series'][ind]['label'] = {
            show: true,
            formatter: function (params) {return params.data.value[ind_]; }
          }
        }
      }
      return option;
    };

    function hide_min_max_axis_label(option) {
      for (var ind = 0; ind < option['xAxis3D'].length; ind++) {
        if (option['xAxis3D'][ind]['type'] == 'value') {
          var x_min = option['xAxis3D'][ind]['min']
          var x_max = option['xAxis3D'][ind]['max']
          option['xAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==x_min || value==x_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['yAxis3D'].length; ind++) {
        if (option['yAxis3D'][ind]['type'] == 'value') {  
          var y_min = option['yAxis3D'][ind]['min']
          var y_max = option['yAxis3D'][ind]['max']
          option['yAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==y_min || value==y_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['zAxis3D'].length; ind++) {
        if (option['zAxis3D'][ind]['type'] == 'value') {
          var z_min = option['zAxis3D'][ind]['min']
          var z_max = option['zAxis3D'][ind]['max']
          option['zAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==z_min || value==z_max){}
            else {return value}
          }
       }
      }
      return option;
    }

    function custom_axis_label(option) {
      if (Array.isArray(option['xAxis'])) {
        for (var ind = 0; ind < option['xAxis'].length; ind++) {
          if (option['xAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['xAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['xAxis'][ind]['axisLabel']['formatter_func'].body)
            option['xAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['xAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['xAxis']['axisLabel']['formatter_func'].arguments,
                               option['xAxis']['axisLabel']['formatter_func'].body)
          option['xAxis']['axisLabel']['formatter'] = f
        }
      }
      if (Array.isArray(option['yAxis'])) {
        for (var ind = 0; ind < option['yAxis'].length; ind++) {
          if (option['yAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['yAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['yAxis'][ind]['axisLabel']['formatter_func'].body)
            option['yAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['yAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['yAxis']['axisLabel']['formatter_func'].arguments,
                               option['yAxis']['axisLabel']['formatter_func'].body)
          option['yAxis']['axisLabel']['formatter'] = f
        }
      }
      return option;
    }

    function custom_tooltip(option, dimension=2) {

      if (dimension === 2) {
        var xaxis_key = 'xAxis'
        var yaxis_key = 'yAxis'
      }

      else if (dimension === 3) {
        var xaxis_key = 'xAxis3D'
        var yaxis_key = 'yAxis3D'
        var zaxis_key = 'zAxis3D'
      }

      if (option['radar']) {
        var radar_names = []
        for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
          radar_names.push(option['radar']['indicator'][ind_]['name']) 
        }
      }
  
  
      if (option[xaxis_key]['name'] !== null && option[xaxis_key]['name'] !== '' && Array.isArray(option[xaxis_key])!==true) {
        var xaxis_name = option[xaxis_key]['name'];
      }
      else {
        var xaxis_name = 'X';
      }

      if (option[yaxis_key]['name'] !== null && option[yaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
        var yaxis_name = option[yaxis_key]['name'];
      }
      else {
        var yaxis_name = 'Y';
      }

      if (typeof zaxis_key !== 'undefined') {
        if (option[zaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
          var zaxis_name = option[zaxis_key]['name'];
        }
        else {
          var zaxis_name = 'Z';
        }
      }
  
      if (option['tooltip']) {
        if (option['tooltip']['precision']) {
          var precision = option['tooltip']['precision']
          option['tooltip']['valueFormatter'] = (value) =>  Math.round(Number(value) * (10**precision)) / (10**precision)
        }

        for (var ind_ = 0; ind_ < option['series'].length; ind_++) {
          if (option['series'][ind_]['tooltip']) {
            if (option['series'][ind_]['tooltip']['precision']) {
              var precision = option['series'][ind_]['tooltip']['precision']
              const fix = precision_ => value => Math.round(Number(value) * (10**precision_)) / (10**precision_),
              fix_p = fix(precision);
              option['series'][ind_]['tooltip']['valueFormatter'] = function (value) {
                return fix_p(value)
              } 
            }
          }
        }

        if (option['series'].length === 1) {
          if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][0]['type'])) {
            option['tooltip']['formatter'] = function(params) {
              if (params.seriesName.includes('series')) {
                var series_name = ''
              }
          
              else {
                var series_name = params.seriesName + '<br>'
              }
      
              if (params.seriesType === 'scatter') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                  + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                  +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                }
            
              }
  
              else if (params.seriesType === 'heatmap') {
                formatter = params.name + ', ' + option['yAxis'][0]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
              }
      
              else if (params.seriesType === 'scatter3D') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                    + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                    +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                    +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                }
              }
          
              else if (params.seriesType === 'radar') {
                formatter = params.name  + '<br>';
                for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                  if (ind_ !== option['radar']['indicator'].length - 1) {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                  }
                  else {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                  }
                }
              }
            return formatter;
            }
          }
        }
        else {
          for (var out_ind_ = 0; out_ind_ < option['series'].length; out_ind_++) {
            if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][out_ind_]['type'])) {
              if (option['series'][out_ind_]['tooltip']) {
              }
              else {
                option['series'][out_ind_]['tooltip'] = {}
              }
              option['series'][out_ind_]['tooltip']['formatter'] = function(params) {
                if (params.seriesName.includes('series')) {
                  var series_name = ''
                }
            
                else {
                  var series_name = params.seriesName + '<br>'
                }
        
                if (params.seriesType === 'scatter') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                  }
                }
    
                else if (params.seriesType === 'heatmap') {
                  if ('data' in option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]) {
                    formatter = params.name + ', ' + option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
                  }
                  else {
                    formatter = Math.round(params.data[2] * 10000) / 10000
                  }
                
                }
        
                else if (params.seriesType === 'scatter3D') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                      +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                  }
                }
            
                else if (params.seriesType === 'radar') {
                  formatter = params.name  + '<br>';
                  for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                    if (ind_ !== option['radar']['indicator'].length - 1) {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                    }
                    else {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                    }
                  }
                }
              return formatter;
              }
            }
          }
        }
      }
      return option;
    };

    function support_brush_event(option) {
      if (option['event']['type_'] === 'brushselected') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var last_selected = [];
        bind_chart.on(option['event']['type_'], (params) => {
          var brushed = [];
          var brushComponent = params.batch[0];
          for (var sIdx = 0; sIdx < brushComponent.selected.length; sIdx++) {
            var rawIndices = brushComponent.selected[sIdx].dataIndex;
            brushed.push(rawIndices);
          }
          var brushed_all = brushed[0];

          if (JSON.stringify(last_selected) !== JSON.stringify(brushed_all)) {

            // Update memory
            let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
              method: 'post',
              headers: {
                  'Content-Type': 'application/json;charset=utf-8;',
                  'Access-Control-Allow-Origin':'*',
                  'Access-Control-Allow-Credentials': 'true',
                  'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
              },
              body: JSON.stringify({'js_func_input':{'selected': brushed_all},
                                    'event_id': option['event']['event_id']})
            });
            var dom_dict = {}
            fetch(testRequest).then(response => {
              var result = response.json();
              result.then(res => {
                dom_dict[res['link_id']] = document.getElementById(res['link_id']);
                setInnerHTML(dom_dict[res['link_id']], res['html']);
              });
            });
            last_selected = brushed_all;
          }
                            
        // bind_chart.setOption(option);
        })
      }
      return option;
    };

    function support_click_event(option) {
      if (option['event']['type_'] === 'click') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        if (option['series'][0]['orient'] === 'vertical') {
          var value_idx = 0
        }
        else {
          var value_idx = 1
        }
    

        bind_chart.on(option['event']['type_'], (params) => {
          if (option['event']['task'] === 'singleselect') {
            for (var ind_2 = 0; ind_2 < option['series'][0]['data'].length; ind_2++) {
              if (option['series'][0]['data'][ind_2]['itemStyle']['color'] !== '#1f77b4') {
                option['series'][0]['data'][ind_2]['itemStyle']['color'] = '#1f77b4';
              }
            }
            var idx = option['series'][0]['x_value'].indexOf(params.value[value_idx])
            option['series'][0]['data'][idx]['itemStyle']['color'] = '#ff7f0e';

            var selected = params.value[value_idx];
          }
          else {
            console.log(params);
          }
      
          let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'selected': selected},
                                  'event_id': option['event']['event_id']})
          });
          var dom_dict = {}
          fetch(testRequest).then(response => {
            var result = response.json();
            result.then(res => {
              dom_dict[res['link_id']] = document.getElementById(res['link_id']);
              setInnerHTML(dom_dict[res['link_id']], res['html']);
            });
          });
          bind_chart.setOption(option);
        });
      }
      return option;
    };function support_popup(option, height, width, inner_html) {
      option['toolbox']['feature']['myFeature'] = {
        show: true,
        title: 'Open in new window',
        icon: 'image://http://127.0.0.1:5001/resources/popup_icon',
        onclick: function (){
          var height_ = Math.min(screen.height, Math.round(1.5 * parseInt(height.slice(0,-2))))
          var width_ = Math.min(screen.width, Math.round(1.5 * parseInt(width.slice(0,-2))))
          var left = (screen.width/2)-(width_/2);
          var top = (screen.height/2)-(height_/2);
          var win = window.open('template.html', '_blank',
            `height=${height_}px, width=${width_}px, top=${top}px, left=${left}px`,
          );
          win.document.write(`${inner_html}`);
          win.document.close();
        }
      };
      return option;
    };option = support_popup(option=option, height="600px", width="600px", inner_html=`

            <html lang="en" style="height: 100%; text-align: -webkit-center; align-content: center">
            <title>MoCharts</title>
            <head> <meta charset="utf-8"> </head>
            <body style="height: 100%; margin: 0">
        
        
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"><\/script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts-gl/2.0.8/echarts-gl.min.js"><\/script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"><\/script>
                <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"><\/script>
            

            <div id="1737119429.4012003" style="height: 90%; width: 90%"></div>
            <script type="text/javascript">
                var dom = document.getElementById('1737119429.4012003');
                var myChart = echarts.init(dom, null, {
                    renderer: 'canvas',
                    useDirtyRect: false
                    });
                var app = {};

                var option;
            option = {"chart_id": "1737119429.4012003", "link_id": null, "figname": "", "title": {"show": true, "text": "Density Comparison (PSI = 0.0027)", "link": "", "target": "blank", "textStyle": {"fontStyle": "normal", "fontWeight": "bolder", "fontFamily": "sans-serif", "fontSize": 15, "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "subtext": "", "sublink": "", "subtarget": "blank", "textAlign": "center", "textVerticalAlign": "auto", "padding": 0, "itemGap": 10, "z": 2, "left": "45.0%", "top": "5%", "right": "auto", "bottom": "auto", "backgroundColor": "transparent", "borderColor": "#ccc", "changed_name_key": {"id_": "id"}}, "grid": {"show": true, "width": "auto", "height": "auto", "z": 2, "left": "5%", "top": "10%", "right": "20%", "bottom": "5%", "borderColor": "#ccc", "borderWidth": 1, "containLabel": true, "backgroundColor": "transparent", "changed_name_key": {"id_": "id"}}, "legend": {"show": true, "type": "plain", "width": "auto", "height": "auto", "orient": "vertical", "align": "auto", "itemWidth": 25, "itemHeight": 14, "symbolRotate": "inherit", "selectedMode": true, "padding": 5, "itemGap": 10, "z": 4, "left": "auto", "top": "10%", "right": "1%", "bottom": "auto", "borderColor": "#ccc", "borderWidth": 1, "inactiveColor": "#ccc", "inactiveBorderColor": "#ccc", "inactiveBorderWidth": "auto", "selected": {}, "textStyle": {"overflow": "truncate", "fontSize": 12}, "pageButtonItemGap": 5, "pageButtonPosition": "end", "pageFormatter": "{current}/{total}", "pageIconColor": "#2f4554", "pageIconInactiveColor": "#aaa", "pageIconSize": 15, "animationDurationUpdate": 800, "selectorItemGap": 7, "selectorButtonGap": 10}, "brush": null, "yAxis": [{"show": true, "data": [0.0052178624722770415, 0.028419115680658576, 0.1038879682557188, 0.25489229472424474, 0.4197444118404787, 0.46392727890943225, 0.344153480106419, 0.17136335031183894, 0.05745514711262427, 0.015128942673772211, 0.020072955489263616, 0.09681939318463213, 0.3454599241675757, 0.8289224566087299, 1.3350051079366563, 1.4430753740046967, 1.0469643986215533, 0.5098164590711055, 0.16666816250617106, 0.03710319019490838, 0.009679027068166575, 0.02292201187171301, 0.07832347117719973, 0.183727316609877, 0.28938801428887684, 0.3059339566607275, 0.21707600905878147, 0.10338125845624634, 0.0330816297122892, 0.007516939850636538, 0.004269377679417406, 0.016650344786802274, 0.05660694135202513, 0.129908129546353, 0.20011838089336378, 0.2069070504080857, 0.14358213917853832, 0.06687511532612349, 0.02091140139889981, 0.004451410016538923, 0.001101231647711703, 0.002467838522121789, 0.008061908263613905, 0.018088310290043902, 0.027251283741961563, 0.027556010313738475, 0.01870176613089479, 0.008519024552010757, 0.0026058857266801597, 0.0005493780087532928, 0.0001820440870947277, 0.0005352543415014506, 0.0017289024921683005, 0.003794578098303888, 0.005591075010104124, 0.0055292450799196285, 0.0036700602552503917, 0.0016350052692234874, 0.0004889890883984013, 9.931461204109918e-05, 2.176533820147466e-05, 4.194619408477332e-05, 0.0001304326439643214, 0.0002798901347636394, 0.0004033276634638914, 0.00039009430615711063, 0.0002532320487755826, 0.00011034095076566938, 3.2395697759159795e-05, 7.689994059293085e-06, 1.0261061005203017e-05, 4.4014970712430416e-05, 0.00013747646884173335, 0.00028866496105366655, 0.000406827070258058, 0.00038482442474221273, 0.0002443161525920746, 0.00010410665530447316, 2.9774300582829534e-05, 5.715331222909812e-06, 7.363393359398798e-07, 6.367242053351976e-08, 3.6954003872388188e-09, 1.4396738335942493e-10, 5.106355384311407e-12, 6.555927257421488e-11, 2.1438813675237727e-09, 4.710223606808517e-08, 6.945751132390553e-07, 6.8743821872561975e-06, 4.5665150135185667e-05, 0.00020359769999288345, 0.0006092529021204672, 0.0012236553319980722, 0.0016495191758996474, 0.0014924245747809748, 0.0009062837145674459, 0.00036937944268700015, 0.00010104574464234067, 1.8552399901429463e-05], "type": "value", "position": "bottom", "name": "", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": "auto", "min": -0.64, "max": 2.44, "splitNumber": 5, "logBase": 10, "axisLine": {"show": false}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": 40.0}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "xAxis": [{"show": true, "data": [-1.4777655112529708, -1.377204591833719, -1.276643672414467, -1.1760827529952151, -1.075521833575963, -0.9749609141567113, -0.8743999947374593, -0.7738390753182074, -0.6732781558989555, -0.5727172364797035, -0.4721563170604517, -0.37159539764119964, -0.2710344782219478, -0.17047355880269577, -0.06991263938344394, 0.030648280035808106, 0.13120919945505993, 0.23177011887431176, 0.3323310382935638, 0.43289195771281563, 0.5334528771320675, 0.6340137965513195, 0.7345747159705716, 0.8351356353898236, 0.9356965548090752, 1.0362574742283273, 1.1368183936475793, 1.237379313066831, 1.337940232486083, 1.438501151905335, 1.539062071324587, 1.6396229907438387, 1.7401839101630907, 1.8407448295823428, 1.9413057490015944, 2.0418666684208464, 2.1424275878400985, 2.2429885072593505, 2.343549426678602, 2.444110346097854, 2.5446712655171058, 2.6452321849363583, 2.74579310435561, 2.8463540237748615, 2.946914943194114, 3.0474758626133656, 3.148036782032618, 3.2485977014518697, 3.3491586208711213, 3.4497195402903738, 3.5502804597096254, 3.650841379128877, 3.7514022985481295, 3.851963217967381, 3.9525241373866327, 4.053085056805886, 4.153645976225137, 4.254206895644389, 4.35476781506364, 4.455328734482892, 4.555889653902145, 4.656450573321397, 4.757011492740649, 4.8575724121599, 4.958133331579152, 5.058694250998403, 5.159255170417657, 5.259816089836908, 5.36037700925616, 5.460937928675412, 5.561498848094663, 5.662059767513917, 5.762620686933168, 5.86318160635242, 5.963742525771671, 6.064303445190923, 6.164864364610175, 6.265425284029428, 6.36598620344868, 6.466547122867931, 6.567108042287183, 6.667668961706436, 6.768229881125688, 6.868790800544939, 6.969351719964191, 7.069912639383443, 7.170473558802694, 7.271034478221948, 7.371595397641199, 7.472156317060451, 7.572717236479702, 7.673278155898954, 7.773839075318207, 7.874399994737459, 7.974960914156711, 8.075521833575962, 8.176082752995214, 8.276643672414465, 8.377204591833719, 8.47776551125297], "type": "value", "position": "bottom", "name": "PAY_1", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": 30, "min": -3.4689, "max": 10.4689, "splitNumber": 5, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": null}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "parallelAxis": null, "series": [{"type": "line", "name": "train", "colorBy": "series", "z": 2, "legendHoverLink": true, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "areaStyle": {"opacity": 0.8}, "emphasis": {"focus": "series"}, "seriesLayoutBy": "column", "data": [[-1.3740562315916558, 0.006754886999488502], [-1.2755904491352588, 0.052856652399286705], [-1.1771246666788615, 0.22168403755772442], [-1.0786588842224645, 0.49833615111047586], [-0.9801931017660674, 0.6004316364852998], [-0.8817273193096704, 0.38775547870375265], [-0.7832615368532733, 0.13421638499285032], [-0.6847957543968761, 0.024900923763183105], [-0.5863299719404791, 0.0025054585564912722], [-0.48786418948408206, 0.0010145931700307395], [-0.3893984070276849, 0.01420435030304932], [-0.29093262457128777, 0.12245855096958584], [-0.19246684211489073, 0.56601107647223], [-0.0940010596584937, 1.4022135209059932], [0.004464722797903553, 1.8619009506507982], [0.10293050525430059, 1.3251108173734514], [0.20139628771069762, 0.5054765676028933], [0.29986207016709465, 0.1033482892234142], [0.3983278526234917, 0.011328960979179402], [0.49679363507988894, 0.0007789326064984145], [0.595259417536286, 0.002037130938223996], [0.6937251999926832, 0.01916122174560485], [0.7921909824490803, 0.09760059597747475], [0.8906567649054773, 0.2664666892161119], [0.9891225473618743, 0.3899299543805533], [1.0875883298182714, 0.30583238700062443], [1.1860541122746684, 0.12856819678442302], [1.2845198947310654, 0.028969242367027855], [1.382985677187463, 0.003499974283906709], [1.48145145964386, 0.00027685479080993874], [1.579917242100257, 0.0009924713515954671], [1.678383024556654, 0.010312347937152305], [1.776848807013051, 0.05788818500207063], [1.875314589469448, 0.17417332496363733], [1.973780371925845, 0.2808837181461786], [2.072246154382242, 0.24278658736027758], [2.1707119368386394, 0.11248018407488376], [2.269177719295037, 0.027930619388877875], [2.3676435017514335, 0.0037174789641611357], [2.466109284207831, 0.0002687062517626181], [2.5645750666642275, 8.59641357359381e-05], [2.663040849120625, 0.000875387671026468], [2.7615066315770225, 0.005414237153769955], [2.859972414033419, 0.017952711928679324], [2.9584381964898165, 0.031906284584600826], [3.056903978946213, 0.03039314273179971], [3.1553697614026106, 0.015517729859111649], [3.253835543859007, 0.004246527895012467], [3.3523013263154047, 0.0006228750169960561], [3.450767108771802, 4.947282488319862e-05], [3.5492328912281987, 1.4063202102821312e-05], [3.647698673684596, 0.0001526851103161348], [3.746164456140993, 0.0010406516349359908], [3.8446302385973903, 0.0038027638424320367], [3.943096021053787, 0.007448121934286969], [4.041561803510184, 0.007818931400168986], [4.140027585966582, 0.0043994788094246316], [4.238493368422978, 0.0013268085720317107], [4.336959150879376, 0.00021447336998683876], [4.4354249333357725, 1.869923087036585e-05], [4.53389071579217, 3.940698532853347e-06], [4.6323564982485665, 4.316668710890784e-05], [4.730822280704964, 0.0003241718071671682], [4.829288063161361, 0.0013054803185125327], [4.927753845617758, 0.0028178573277729043], [5.026219628074156, 0.0032600245838691365], [5.124685410530552, 0.0020215102711019835], [5.22315119298695, 0.0006718684305145819], [5.321616975443346, 0.0001196871483772028], [5.420082757899744, 1.1454502714707359e-05], [5.51854854035614, 1.3561701189879649e-06], [5.617014322812538, 1.193222740590942e-05], [5.715480105268934, 9.866924826422214e-05], [5.813945887725332, 0.0004379025789167417], [5.912411670181729, 0.001041663443468075], [6.010877452638126, 0.0013280992996611632], [6.109343235094523, 0.0009075840912927135], [6.20780901755092, 0.0003324270891885287], [6.306274800007317, 6.526204081081644e-05], [6.404740582463714, 6.8806139743517405e-06], [6.5032063649201115, 8.157049152604675e-07], [6.601672147376509, 7.305425828566663e-06], [6.700137929832906, 6.655719160499533e-05], [6.798603712289303, 0.0003255305278779214], [6.8970694947457005, 0.00085338084840421], [6.995535277202096, 0.001199077535302767], [7.094001059658494, 0.0009030355411973637], [7.192466842114891, 0.0003645151846696064], [7.290932624571289, 7.886433575311902e-05], [7.389398407027686, 9.157673616388024e-06], [7.487864189484082, 1.002426074919621e-06], [7.586329971940479, 8.162068052143941e-06], [7.684795754396877, 8.189158589839621e-05], [7.783261536853274, 0.0004414044539096747], [7.88172731930967, 0.0012752317869433544], [7.980193101766067, 0.001974671025494365], [8.078658884222465, 0.001638904246142831], [8.177124666678862, 0.0007290639253158545], [8.27559044913526, 0.00017383244595247353], [8.374056231591656, 2.221515128093145e-05]], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "linear", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "symbol": "none", "coordinateSystem": "cartesian2d", "symbolSize": 4, "symbolOffset": [0, 0], "showSymbol": true, "showAllSymbol": "auto", "smooth": true, "xlim": [-1.3740562315916558, 8.374056231591656], "tooltip_trigger": "item"}, {"type": "line", "name": "test", "colorBy": "series", "z": 2, "legendHoverLink": true, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "areaStyle": {"opacity": 0.8}, "emphasis": {"focus": "series"}, "seriesLayoutBy": "column", "data": [[-1.4777655112529708, 0.0052178624722770415], [-1.377204591833719, 0.028419115680658576], [-1.276643672414467, 0.1038879682557188], [-1.1760827529952151, 0.25489229472424474], [-1.075521833575963, 0.4197444118404787], [-0.9749609141567113, 0.46392727890943225], [-0.8743999947374593, 0.344153480106419], [-0.7738390753182074, 0.17136335031183894], [-0.6732781558989555, 0.05745514711262427], [-0.5727172364797035, 0.015128942673772211], [-0.4721563170604517, 0.020072955489263616], [-0.37159539764119964, 0.09681939318463213], [-0.2710344782219478, 0.3454599241675757], [-0.17047355880269577, 0.8289224566087299], [-0.06991263938344394, 1.3350051079366563], [0.030648280035808106, 1.4430753740046967], [0.13120919945505993, 1.0469643986215533], [0.23177011887431176, 0.5098164590711055], [0.3323310382935638, 0.16666816250617106], [0.43289195771281563, 0.03710319019490838], [0.5334528771320675, 0.009679027068166575], [0.6340137965513195, 0.02292201187171301], [0.7345747159705716, 0.07832347117719973], [0.8351356353898236, 0.183727316609877], [0.9356965548090752, 0.28938801428887684], [1.0362574742283273, 0.3059339566607275], [1.1368183936475793, 0.21707600905878147], [1.237379313066831, 0.10338125845624634], [1.337940232486083, 0.0330816297122892], [1.438501151905335, 0.007516939850636538], [1.539062071324587, 0.004269377679417406], [1.6396229907438387, 0.016650344786802274], [1.7401839101630907, 0.05660694135202513], [1.8407448295823428, 0.129908129546353], [1.9413057490015944, 0.20011838089336378], [2.0418666684208464, 0.2069070504080857], [2.1424275878400985, 0.14358213917853832], [2.2429885072593505, 0.06687511532612349], [2.343549426678602, 0.02091140139889981], [2.444110346097854, 0.004451410016538923], [2.5446712655171058, 0.001101231647711703], [2.6452321849363583, 0.002467838522121789], [2.74579310435561, 0.008061908263613905], [2.8463540237748615, 0.018088310290043902], [2.946914943194114, 0.027251283741961563], [3.0474758626133656, 0.027556010313738475], [3.148036782032618, 0.01870176613089479], [3.2485977014518697, 0.008519024552010757], [3.3491586208711213, 0.0026058857266801597], [3.4497195402903738, 0.0005493780087532928], [3.5502804597096254, 0.0001820440870947277], [3.650841379128877, 0.0005352543415014506], [3.7514022985481295, 0.0017289024921683005], [3.851963217967381, 0.003794578098303888], [3.9525241373866327, 0.005591075010104124], [4.053085056805886, 0.0055292450799196285], [4.153645976225137, 0.0036700602552503917], [4.254206895644389, 0.0016350052692234874], [4.35476781506364, 0.0004889890883984013], [4.455328734482892, 9.931461204109918e-05], [4.555889653902145, 2.176533820147466e-05], [4.656450573321397, 4.194619408477332e-05], [4.757011492740649, 0.0001304326439643214], [4.8575724121599, 0.0002798901347636394], [4.958133331579152, 0.0004033276634638914], [5.058694250998403, 0.00039009430615711063], [5.159255170417657, 0.0002532320487755826], [5.259816089836908, 0.00011034095076566938], [5.36037700925616, 3.2395697759159795e-05], [5.460937928675412, 7.689994059293085e-06], [5.561498848094663, 1.0261061005203017e-05], [5.662059767513917, 4.4014970712430416e-05], [5.762620686933168, 0.00013747646884173335], [5.86318160635242, 0.00028866496105366655], [5.963742525771671, 0.000406827070258058], [6.064303445190923, 0.00038482442474221273], [6.164864364610175, 0.0002443161525920746], [6.265425284029428, 0.00010410665530447316], [6.36598620344868, 2.9774300582829534e-05], [6.466547122867931, 5.715331222909812e-06], [6.567108042287183, 7.363393359398798e-07], [6.667668961706436, 6.367242053351976e-08], [6.768229881125688, 3.6954003872388188e-09], [6.868790800544939, 1.4396738335942493e-10], [6.969351719964191, 5.106355384311407e-12], [7.069912639383443, 6.555927257421488e-11], [7.170473558802694, 2.1438813675237727e-09], [7.271034478221948, 4.710223606808517e-08], [7.371595397641199, 6.945751132390553e-07], [7.472156317060451, 6.8743821872561975e-06], [7.572717236479702, 4.5665150135185667e-05], [7.673278155898954, 0.00020359769999288345], [7.773839075318207, 0.0006092529021204672], [7.874399994737459, 0.0012236553319980722], [7.974960914156711, 0.0016495191758996474], [8.075521833575962, 0.0014924245747809748], [8.176082752995214, 0.0009062837145674459], [8.276643672414465, 0.00036937944268700015], [8.377204591833719, 0.00010104574464234067], [8.47776551125297, 1.8552399901429463e-05]], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "linear", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "symbol": "none", "coordinateSystem": "cartesian2d", "symbolSize": 4, "symbolOffset": [0, 0], "showSymbol": true, "showAllSymbol": "auto", "smooth": true, "xlim": [-1.4777655112529708, 8.47776551125297], "tooltip_trigger": "item"}], "visualMap": null, "toolbox": {"show": true, "orient": "horizontal", "itemSize": 15, "itemGap": 8, "showTitle": true, "feature": {"dataZoom": {}, "saveAsImage": {}}, "z": 2, "left": "auto", "top": "auto", "right": "1%", "bottom": "auto", "width": "auto", "height": "auto", "popup": true, "changed_name_key": {"id_": "id"}}, "tooltip": {"show": true, "custom_tooltip": false, "trigger": "item", "axisPointer": {"show": true}, "showContent": true, "triggerOn": "mousemove|click", "hideDelay": 100, "enterable": true, "renderMode": "html", "confine": true, "transitionDuration": 0.4, "precision": 4, "borderColor": "#333", "padding": 5, "order": "seriesAsc"}, "dataZoom": null, "event": null, "graphic": null, "radar": null, "figsize": {"width": 600, "height": 600}, "color": ["#1f77b4", "#aec7e8", "#ff7f0e", "#ffbb78", "#2ca02c", "#98df8a", "#d62728", "#ff9896", "#9467bd", "#c5b0d5", "#8c564b", "#c49c94", "#e377c2", "#f7b6d2", "#7f7f7f", "#c7c7c7", "#bcbd22", "#dbdb8d", "#17becf", "#9edae5"], "save_img": false, "auto_size": true, "style": {"overflow": "auto"}, "port": "5006"};function setInnerHTML(elm, html) {
      elm.innerHTML = html;
  
      Array.from(elm.querySelectorAll("script"))
        .forEach( oldScriptEl => {
          const newScriptEl = document.createElement("script");
      
          Array.from(oldScriptEl.attributes).forEach( attr => {
            newScriptEl.setAttribute(attr.name, attr.value) 
          });
      
          const scriptText = document.createTextNode(oldScriptEl.innerHTML);
          newScriptEl.appendChild(scriptText);
      
          oldScriptEl.parentNode.replaceChild(newScriptEl, oldScriptEl);
      });
    };

    function getScreenSize(option) {
      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_result_save', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'height': screen.height, 'width': screen.width},
                                  'event_id': 'screen_size'})
          });
          fetch(testRequest).then(response => {});
      return 
    }
    function support_scientific_notation(option) {
      if (Array.isArray(option['yAxis'])) {
        for (var tar_ind = 0; tar_ind < option['yAxis'].length; tar_ind++) {
          if (option['yAxis'][tar_ind]['type'] === 'value') {
            option['yAxis'][tar_ind]['axisLabel']['formatter'] = function(val) {
              const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                        '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                        '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
              function toSuperscript(val) {
                if (val.toString().length > 5 && !val.toString().includes('.')) {
                  val = Number(val).toExponential().toString();
                  if (val.includes('-')) {
                    val = val.split('-');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁻' + val1
                  }
                  else if (val.includes('+')) {
                    val = val.split('+');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁺' + val1
                  }
                }
                else {
                  return val
                }
              }
              return toSuperscript(val)
            }
          }
        }
      }
      else {
        if (option['yAxis']['type'] === 'value') {
          option['yAxis']['axisLabel']['formatter'] = function(val) {
            const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                    '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                    '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
            function toSuperscript(val) {
              if (val.toString().length > 5 && !val.toString().includes('.')) {
                val = Number(val).toExponential().toString();
                if (val.includes('-')) {
                  val = val.split('-');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁻' + val1
                }
                else if (val.includes('+')) {
                  val = val.split('+');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁺' + val1
                }
              }
              else {
                return val
              }
            }
            return toSuperscript(val)
          }
        }
      };
      return option;
    };

    function auto_component_size(option) {
      if (typeof option['figsize']['width'] === 'string' || option['figsize']['width'] instanceof String) {
        if (option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['width'].includes('px')) {
          var width = parseFloat(option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = option['figsize']['width']
      }

      if (typeof option['figsize']['height'] === 'string' || option['figsize']['height'] instanceof String) {
        if (option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['height'].includes('px')) {
          var height = parseFloat(option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height']
      }

      var relative_ratio = Math.min(width / 700, height / 400)
      if ('xAxis3D' in option) {
        var keys = ['xAxis3D', 'yAxis3D', 'zAxis3D']
      }
      else {
        var keys = ['xAxis', 'yAxis']
      }
      for (single_key of keys) {
        for (var ind = 0; ind < option[single_key].length; ind++) {
          option[single_key][ind]['nameTextStyle']['fontSize'] = Math.max(7, option[single_key][ind]['nameTextStyle']['fontSize'] * relative_ratio);
          option[single_key][ind]['axisLabel']['fontSize'] = Math.max(7, option[single_key][ind]['axisLabel']['fontSize'] * relative_ratio);
        }
      }
      if (option['series']) {
        for (var ind = 0; ind < option['series'].length; ind++) {
          if (['heatmap', 'bar'].includes(option['series'][ind]['type'])) {
            if (option['series'][ind]['label']) {
              option['series'][ind]['label']['fontSize'] = Math.max(7, option['series'][ind]['label']['fontSize'] * relative_ratio);
            }
          }
        }
      }
      if (option['title']) {
        if (Array.isArray(option['title'])) {
          for (var ind = 0; ind < option['title'].length; ind++) {
            option['title'][ind]['textStyle']['fontSize'] = Math.max(9, option['title'][ind]['textStyle']['fontSize'] * relative_ratio);
          }
        }
        else {
          option['title']['textStyle']['fontSize'] = Math.max(9, option['title']['textStyle']['fontSize'] * relative_ratio);
        }
      }
      if (option['legend']) {
        option['legend']['itemHeight'] = option['legend']['itemHeight'] * relative_ratio;
        option['legend']['itemWidth'] = option['legend']['itemWidth'] * relative_ratio;
        option['legend']['textStyle']['fontSize'] = Math.max(7, option['legend']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['visualMap']) {
        option['visualMap']['itemHeight'] = option['visualMap']['itemHeight'] * relative_ratio;
        option['visualMap']['itemWidth'] = option['visualMap']['itemWidth'] * relative_ratio;
        option['visualMap']['textStyle']['fontSize'] = Math.max(7, option['visualMap']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['toolbox']) {
        option['toolbox']['itemSize'] = Math.max(8, option['toolbox']['itemSize'] * relative_ratio)
        option['toolbox']['itemGap'] = Math.max(4, option['toolbox']['itemGap'] * relative_ratio);
      }
      if (option['graphic']) {
        for (var ind = 0; ind < option['graphic'].length; ind++) {
          for (var ind2 = 0; ind2 < option['graphic'][ind]['children'].length; ind2++) {
            var new_font = Math.max(7, 12 * relative_ratio);
            option['graphic'][ind]['children'][ind2]['style']['font'] = new_font.toString() + 'px Microsoft YaHei';
          }
        }
      }
      return option;
    }

    function save_img(echarts_instance, option) {
      const base64_str = echarts_instance.getDataURL({
          pixelRatio: 2,
          backgroundColor: '#fff',
          width: option['figsize']['width'],
          height: option['figsize']['height']
      });

      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_image_save', {
        method: 'post',
        headers: {
          'Content-Type': 'application/json;charset=utf-8;',
          'Access-Control-Allow-Origin':'*',
          'Access-Control-Allow-Credentials': 'true',
          'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
        },
        body: JSON.stringify({'figname': option['figname'],
                              'base64_str': base64_str})
      });
      fetch(testRequest).then(response => {});
    };


    function auto_axis_namegap(echarts_instance, auto_axis_list, axis_type) {
      const globalModel = echarts_instance._api.getModel()
      const figsize = globalModel.option.figsize
      const ctx = document.createElement('canvas').getContext('2d')
      if (typeof globalModel.option['figsize']['width'] === 'string' || globalModel.option['figsize']['width'] instanceof String) {
        if (globalModel.option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(globalModel.option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['width'].includes('px')) {
          var width = parseFloat(globalModel.option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = globalModel.option['figsize']['width'];
      }

      if (typeof globalModel.option['figsize']['height'] === 'string' || globalModel.option['figsize']['height'] instanceof String) {
        if (globalModel.option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(globalModel.option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['height'].includes('px')) {
          var height = parseFloat(globalModel.option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height'];
      }
      var relative_ratio = Math.min(width / 700, height / 400);
      if (axis_type==='2d') {
        const yAxisList = globalModel.option.yAxis
        const xAxisList = globalModel.option.xAxis

        for (var axis_idx of auto_axis_list) {
          const yAxis = yAxisList[axis_idx]
          const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
          const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
          ctx.save()
          ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
  
          const yAxisComponent = globalModel.getComponent('yAxis', axis_idx)?.axis
          if (yAxis.type === 'value') {
            var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
          }
          else {
            var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
          }
          var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
          axisLabelMargin = axisLabelMargin * relative_ratio
          yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
          ctx.restore()
        };
  
        for (var axis_idx of [...Array(xAxisList.length).keys()]) {
          var new_gap = Math.max(xAxisList[axis_idx].nameGap * relative_ratio, 12);
          if (figsize['height'] < 400) {
            new_gap = Math.min(20, new_gap);
          }
          xAxisList[axis_idx].nameGap = new_gap;
        }
  
        echarts_instance.setOption({
          yAxis: yAxisList,
          xAxis: xAxisList
        })
      }
      else {
        const yAxisList = globalModel.option.yAxis3D
        const xAxisList = globalModel.option.xAxis3D
        const zAxisList = globalModel.option.zAxis3D

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < xAxisList.length) {
            const xAxis = xAxisList[axis_idx]
            const fontSize = xAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = xAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const xAxisComponent = globalModel.getComponent('xAxis3D', axis_idx)?.axis
            if (xAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = xAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            xAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < yAxisList.length) {
            const yAxis = yAxisList[axis_idx]
            const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const yAxisComponent = globalModel.getComponent('yAxis3D', axis_idx)?.axis
            if (yAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < zAxisList.length) {
            const zAxis = zAxisList[axis_idx]
            const fontSize = zAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = zAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const zAxisComponent = globalModel.getComponent('zAxis3D', axis_idx)?.axis
            if (zAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = zAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            zAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };
        echarts_instance.setOption({
          yAxis3D: yAxisList,
          xAxis3D: xAxisList,
          zAxis3D: zAxisList
        });
        }
  
    };

    function custom_scatter_size(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['symbolSize'] === 'array_size') {
          var ind_ = option['series'][ind]['data_dict']['size']
          option['series'][ind]['symbolSize'] = function (data) {return data[ind_];}
        }
      }
      return option;
  
    };

    function show_scatter_label(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['label'] === 'show_label') {
          var ind_ = option['series'][ind]['data_dict']['label']
          option['series'][ind]['label'] = {
            show: true,
            formatter: function (params) {return params.data.value[ind_]; }
          }
        }
      }
      return option;
    };

    function hide_min_max_axis_label(option) {
      for (var ind = 0; ind < option['xAxis3D'].length; ind++) {
        if (option['xAxis3D'][ind]['type'] == 'value') {
          var x_min = option['xAxis3D'][ind]['min']
          var x_max = option['xAxis3D'][ind]['max']
          option['xAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==x_min || value==x_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['yAxis3D'].length; ind++) {
        if (option['yAxis3D'][ind]['type'] == 'value') {  
          var y_min = option['yAxis3D'][ind]['min']
          var y_max = option['yAxis3D'][ind]['max']
          option['yAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==y_min || value==y_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['zAxis3D'].length; ind++) {
        if (option['zAxis3D'][ind]['type'] == 'value') {
          var z_min = option['zAxis3D'][ind]['min']
          var z_max = option['zAxis3D'][ind]['max']
          option['zAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==z_min || value==z_max){}
            else {return value}
          }
       }
      }
      return option;
    }

    function custom_axis_label(option) {
      if (Array.isArray(option['xAxis'])) {
        for (var ind = 0; ind < option['xAxis'].length; ind++) {
          if (option['xAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['xAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['xAxis'][ind]['axisLabel']['formatter_func'].body)
            option['xAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['xAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['xAxis']['axisLabel']['formatter_func'].arguments,
                               option['xAxis']['axisLabel']['formatter_func'].body)
          option['xAxis']['axisLabel']['formatter'] = f
        }
      }
      if (Array.isArray(option['yAxis'])) {
        for (var ind = 0; ind < option['yAxis'].length; ind++) {
          if (option['yAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['yAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['yAxis'][ind]['axisLabel']['formatter_func'].body)
            option['yAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['yAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['yAxis']['axisLabel']['formatter_func'].arguments,
                               option['yAxis']['axisLabel']['formatter_func'].body)
          option['yAxis']['axisLabel']['formatter'] = f
        }
      }
      return option;
    }

    function custom_tooltip(option, dimension=2) {

      if (dimension === 2) {
        var xaxis_key = 'xAxis'
        var yaxis_key = 'yAxis'
      }

      else if (dimension === 3) {
        var xaxis_key = 'xAxis3D'
        var yaxis_key = 'yAxis3D'
        var zaxis_key = 'zAxis3D'
      }

      if (option['radar']) {
        var radar_names = []
        for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
          radar_names.push(option['radar']['indicator'][ind_]['name']) 
        }
      }
  
  
      if (option[xaxis_key]['name'] !== null && option[xaxis_key]['name'] !== '' && Array.isArray(option[xaxis_key])!==true) {
        var xaxis_name = option[xaxis_key]['name'];
      }
      else {
        var xaxis_name = 'X';
      }

      if (option[yaxis_key]['name'] !== null && option[yaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
        var yaxis_name = option[yaxis_key]['name'];
      }
      else {
        var yaxis_name = 'Y';
      }

      if (typeof zaxis_key !== 'undefined') {
        if (option[zaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
          var zaxis_name = option[zaxis_key]['name'];
        }
        else {
          var zaxis_name = 'Z';
        }
      }
  
      if (option['tooltip']) {
        if (option['tooltip']['precision']) {
          var precision = option['tooltip']['precision']
          option['tooltip']['valueFormatter'] = (value) =>  Math.round(Number(value) * (10**precision)) / (10**precision)
        }

        for (var ind_ = 0; ind_ < option['series'].length; ind_++) {
          if (option['series'][ind_]['tooltip']) {
            if (option['series'][ind_]['tooltip']['precision']) {
              var precision = option['series'][ind_]['tooltip']['precision']
              const fix = precision_ => value => Math.round(Number(value) * (10**precision_)) / (10**precision_),
              fix_p = fix(precision);
              option['series'][ind_]['tooltip']['valueFormatter'] = function (value) {
                return fix_p(value)
              } 
            }
          }
        }

        if (option['series'].length === 1) {
          if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][0]['type'])) {
            option['tooltip']['formatter'] = function(params) {
              if (params.seriesName.includes('series')) {
                var series_name = ''
              }
          
              else {
                var series_name = params.seriesName + '<br>'
              }
      
              if (params.seriesType === 'scatter') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                  + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                  +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                }
            
              }
  
              else if (params.seriesType === 'heatmap') {
                formatter = params.name + ', ' + option['yAxis'][0]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
              }
      
              else if (params.seriesType === 'scatter3D') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                    + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                    +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                    +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                }
              }
          
              else if (params.seriesType === 'radar') {
                formatter = params.name  + '<br>';
                for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                  if (ind_ !== option['radar']['indicator'].length - 1) {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                  }
                  else {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                  }
                }
              }
            return formatter;
            }
          }
        }
        else {
          for (var out_ind_ = 0; out_ind_ < option['series'].length; out_ind_++) {
            if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][out_ind_]['type'])) {
              if (option['series'][out_ind_]['tooltip']) {
              }
              else {
                option['series'][out_ind_]['tooltip'] = {}
              }
              option['series'][out_ind_]['tooltip']['formatter'] = function(params) {
                if (params.seriesName.includes('series')) {
                  var series_name = ''
                }
            
                else {
                  var series_name = params.seriesName + '<br>'
                }
        
                if (params.seriesType === 'scatter') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                  }
                }
    
                else if (params.seriesType === 'heatmap') {
                  if ('data' in option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]) {
                    formatter = params.name + ', ' + option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
                  }
                  else {
                    formatter = Math.round(params.data[2] * 10000) / 10000
                  }
                
                }
        
                else if (params.seriesType === 'scatter3D') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                      +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                  }
                }
            
                else if (params.seriesType === 'radar') {
                  formatter = params.name  + '<br>';
                  for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                    if (ind_ !== option['radar']['indicator'].length - 1) {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                    }
                    else {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                    }
                  }
                }
              return formatter;
              }
            }
          }
        }
      }
      return option;
    };

    function support_brush_event(option) {
      if (option['event']['type_'] === 'brushselected') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var last_selected = [];
        bind_chart.on(option['event']['type_'], (params) => {
          var brushed = [];
          var brushComponent = params.batch[0];
          for (var sIdx = 0; sIdx < brushComponent.selected.length; sIdx++) {
            var rawIndices = brushComponent.selected[sIdx].dataIndex;
            brushed.push(rawIndices);
          }
          var brushed_all = brushed[0];

          if (JSON.stringify(last_selected) !== JSON.stringify(brushed_all)) {

            // Update memory
            let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
              method: 'post',
              headers: {
                  'Content-Type': 'application/json;charset=utf-8;',
                  'Access-Control-Allow-Origin':'*',
                  'Access-Control-Allow-Credentials': 'true',
                  'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
              },
              body: JSON.stringify({'js_func_input':{'selected': brushed_all},
                                    'event_id': option['event']['event_id']})
            });
            var dom_dict = {}
            fetch(testRequest).then(response => {
              var result = response.json();
              result.then(res => {
                dom_dict[res['link_id']] = document.getElementById(res['link_id']);
                setInnerHTML(dom_dict[res['link_id']], res['html']);
              });
            });
            last_selected = brushed_all;
          }
                            
        // bind_chart.setOption(option);
        })
      }
      return option;
    };

    function support_click_event(option) {
      if (option['event']['type_'] === 'click') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        if (option['series'][0]['orient'] === 'vertical') {
          var value_idx = 0
        }
        else {
          var value_idx = 1
        }
    

        bind_chart.on(option['event']['type_'], (params) => {
          if (option['event']['task'] === 'singleselect') {
            for (var ind_2 = 0; ind_2 < option['series'][0]['data'].length; ind_2++) {
              if (option['series'][0]['data'][ind_2]['itemStyle']['color'] !== '#1f77b4') {
                option['series'][0]['data'][ind_2]['itemStyle']['color'] = '#1f77b4';
              }
            }
            var idx = option['series'][0]['x_value'].indexOf(params.value[value_idx])
            option['series'][0]['data'][idx]['itemStyle']['color'] = '#ff7f0e';

            var selected = params.value[value_idx];
          }
          else {
            console.log(params);
          }
      
          let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'selected': selected},
                                  'event_id': option['event']['event_id']})
          });
          var dom_dict = {}
          fetch(testRequest).then(response => {
            var result = response.json();
            result.then(res => {
              dom_dict[res['link_id']] = document.getElementById(res['link_id']);
              setInnerHTML(dom_dict[res['link_id']], res['html']);
            });
          });
          bind_chart.setOption(option);
        });
      }
      return option;
    };option = support_scientific_notation(option=option);option = custom_tooltip(option=option, dimension=2);option = custom_axis_label(option=option);option = auto_component_size(option=option);getScreenSize(option=option);

                myChart.setOption(option);
                window.addEventListener('resize', function () {
                    myChart.resize();
                    var option_copy = JSON.parse(JSON.stringify(option));
                    option_copy['figsize']['height'] = myChart.getHeight();
                    option_copy['figsize']['width'] = myChart.getWidth();
                    // option_copy = auto_component_size(option_copy);
                    myChart.setOption(option_copy);
                });
            <\/script>
            </body>
            </html>
        <style>
    .dg.main.taller-than-window .close-button {
        border-top: 1px solid #ddd;
    }

    .dg.main .close-button {
        background-color: #e8e8e8;
    }
 
    .dg.main .close-button:hover {
        background-color: #ddd;
    }

    .dg {
        color: #555;
        text-shadow: none !important;
    }

    .dg.main::-webkit-scrollbar {
        background: #fafafa;
    }

    .dg.main::-webkit-scrollbar-thumb {
        background: #bbb;
    }
 
    .dg li:not(.folder) {
        background: #fafafa;
        border-bottom: 1px solid #ddd;
    }
 
    .dg li.save-row .button {
        text-shadow: none !important;
    }

    .dg li.title {
        background: #e8e8e8 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;
    }

    .dg .cr.function:hover,.dg .cr.boolean:hover {
        background: #fff;
    }
 
    .dg .c input[type=text] {
        background: #e9e9e9;
    }
 
    .dg .c input[type=text]:hover {
        background: #eee;
    }
 
    .dg .c input[type=text]:focus {
        background: #eee;
        color: #555;
    }
 
    .dg .c .slider {
        background: #e9e9e9;
    }

    .dg .c .slider:hover {
        background: #eee;
    }<\/style>`);option = support_scientific_notation(option=option);option = custom_tooltip(option=option, dimension=2);option = custom_axis_label(option=option);option = auto_component_size(option=option);getScreenSize(option=option);

                if (option && typeof option === 'object') {
                    myChart.setOption(option);
                    }

                auto_axis_namegap(echarts_instance=myChart, auto_axis_list=[0], axis_type="2d");

            </script>
            </body>
            </html>
    
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 31-32

Density difference for variable EDUCATION

.. GENERATED FROM PYTHON SOURCE LINES 32-34

.. code-block:: Python

    results.plot(("density", "EDUCATION"))






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

                <!DOCTYPE html>
                <html lang="en" style="height: 100%">
                <head>
                <meta charset="utf-8">
                </head>
                <body style="height: 100%; margin: 0">

            
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts-gl/2.0.8/echarts-gl.min.js"></script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>
                <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"></script>
            
                <div id="1737119429.4532082" style="height: 600px; width: 600px; overflow: auto"></div>
            
                <script type="text/javascript">
                var dom = document.getElementById('1737119429.4532082');
                dom.innerHTML = ""
                dom.setAttribute('_echarts_instance_', '')
                var myChart = echarts.init(dom, null, {
                    renderer: 'canvas',
                    useDirtyRect: false
                    });
                var app = {};

                var option;
        option = {"chart_id": "1737119429.4532082", "link_id": null, "figname": "", "title": {"show": true, "text": "Density Comparison (PSI = 0.0003)", "link": "", "target": "blank", "textStyle": {"fontStyle": "normal", "fontWeight": "bolder", "fontFamily": "sans-serif", "fontSize": 15, "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "subtext": "", "sublink": "", "subtarget": "blank", "textAlign": "center", "textVerticalAlign": "auto", "padding": 0, "itemGap": 10, "z": 2, "left": "45.0%", "top": "5%", "right": "auto", "bottom": "auto", "backgroundColor": "transparent", "borderColor": "#ccc", "changed_name_key": {"id_": "id"}}, "grid": {"show": true, "width": "auto", "height": "auto", "z": 2, "left": "5%", "top": "10%", "right": "20%", "bottom": "5%", "borderColor": "#ccc", "borderWidth": 1, "containLabel": true, "backgroundColor": "transparent", "changed_name_key": {"id_": "id"}}, "legend": {"show": true, "type": "plain", "width": "auto", "height": "auto", "orient": "vertical", "align": "auto", "itemWidth": 25, "itemHeight": 14, "symbolRotate": "inherit", "selectedMode": true, "padding": 5, "itemGap": 10, "z": 4, "left": "auto", "top": "10%", "right": "1%", "bottom": "auto", "borderColor": "#ccc", "borderWidth": 1, "inactiveColor": "#ccc", "inactiveBorderColor": "#ccc", "inactiveBorderWidth": "auto", "selected": {}, "textStyle": {"overflow": "truncate", "fontSize": 12}, "pageButtonItemGap": 5, "pageButtonPosition": "end", "pageFormatter": "{current}/{total}", "pageIconColor": "#2f4554", "pageIconInactiveColor": "#aaa", "pageIconSize": 15, "animationDurationUpdate": 800, "selectorItemGap": 7, "selectorButtonGap": 10}, "brush": null, "yAxis": [{"show": true, "type": "value", "position": "bottom", "name": "Percentage", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": "auto", "min": -0.1584, "max": 0.6214, "splitNumber": 5, "logBase": 10, "axisLine": {"show": false}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": 40.0}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "xAxis": [{"show": true, "data": ["0.0", "1.0", "2.0", "3.0"], "type": "category", "position": "bottom", "name": "EDUCATION", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": 30, "splitNumber": 5, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": true, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": null}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "parallelAxis": null, "series": [{"type": "bar", "name": "train", "colorBy": "series", "z": 2, "legendHoverLink": true, "stack": "", "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "label": {"show": false, "color": "black", "position": null, "fontSize": 12}, "itemStyle": {}, "seriesLayoutBy": "column", "data": [{"value": ["0.0", 0.015166666666666667], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["1.0", 0.35354166666666664], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["2.0", 0.4675416666666667], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["3.0", 0.16375], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["0.0", 0.015166666666666667], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["1.0", 0.35354166666666664], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["2.0", 0.4675416666666667], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["3.0", 0.16375], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "#1f77b4", "coordinateSystem": "cartesian2d", "showBackground": true, "backgroundStyle": {"color": "rgba(180, 180, 180, 0.2)"}, "barWidth": "45%", "barGap": "0", "barCategoryGap": "20%", "largeThreshold": 400, "progressive": 5000, "progressiveThreshold": 3000, "progressiveChunkMode": "mod", "orient": "vertical", "x_value": ["0.0", "1.0", "2.0", "3.0", "0.0", "1.0", "2.0", "3.0"], "tooltip_type": "axis", "hist": false, "data_value": [["0.0", "0.015166666666666667"], ["1.0", "0.35354166666666664"], ["2.0", "0.4675416666666667"], ["3.0", "0.16375"], ["0.0", "0.015166666666666667"], ["1.0", "0.35354166666666664"], ["2.0", "0.4675416666666667"], ["3.0", "0.16375"]]}, {"type": "bar", "name": "test", "colorBy": "series", "z": 2, "legendHoverLink": true, "stack": "", "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "label": {"show": false, "color": "black", "position": null, "fontSize": 12}, "itemStyle": {}, "seriesLayoutBy": "column", "data": [{"value": ["0.0", 0.017333333333333333], "itemStyle": {"color": "#aec7e8"}, "visualMap": false}, {"value": ["1.0", 0.35], "itemStyle": {"color": "#aec7e8"}, "visualMap": false}, {"value": ["2.0", 0.4681666666666667], "itemStyle": {"color": "#aec7e8"}, "visualMap": false}, {"value": ["3.0", 0.1645], "itemStyle": {"color": "#aec7e8"}, "visualMap": false}, {"value": ["0.0", 0.017333333333333333], "itemStyle": {"color": "#aec7e8"}, "visualMap": false}, {"value": ["1.0", 0.35], "itemStyle": {"color": "#aec7e8"}, "visualMap": false}, {"value": ["2.0", 0.4681666666666667], "itemStyle": {"color": "#aec7e8"}, "visualMap": false}, {"value": ["3.0", 0.1645], "itemStyle": {"color": "#aec7e8"}, "visualMap": false}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "#aec7e8", "coordinateSystem": "cartesian2d", "showBackground": true, "backgroundStyle": {"color": "rgba(180, 180, 180, 0.2)"}, "barWidth": "45%", "barGap": "0", "barCategoryGap": "20%", "largeThreshold": 400, "progressive": 5000, "progressiveThreshold": 3000, "progressiveChunkMode": "mod", "orient": "vertical", "x_value": ["0.0", "1.0", "2.0", "3.0", "0.0", "1.0", "2.0", "3.0"], "tooltip_type": "axis", "hist": false, "data_value": [["0.0", "0.017333333333333333"], ["1.0", "0.35"], ["2.0", "0.4681666666666667"], ["3.0", "0.1645"], ["0.0", "0.017333333333333333"], ["1.0", "0.35"], ["2.0", "0.4681666666666667"], ["3.0", "0.1645"]]}], "visualMap": null, "toolbox": {"show": true, "orient": "horizontal", "itemSize": 15, "itemGap": 8, "showTitle": true, "feature": {"dataZoom": {}, "saveAsImage": {}}, "z": 2, "left": "auto", "top": "auto", "right": "1%", "bottom": "auto", "width": "auto", "height": "auto", "popup": true, "changed_name_key": {"id_": "id"}}, "tooltip": {"show": true, "custom_tooltip": false, "trigger": "item", "axisPointer": {"show": true}, "showContent": true, "triggerOn": "mousemove|click", "hideDelay": 100, "enterable": true, "renderMode": "html", "confine": true, "transitionDuration": 0.4, "precision": 4, "borderColor": "#333", "padding": 5, "order": "seriesAsc"}, "dataZoom": null, "event": null, "graphic": null, "radar": null, "figsize": {"width": 600, "height": 600}, "color": ["#1f77b4", "#aec7e8", "#ff7f0e", "#ffbb78", "#2ca02c", "#98df8a", "#d62728", "#ff9896", "#9467bd", "#c5b0d5", "#8c564b", "#c49c94", "#e377c2", "#f7b6d2", "#7f7f7f", "#c7c7c7", "#bcbd22", "#dbdb8d", "#17becf", "#9edae5"], "save_img": false, "auto_size": true, "style": {"overflow": "auto"}, "port": "5006"};function setInnerHTML(elm, html) {
      elm.innerHTML = html;
  
      Array.from(elm.querySelectorAll("script"))
        .forEach( oldScriptEl => {
          const newScriptEl = document.createElement("script");
      
          Array.from(oldScriptEl.attributes).forEach( attr => {
            newScriptEl.setAttribute(attr.name, attr.value) 
          });
      
          const scriptText = document.createTextNode(oldScriptEl.innerHTML);
          newScriptEl.appendChild(scriptText);
      
          oldScriptEl.parentNode.replaceChild(newScriptEl, oldScriptEl);
      });
    };

    function getScreenSize(option) {
      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_result_save', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'height': screen.height, 'width': screen.width},
                                  'event_id': 'screen_size'})
          });
          fetch(testRequest).then(response => {});
      return 
    }
    function support_scientific_notation(option) {
      if (Array.isArray(option['yAxis'])) {
        for (var tar_ind = 0; tar_ind < option['yAxis'].length; tar_ind++) {
          if (option['yAxis'][tar_ind]['type'] === 'value') {
            option['yAxis'][tar_ind]['axisLabel']['formatter'] = function(val) {
              const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                        '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                        '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
              function toSuperscript(val) {
                if (val.toString().length > 5 && !val.toString().includes('.')) {
                  val = Number(val).toExponential().toString();
                  if (val.includes('-')) {
                    val = val.split('-');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁻' + val1
                  }
                  else if (val.includes('+')) {
                    val = val.split('+');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁺' + val1
                  }
                }
                else {
                  return val
                }
              }
              return toSuperscript(val)
            }
          }
        }
      }
      else {
        if (option['yAxis']['type'] === 'value') {
          option['yAxis']['axisLabel']['formatter'] = function(val) {
            const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                    '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                    '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
            function toSuperscript(val) {
              if (val.toString().length > 5 && !val.toString().includes('.')) {
                val = Number(val).toExponential().toString();
                if (val.includes('-')) {
                  val = val.split('-');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁻' + val1
                }
                else if (val.includes('+')) {
                  val = val.split('+');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁺' + val1
                }
              }
              else {
                return val
              }
            }
            return toSuperscript(val)
          }
        }
      };
      return option;
    };

    function auto_component_size(option) {
      if (typeof option['figsize']['width'] === 'string' || option['figsize']['width'] instanceof String) {
        if (option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['width'].includes('px')) {
          var width = parseFloat(option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = option['figsize']['width']
      }

      if (typeof option['figsize']['height'] === 'string' || option['figsize']['height'] instanceof String) {
        if (option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['height'].includes('px')) {
          var height = parseFloat(option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height']
      }

      var relative_ratio = Math.min(width / 700, height / 400)
      if ('xAxis3D' in option) {
        var keys = ['xAxis3D', 'yAxis3D', 'zAxis3D']
      }
      else {
        var keys = ['xAxis', 'yAxis']
      }
      for (single_key of keys) {
        for (var ind = 0; ind < option[single_key].length; ind++) {
          option[single_key][ind]['nameTextStyle']['fontSize'] = Math.max(7, option[single_key][ind]['nameTextStyle']['fontSize'] * relative_ratio);
          option[single_key][ind]['axisLabel']['fontSize'] = Math.max(7, option[single_key][ind]['axisLabel']['fontSize'] * relative_ratio);
        }
      }
      if (option['series']) {
        for (var ind = 0; ind < option['series'].length; ind++) {
          if (['heatmap', 'bar'].includes(option['series'][ind]['type'])) {
            if (option['series'][ind]['label']) {
              option['series'][ind]['label']['fontSize'] = Math.max(7, option['series'][ind]['label']['fontSize'] * relative_ratio);
            }
          }
        }
      }
      if (option['title']) {
        if (Array.isArray(option['title'])) {
          for (var ind = 0; ind < option['title'].length; ind++) {
            option['title'][ind]['textStyle']['fontSize'] = Math.max(9, option['title'][ind]['textStyle']['fontSize'] * relative_ratio);
          }
        }
        else {
          option['title']['textStyle']['fontSize'] = Math.max(9, option['title']['textStyle']['fontSize'] * relative_ratio);
        }
      }
      if (option['legend']) {
        option['legend']['itemHeight'] = option['legend']['itemHeight'] * relative_ratio;
        option['legend']['itemWidth'] = option['legend']['itemWidth'] * relative_ratio;
        option['legend']['textStyle']['fontSize'] = Math.max(7, option['legend']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['visualMap']) {
        option['visualMap']['itemHeight'] = option['visualMap']['itemHeight'] * relative_ratio;
        option['visualMap']['itemWidth'] = option['visualMap']['itemWidth'] * relative_ratio;
        option['visualMap']['textStyle']['fontSize'] = Math.max(7, option['visualMap']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['toolbox']) {
        option['toolbox']['itemSize'] = Math.max(8, option['toolbox']['itemSize'] * relative_ratio)
        option['toolbox']['itemGap'] = Math.max(4, option['toolbox']['itemGap'] * relative_ratio);
      }
      if (option['graphic']) {
        for (var ind = 0; ind < option['graphic'].length; ind++) {
          for (var ind2 = 0; ind2 < option['graphic'][ind]['children'].length; ind2++) {
            var new_font = Math.max(7, 12 * relative_ratio);
            option['graphic'][ind]['children'][ind2]['style']['font'] = new_font.toString() + 'px Microsoft YaHei';
          }
        }
      }
      return option;
    }

    function save_img(echarts_instance, option) {
      const base64_str = echarts_instance.getDataURL({
          pixelRatio: 2,
          backgroundColor: '#fff',
          width: option['figsize']['width'],
          height: option['figsize']['height']
      });

      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_image_save', {
        method: 'post',
        headers: {
          'Content-Type': 'application/json;charset=utf-8;',
          'Access-Control-Allow-Origin':'*',
          'Access-Control-Allow-Credentials': 'true',
          'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
        },
        body: JSON.stringify({'figname': option['figname'],
                              'base64_str': base64_str})
      });
      fetch(testRequest).then(response => {});
    };


    function auto_axis_namegap(echarts_instance, auto_axis_list, axis_type) {
      const globalModel = echarts_instance._api.getModel()
      const figsize = globalModel.option.figsize
      const ctx = document.createElement('canvas').getContext('2d')
      if (typeof globalModel.option['figsize']['width'] === 'string' || globalModel.option['figsize']['width'] instanceof String) {
        if (globalModel.option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(globalModel.option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['width'].includes('px')) {
          var width = parseFloat(globalModel.option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = globalModel.option['figsize']['width'];
      }

      if (typeof globalModel.option['figsize']['height'] === 'string' || globalModel.option['figsize']['height'] instanceof String) {
        if (globalModel.option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(globalModel.option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['height'].includes('px')) {
          var height = parseFloat(globalModel.option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height'];
      }
      var relative_ratio = Math.min(width / 700, height / 400);
      if (axis_type==='2d') {
        const yAxisList = globalModel.option.yAxis
        const xAxisList = globalModel.option.xAxis

        for (var axis_idx of auto_axis_list) {
          const yAxis = yAxisList[axis_idx]
          const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
          const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
          ctx.save()
          ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
  
          const yAxisComponent = globalModel.getComponent('yAxis', axis_idx)?.axis
          if (yAxis.type === 'value') {
            var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
          }
          else {
            var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
          }
          var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
          axisLabelMargin = axisLabelMargin * relative_ratio
          yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
          ctx.restore()
        };
  
        for (var axis_idx of [...Array(xAxisList.length).keys()]) {
          var new_gap = Math.max(xAxisList[axis_idx].nameGap * relative_ratio, 12);
          if (figsize['height'] < 400) {
            new_gap = Math.min(20, new_gap);
          }
          xAxisList[axis_idx].nameGap = new_gap;
        }
  
        echarts_instance.setOption({
          yAxis: yAxisList,
          xAxis: xAxisList
        })
      }
      else {
        const yAxisList = globalModel.option.yAxis3D
        const xAxisList = globalModel.option.xAxis3D
        const zAxisList = globalModel.option.zAxis3D

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < xAxisList.length) {
            const xAxis = xAxisList[axis_idx]
            const fontSize = xAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = xAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const xAxisComponent = globalModel.getComponent('xAxis3D', axis_idx)?.axis
            if (xAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = xAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            xAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < yAxisList.length) {
            const yAxis = yAxisList[axis_idx]
            const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const yAxisComponent = globalModel.getComponent('yAxis3D', axis_idx)?.axis
            if (yAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < zAxisList.length) {
            const zAxis = zAxisList[axis_idx]
            const fontSize = zAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = zAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const zAxisComponent = globalModel.getComponent('zAxis3D', axis_idx)?.axis
            if (zAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = zAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            zAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };
        echarts_instance.setOption({
          yAxis3D: yAxisList,
          xAxis3D: xAxisList,
          zAxis3D: zAxisList
        });
        }
  
    };

    function custom_scatter_size(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['symbolSize'] === 'array_size') {
          var ind_ = option['series'][ind]['data_dict']['size']
          option['series'][ind]['symbolSize'] = function (data) {return data[ind_];}
        }
      }
      return option;
  
    };

    function show_scatter_label(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['label'] === 'show_label') {
          var ind_ = option['series'][ind]['data_dict']['label']
          option['series'][ind]['label'] = {
            show: true,
            formatter: function (params) {return params.data.value[ind_]; }
          }
        }
      }
      return option;
    };

    function hide_min_max_axis_label(option) {
      for (var ind = 0; ind < option['xAxis3D'].length; ind++) {
        if (option['xAxis3D'][ind]['type'] == 'value') {
          var x_min = option['xAxis3D'][ind]['min']
          var x_max = option['xAxis3D'][ind]['max']
          option['xAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==x_min || value==x_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['yAxis3D'].length; ind++) {
        if (option['yAxis3D'][ind]['type'] == 'value') {  
          var y_min = option['yAxis3D'][ind]['min']
          var y_max = option['yAxis3D'][ind]['max']
          option['yAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==y_min || value==y_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['zAxis3D'].length; ind++) {
        if (option['zAxis3D'][ind]['type'] == 'value') {
          var z_min = option['zAxis3D'][ind]['min']
          var z_max = option['zAxis3D'][ind]['max']
          option['zAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==z_min || value==z_max){}
            else {return value}
          }
       }
      }
      return option;
    }

    function custom_axis_label(option) {
      if (Array.isArray(option['xAxis'])) {
        for (var ind = 0; ind < option['xAxis'].length; ind++) {
          if (option['xAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['xAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['xAxis'][ind]['axisLabel']['formatter_func'].body)
            option['xAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['xAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['xAxis']['axisLabel']['formatter_func'].arguments,
                               option['xAxis']['axisLabel']['formatter_func'].body)
          option['xAxis']['axisLabel']['formatter'] = f
        }
      }
      if (Array.isArray(option['yAxis'])) {
        for (var ind = 0; ind < option['yAxis'].length; ind++) {
          if (option['yAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['yAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['yAxis'][ind]['axisLabel']['formatter_func'].body)
            option['yAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['yAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['yAxis']['axisLabel']['formatter_func'].arguments,
                               option['yAxis']['axisLabel']['formatter_func'].body)
          option['yAxis']['axisLabel']['formatter'] = f
        }
      }
      return option;
    }

    function custom_tooltip(option, dimension=2) {

      if (dimension === 2) {
        var xaxis_key = 'xAxis'
        var yaxis_key = 'yAxis'
      }

      else if (dimension === 3) {
        var xaxis_key = 'xAxis3D'
        var yaxis_key = 'yAxis3D'
        var zaxis_key = 'zAxis3D'
      }

      if (option['radar']) {
        var radar_names = []
        for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
          radar_names.push(option['radar']['indicator'][ind_]['name']) 
        }
      }
  
  
      if (option[xaxis_key]['name'] !== null && option[xaxis_key]['name'] !== '' && Array.isArray(option[xaxis_key])!==true) {
        var xaxis_name = option[xaxis_key]['name'];
      }
      else {
        var xaxis_name = 'X';
      }

      if (option[yaxis_key]['name'] !== null && option[yaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
        var yaxis_name = option[yaxis_key]['name'];
      }
      else {
        var yaxis_name = 'Y';
      }

      if (typeof zaxis_key !== 'undefined') {
        if (option[zaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
          var zaxis_name = option[zaxis_key]['name'];
        }
        else {
          var zaxis_name = 'Z';
        }
      }
  
      if (option['tooltip']) {
        if (option['tooltip']['precision']) {
          var precision = option['tooltip']['precision']
          option['tooltip']['valueFormatter'] = (value) =>  Math.round(Number(value) * (10**precision)) / (10**precision)
        }

        for (var ind_ = 0; ind_ < option['series'].length; ind_++) {
          if (option['series'][ind_]['tooltip']) {
            if (option['series'][ind_]['tooltip']['precision']) {
              var precision = option['series'][ind_]['tooltip']['precision']
              const fix = precision_ => value => Math.round(Number(value) * (10**precision_)) / (10**precision_),
              fix_p = fix(precision);
              option['series'][ind_]['tooltip']['valueFormatter'] = function (value) {
                return fix_p(value)
              } 
            }
          }
        }

        if (option['series'].length === 1) {
          if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][0]['type'])) {
            option['tooltip']['formatter'] = function(params) {
              if (params.seriesName.includes('series')) {
                var series_name = ''
              }
          
              else {
                var series_name = params.seriesName + '<br>'
              }
      
              if (params.seriesType === 'scatter') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                  + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                  +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                }
            
              }
  
              else if (params.seriesType === 'heatmap') {
                formatter = params.name + ', ' + option['yAxis'][0]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
              }
      
              else if (params.seriesType === 'scatter3D') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                    + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                    +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                    +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                }
              }
          
              else if (params.seriesType === 'radar') {
                formatter = params.name  + '<br>';
                for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                  if (ind_ !== option['radar']['indicator'].length - 1) {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                  }
                  else {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                  }
                }
              }
            return formatter;
            }
          }
        }
        else {
          for (var out_ind_ = 0; out_ind_ < option['series'].length; out_ind_++) {
            if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][out_ind_]['type'])) {
              if (option['series'][out_ind_]['tooltip']) {
              }
              else {
                option['series'][out_ind_]['tooltip'] = {}
              }
              option['series'][out_ind_]['tooltip']['formatter'] = function(params) {
                if (params.seriesName.includes('series')) {
                  var series_name = ''
                }
            
                else {
                  var series_name = params.seriesName + '<br>'
                }
        
                if (params.seriesType === 'scatter') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                  }
                }
    
                else if (params.seriesType === 'heatmap') {
                  if ('data' in option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]) {
                    formatter = params.name + ', ' + option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
                  }
                  else {
                    formatter = Math.round(params.data[2] * 10000) / 10000
                  }
                
                }
        
                else if (params.seriesType === 'scatter3D') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                      +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                  }
                }
            
                else if (params.seriesType === 'radar') {
                  formatter = params.name  + '<br>';
                  for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                    if (ind_ !== option['radar']['indicator'].length - 1) {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                    }
                    else {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                    }
                  }
                }
              return formatter;
              }
            }
          }
        }
      }
      return option;
    };

    function support_brush_event(option) {
      if (option['event']['type_'] === 'brushselected') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var last_selected = [];
        bind_chart.on(option['event']['type_'], (params) => {
          var brushed = [];
          var brushComponent = params.batch[0];
          for (var sIdx = 0; sIdx < brushComponent.selected.length; sIdx++) {
            var rawIndices = brushComponent.selected[sIdx].dataIndex;
            brushed.push(rawIndices);
          }
          var brushed_all = brushed[0];

          if (JSON.stringify(last_selected) !== JSON.stringify(brushed_all)) {

            // Update memory
            let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
              method: 'post',
              headers: {
                  'Content-Type': 'application/json;charset=utf-8;',
                  'Access-Control-Allow-Origin':'*',
                  'Access-Control-Allow-Credentials': 'true',
                  'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
              },
              body: JSON.stringify({'js_func_input':{'selected': brushed_all},
                                    'event_id': option['event']['event_id']})
            });
            var dom_dict = {}
            fetch(testRequest).then(response => {
              var result = response.json();
              result.then(res => {
                dom_dict[res['link_id']] = document.getElementById(res['link_id']);
                setInnerHTML(dom_dict[res['link_id']], res['html']);
              });
            });
            last_selected = brushed_all;
          }
                            
        // bind_chart.setOption(option);
        })
      }
      return option;
    };

    function support_click_event(option) {
      if (option['event']['type_'] === 'click') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        if (option['series'][0]['orient'] === 'vertical') {
          var value_idx = 0
        }
        else {
          var value_idx = 1
        }
    

        bind_chart.on(option['event']['type_'], (params) => {
          if (option['event']['task'] === 'singleselect') {
            for (var ind_2 = 0; ind_2 < option['series'][0]['data'].length; ind_2++) {
              if (option['series'][0]['data'][ind_2]['itemStyle']['color'] !== '#1f77b4') {
                option['series'][0]['data'][ind_2]['itemStyle']['color'] = '#1f77b4';
              }
            }
            var idx = option['series'][0]['x_value'].indexOf(params.value[value_idx])
            option['series'][0]['data'][idx]['itemStyle']['color'] = '#ff7f0e';

            var selected = params.value[value_idx];
          }
          else {
            console.log(params);
          }
      
          let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'selected': selected},
                                  'event_id': option['event']['event_id']})
          });
          var dom_dict = {}
          fetch(testRequest).then(response => {
            var result = response.json();
            result.then(res => {
              dom_dict[res['link_id']] = document.getElementById(res['link_id']);
              setInnerHTML(dom_dict[res['link_id']], res['html']);
            });
          });
          bind_chart.setOption(option);
        });
      }
      return option;
    };function support_popup(option, height, width, inner_html) {
      option['toolbox']['feature']['myFeature'] = {
        show: true,
        title: 'Open in new window',
        icon: 'image://http://127.0.0.1:5001/resources/popup_icon',
        onclick: function (){
          var height_ = Math.min(screen.height, Math.round(1.5 * parseInt(height.slice(0,-2))))
          var width_ = Math.min(screen.width, Math.round(1.5 * parseInt(width.slice(0,-2))))
          var left = (screen.width/2)-(width_/2);
          var top = (screen.height/2)-(height_/2);
          var win = window.open('template.html', '_blank',
            `height=${height_}px, width=${width_}px, top=${top}px, left=${left}px`,
          );
          win.document.write(`${inner_html}`);
          win.document.close();
        }
      };
      return option;
    };option = support_popup(option=option, height="600px", width="600px", inner_html=`

            <html lang="en" style="height: 100%; text-align: -webkit-center; align-content: center">
            <title>MoCharts</title>
            <head> <meta charset="utf-8"> </head>
            <body style="height: 100%; margin: 0">
        
        
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"><\/script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts-gl/2.0.8/echarts-gl.min.js"><\/script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"><\/script>
                <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"><\/script>
            

            <div id="1737119429.4532082" style="height: 90%; width: 90%"></div>
            <script type="text/javascript">
                var dom = document.getElementById('1737119429.4532082');
                var myChart = echarts.init(dom, null, {
                    renderer: 'canvas',
                    useDirtyRect: false
                    });
                var app = {};

                var option;
            option = {"chart_id": "1737119429.4532082", "link_id": null, "figname": "", "title": {"show": true, "text": "Density Comparison (PSI = 0.0003)", "link": "", "target": "blank", "textStyle": {"fontStyle": "normal", "fontWeight": "bolder", "fontFamily": "sans-serif", "fontSize": 15, "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "subtext": "", "sublink": "", "subtarget": "blank", "textAlign": "center", "textVerticalAlign": "auto", "padding": 0, "itemGap": 10, "z": 2, "left": "45.0%", "top": "5%", "right": "auto", "bottom": "auto", "backgroundColor": "transparent", "borderColor": "#ccc", "changed_name_key": {"id_": "id"}}, "grid": {"show": true, "width": "auto", "height": "auto", "z": 2, "left": "5%", "top": "10%", "right": "20%", "bottom": "5%", "borderColor": "#ccc", "borderWidth": 1, "containLabel": true, "backgroundColor": "transparent", "changed_name_key": {"id_": "id"}}, "legend": {"show": true, "type": "plain", "width": "auto", "height": "auto", "orient": "vertical", "align": "auto", "itemWidth": 25, "itemHeight": 14, "symbolRotate": "inherit", "selectedMode": true, "padding": 5, "itemGap": 10, "z": 4, "left": "auto", "top": "10%", "right": "1%", "bottom": "auto", "borderColor": "#ccc", "borderWidth": 1, "inactiveColor": "#ccc", "inactiveBorderColor": "#ccc", "inactiveBorderWidth": "auto", "selected": {}, "textStyle": {"overflow": "truncate", "fontSize": 12}, "pageButtonItemGap": 5, "pageButtonPosition": "end", "pageFormatter": "{current}/{total}", "pageIconColor": "#2f4554", "pageIconInactiveColor": "#aaa", "pageIconSize": 15, "animationDurationUpdate": 800, "selectorItemGap": 7, "selectorButtonGap": 10}, "brush": null, "yAxis": [{"show": true, "type": "value", "position": "bottom", "name": "Percentage", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": "auto", "min": -0.1584, "max": 0.6214, "splitNumber": 5, "logBase": 10, "axisLine": {"show": false}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": 40.0}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "xAxis": [{"show": true, "data": ["0.0", "1.0", "2.0", "3.0"], "type": "category", "position": "bottom", "name": "EDUCATION", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": 30, "splitNumber": 5, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": true, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": null}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "parallelAxis": null, "series": [{"type": "bar", "name": "train", "colorBy": "series", "z": 2, "legendHoverLink": true, "stack": "", "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "label": {"show": false, "color": "black", "position": null, "fontSize": 12}, "itemStyle": {}, "seriesLayoutBy": "column", "data": [{"value": ["0.0", 0.015166666666666667], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["1.0", 0.35354166666666664], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["2.0", 0.4675416666666667], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["3.0", 0.16375], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["0.0", 0.015166666666666667], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["1.0", 0.35354166666666664], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["2.0", 0.4675416666666667], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["3.0", 0.16375], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "#1f77b4", "coordinateSystem": "cartesian2d", "showBackground": true, "backgroundStyle": {"color": "rgba(180, 180, 180, 0.2)"}, "barWidth": "45%", "barGap": "0", "barCategoryGap": "20%", "largeThreshold": 400, "progressive": 5000, "progressiveThreshold": 3000, "progressiveChunkMode": "mod", "orient": "vertical", "x_value": ["0.0", "1.0", "2.0", "3.0", "0.0", "1.0", "2.0", "3.0"], "tooltip_type": "axis", "hist": false, "data_value": [["0.0", "0.015166666666666667"], ["1.0", "0.35354166666666664"], ["2.0", "0.4675416666666667"], ["3.0", "0.16375"], ["0.0", "0.015166666666666667"], ["1.0", "0.35354166666666664"], ["2.0", "0.4675416666666667"], ["3.0", "0.16375"]]}, {"type": "bar", "name": "test", "colorBy": "series", "z": 2, "legendHoverLink": true, "stack": "", "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "label": {"show": false, "color": "black", "position": null, "fontSize": 12}, "itemStyle": {}, "seriesLayoutBy": "column", "data": [{"value": ["0.0", 0.017333333333333333], "itemStyle": {"color": "#aec7e8"}, "visualMap": false}, {"value": ["1.0", 0.35], "itemStyle": {"color": "#aec7e8"}, "visualMap": false}, {"value": ["2.0", 0.4681666666666667], "itemStyle": {"color": "#aec7e8"}, "visualMap": false}, {"value": ["3.0", 0.1645], "itemStyle": {"color": "#aec7e8"}, "visualMap": false}, {"value": ["0.0", 0.017333333333333333], "itemStyle": {"color": "#aec7e8"}, "visualMap": false}, {"value": ["1.0", 0.35], "itemStyle": {"color": "#aec7e8"}, "visualMap": false}, {"value": ["2.0", 0.4681666666666667], "itemStyle": {"color": "#aec7e8"}, "visualMap": false}, {"value": ["3.0", 0.1645], "itemStyle": {"color": "#aec7e8"}, "visualMap": false}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "#aec7e8", "coordinateSystem": "cartesian2d", "showBackground": true, "backgroundStyle": {"color": "rgba(180, 180, 180, 0.2)"}, "barWidth": "45%", "barGap": "0", "barCategoryGap": "20%", "largeThreshold": 400, "progressive": 5000, "progressiveThreshold": 3000, "progressiveChunkMode": "mod", "orient": "vertical", "x_value": ["0.0", "1.0", "2.0", "3.0", "0.0", "1.0", "2.0", "3.0"], "tooltip_type": "axis", "hist": false, "data_value": [["0.0", "0.017333333333333333"], ["1.0", "0.35"], ["2.0", "0.4681666666666667"], ["3.0", "0.1645"], ["0.0", "0.017333333333333333"], ["1.0", "0.35"], ["2.0", "0.4681666666666667"], ["3.0", "0.1645"]]}], "visualMap": null, "toolbox": {"show": true, "orient": "horizontal", "itemSize": 15, "itemGap": 8, "showTitle": true, "feature": {"dataZoom": {}, "saveAsImage": {}}, "z": 2, "left": "auto", "top": "auto", "right": "1%", "bottom": "auto", "width": "auto", "height": "auto", "popup": true, "changed_name_key": {"id_": "id"}}, "tooltip": {"show": true, "custom_tooltip": false, "trigger": "item", "axisPointer": {"show": true}, "showContent": true, "triggerOn": "mousemove|click", "hideDelay": 100, "enterable": true, "renderMode": "html", "confine": true, "transitionDuration": 0.4, "precision": 4, "borderColor": "#333", "padding": 5, "order": "seriesAsc"}, "dataZoom": null, "event": null, "graphic": null, "radar": null, "figsize": {"width": 600, "height": 600}, "color": ["#1f77b4", "#aec7e8", "#ff7f0e", "#ffbb78", "#2ca02c", "#98df8a", "#d62728", "#ff9896", "#9467bd", "#c5b0d5", "#8c564b", "#c49c94", "#e377c2", "#f7b6d2", "#7f7f7f", "#c7c7c7", "#bcbd22", "#dbdb8d", "#17becf", "#9edae5"], "save_img": false, "auto_size": true, "style": {"overflow": "auto"}, "port": "5006"};function setInnerHTML(elm, html) {
      elm.innerHTML = html;
  
      Array.from(elm.querySelectorAll("script"))
        .forEach( oldScriptEl => {
          const newScriptEl = document.createElement("script");
      
          Array.from(oldScriptEl.attributes).forEach( attr => {
            newScriptEl.setAttribute(attr.name, attr.value) 
          });
      
          const scriptText = document.createTextNode(oldScriptEl.innerHTML);
          newScriptEl.appendChild(scriptText);
      
          oldScriptEl.parentNode.replaceChild(newScriptEl, oldScriptEl);
      });
    };

    function getScreenSize(option) {
      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_result_save', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'height': screen.height, 'width': screen.width},
                                  'event_id': 'screen_size'})
          });
          fetch(testRequest).then(response => {});
      return 
    }
    function support_scientific_notation(option) {
      if (Array.isArray(option['yAxis'])) {
        for (var tar_ind = 0; tar_ind < option['yAxis'].length; tar_ind++) {
          if (option['yAxis'][tar_ind]['type'] === 'value') {
            option['yAxis'][tar_ind]['axisLabel']['formatter'] = function(val) {
              const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                        '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                        '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
              function toSuperscript(val) {
                if (val.toString().length > 5 && !val.toString().includes('.')) {
                  val = Number(val).toExponential().toString();
                  if (val.includes('-')) {
                    val = val.split('-');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁻' + val1
                  }
                  else if (val.includes('+')) {
                    val = val.split('+');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁺' + val1
                  }
                }
                else {
                  return val
                }
              }
              return toSuperscript(val)
            }
          }
        }
      }
      else {
        if (option['yAxis']['type'] === 'value') {
          option['yAxis']['axisLabel']['formatter'] = function(val) {
            const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                    '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                    '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
            function toSuperscript(val) {
              if (val.toString().length > 5 && !val.toString().includes('.')) {
                val = Number(val).toExponential().toString();
                if (val.includes('-')) {
                  val = val.split('-');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁻' + val1
                }
                else if (val.includes('+')) {
                  val = val.split('+');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁺' + val1
                }
              }
              else {
                return val
              }
            }
            return toSuperscript(val)
          }
        }
      };
      return option;
    };

    function auto_component_size(option) {
      if (typeof option['figsize']['width'] === 'string' || option['figsize']['width'] instanceof String) {
        if (option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['width'].includes('px')) {
          var width = parseFloat(option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = option['figsize']['width']
      }

      if (typeof option['figsize']['height'] === 'string' || option['figsize']['height'] instanceof String) {
        if (option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['height'].includes('px')) {
          var height = parseFloat(option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height']
      }

      var relative_ratio = Math.min(width / 700, height / 400)
      if ('xAxis3D' in option) {
        var keys = ['xAxis3D', 'yAxis3D', 'zAxis3D']
      }
      else {
        var keys = ['xAxis', 'yAxis']
      }
      for (single_key of keys) {
        for (var ind = 0; ind < option[single_key].length; ind++) {
          option[single_key][ind]['nameTextStyle']['fontSize'] = Math.max(7, option[single_key][ind]['nameTextStyle']['fontSize'] * relative_ratio);
          option[single_key][ind]['axisLabel']['fontSize'] = Math.max(7, option[single_key][ind]['axisLabel']['fontSize'] * relative_ratio);
        }
      }
      if (option['series']) {
        for (var ind = 0; ind < option['series'].length; ind++) {
          if (['heatmap', 'bar'].includes(option['series'][ind]['type'])) {
            if (option['series'][ind]['label']) {
              option['series'][ind]['label']['fontSize'] = Math.max(7, option['series'][ind]['label']['fontSize'] * relative_ratio);
            }
          }
        }
      }
      if (option['title']) {
        if (Array.isArray(option['title'])) {
          for (var ind = 0; ind < option['title'].length; ind++) {
            option['title'][ind]['textStyle']['fontSize'] = Math.max(9, option['title'][ind]['textStyle']['fontSize'] * relative_ratio);
          }
        }
        else {
          option['title']['textStyle']['fontSize'] = Math.max(9, option['title']['textStyle']['fontSize'] * relative_ratio);
        }
      }
      if (option['legend']) {
        option['legend']['itemHeight'] = option['legend']['itemHeight'] * relative_ratio;
        option['legend']['itemWidth'] = option['legend']['itemWidth'] * relative_ratio;
        option['legend']['textStyle']['fontSize'] = Math.max(7, option['legend']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['visualMap']) {
        option['visualMap']['itemHeight'] = option['visualMap']['itemHeight'] * relative_ratio;
        option['visualMap']['itemWidth'] = option['visualMap']['itemWidth'] * relative_ratio;
        option['visualMap']['textStyle']['fontSize'] = Math.max(7, option['visualMap']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['toolbox']) {
        option['toolbox']['itemSize'] = Math.max(8, option['toolbox']['itemSize'] * relative_ratio)
        option['toolbox']['itemGap'] = Math.max(4, option['toolbox']['itemGap'] * relative_ratio);
      }
      if (option['graphic']) {
        for (var ind = 0; ind < option['graphic'].length; ind++) {
          for (var ind2 = 0; ind2 < option['graphic'][ind]['children'].length; ind2++) {
            var new_font = Math.max(7, 12 * relative_ratio);
            option['graphic'][ind]['children'][ind2]['style']['font'] = new_font.toString() + 'px Microsoft YaHei';
          }
        }
      }
      return option;
    }

    function save_img(echarts_instance, option) {
      const base64_str = echarts_instance.getDataURL({
          pixelRatio: 2,
          backgroundColor: '#fff',
          width: option['figsize']['width'],
          height: option['figsize']['height']
      });

      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_image_save', {
        method: 'post',
        headers: {
          'Content-Type': 'application/json;charset=utf-8;',
          'Access-Control-Allow-Origin':'*',
          'Access-Control-Allow-Credentials': 'true',
          'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
        },
        body: JSON.stringify({'figname': option['figname'],
                              'base64_str': base64_str})
      });
      fetch(testRequest).then(response => {});
    };


    function auto_axis_namegap(echarts_instance, auto_axis_list, axis_type) {
      const globalModel = echarts_instance._api.getModel()
      const figsize = globalModel.option.figsize
      const ctx = document.createElement('canvas').getContext('2d')
      if (typeof globalModel.option['figsize']['width'] === 'string' || globalModel.option['figsize']['width'] instanceof String) {
        if (globalModel.option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(globalModel.option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['width'].includes('px')) {
          var width = parseFloat(globalModel.option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = globalModel.option['figsize']['width'];
      }

      if (typeof globalModel.option['figsize']['height'] === 'string' || globalModel.option['figsize']['height'] instanceof String) {
        if (globalModel.option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(globalModel.option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['height'].includes('px')) {
          var height = parseFloat(globalModel.option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height'];
      }
      var relative_ratio = Math.min(width / 700, height / 400);
      if (axis_type==='2d') {
        const yAxisList = globalModel.option.yAxis
        const xAxisList = globalModel.option.xAxis

        for (var axis_idx of auto_axis_list) {
          const yAxis = yAxisList[axis_idx]
          const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
          const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
          ctx.save()
          ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
  
          const yAxisComponent = globalModel.getComponent('yAxis', axis_idx)?.axis
          if (yAxis.type === 'value') {
            var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
          }
          else {
            var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
          }
          var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
          axisLabelMargin = axisLabelMargin * relative_ratio
          yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
          ctx.restore()
        };
  
        for (var axis_idx of [...Array(xAxisList.length).keys()]) {
          var new_gap = Math.max(xAxisList[axis_idx].nameGap * relative_ratio, 12);
          if (figsize['height'] < 400) {
            new_gap = Math.min(20, new_gap);
          }
          xAxisList[axis_idx].nameGap = new_gap;
        }
  
        echarts_instance.setOption({
          yAxis: yAxisList,
          xAxis: xAxisList
        })
      }
      else {
        const yAxisList = globalModel.option.yAxis3D
        const xAxisList = globalModel.option.xAxis3D
        const zAxisList = globalModel.option.zAxis3D

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < xAxisList.length) {
            const xAxis = xAxisList[axis_idx]
            const fontSize = xAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = xAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const xAxisComponent = globalModel.getComponent('xAxis3D', axis_idx)?.axis
            if (xAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = xAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            xAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < yAxisList.length) {
            const yAxis = yAxisList[axis_idx]
            const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const yAxisComponent = globalModel.getComponent('yAxis3D', axis_idx)?.axis
            if (yAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < zAxisList.length) {
            const zAxis = zAxisList[axis_idx]
            const fontSize = zAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = zAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const zAxisComponent = globalModel.getComponent('zAxis3D', axis_idx)?.axis
            if (zAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = zAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            zAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };
        echarts_instance.setOption({
          yAxis3D: yAxisList,
          xAxis3D: xAxisList,
          zAxis3D: zAxisList
        });
        }
  
    };

    function custom_scatter_size(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['symbolSize'] === 'array_size') {
          var ind_ = option['series'][ind]['data_dict']['size']
          option['series'][ind]['symbolSize'] = function (data) {return data[ind_];}
        }
      }
      return option;
  
    };

    function show_scatter_label(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['label'] === 'show_label') {
          var ind_ = option['series'][ind]['data_dict']['label']
          option['series'][ind]['label'] = {
            show: true,
            formatter: function (params) {return params.data.value[ind_]; }
          }
        }
      }
      return option;
    };

    function hide_min_max_axis_label(option) {
      for (var ind = 0; ind < option['xAxis3D'].length; ind++) {
        if (option['xAxis3D'][ind]['type'] == 'value') {
          var x_min = option['xAxis3D'][ind]['min']
          var x_max = option['xAxis3D'][ind]['max']
          option['xAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==x_min || value==x_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['yAxis3D'].length; ind++) {
        if (option['yAxis3D'][ind]['type'] == 'value') {  
          var y_min = option['yAxis3D'][ind]['min']
          var y_max = option['yAxis3D'][ind]['max']
          option['yAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==y_min || value==y_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['zAxis3D'].length; ind++) {
        if (option['zAxis3D'][ind]['type'] == 'value') {
          var z_min = option['zAxis3D'][ind]['min']
          var z_max = option['zAxis3D'][ind]['max']
          option['zAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==z_min || value==z_max){}
            else {return value}
          }
       }
      }
      return option;
    }

    function custom_axis_label(option) {
      if (Array.isArray(option['xAxis'])) {
        for (var ind = 0; ind < option['xAxis'].length; ind++) {
          if (option['xAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['xAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['xAxis'][ind]['axisLabel']['formatter_func'].body)
            option['xAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['xAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['xAxis']['axisLabel']['formatter_func'].arguments,
                               option['xAxis']['axisLabel']['formatter_func'].body)
          option['xAxis']['axisLabel']['formatter'] = f
        }
      }
      if (Array.isArray(option['yAxis'])) {
        for (var ind = 0; ind < option['yAxis'].length; ind++) {
          if (option['yAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['yAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['yAxis'][ind]['axisLabel']['formatter_func'].body)
            option['yAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['yAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['yAxis']['axisLabel']['formatter_func'].arguments,
                               option['yAxis']['axisLabel']['formatter_func'].body)
          option['yAxis']['axisLabel']['formatter'] = f
        }
      }
      return option;
    }

    function custom_tooltip(option, dimension=2) {

      if (dimension === 2) {
        var xaxis_key = 'xAxis'
        var yaxis_key = 'yAxis'
      }

      else if (dimension === 3) {
        var xaxis_key = 'xAxis3D'
        var yaxis_key = 'yAxis3D'
        var zaxis_key = 'zAxis3D'
      }

      if (option['radar']) {
        var radar_names = []
        for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
          radar_names.push(option['radar']['indicator'][ind_]['name']) 
        }
      }
  
  
      if (option[xaxis_key]['name'] !== null && option[xaxis_key]['name'] !== '' && Array.isArray(option[xaxis_key])!==true) {
        var xaxis_name = option[xaxis_key]['name'];
      }
      else {
        var xaxis_name = 'X';
      }

      if (option[yaxis_key]['name'] !== null && option[yaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
        var yaxis_name = option[yaxis_key]['name'];
      }
      else {
        var yaxis_name = 'Y';
      }

      if (typeof zaxis_key !== 'undefined') {
        if (option[zaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
          var zaxis_name = option[zaxis_key]['name'];
        }
        else {
          var zaxis_name = 'Z';
        }
      }
  
      if (option['tooltip']) {
        if (option['tooltip']['precision']) {
          var precision = option['tooltip']['precision']
          option['tooltip']['valueFormatter'] = (value) =>  Math.round(Number(value) * (10**precision)) / (10**precision)
        }

        for (var ind_ = 0; ind_ < option['series'].length; ind_++) {
          if (option['series'][ind_]['tooltip']) {
            if (option['series'][ind_]['tooltip']['precision']) {
              var precision = option['series'][ind_]['tooltip']['precision']
              const fix = precision_ => value => Math.round(Number(value) * (10**precision_)) / (10**precision_),
              fix_p = fix(precision);
              option['series'][ind_]['tooltip']['valueFormatter'] = function (value) {
                return fix_p(value)
              } 
            }
          }
        }

        if (option['series'].length === 1) {
          if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][0]['type'])) {
            option['tooltip']['formatter'] = function(params) {
              if (params.seriesName.includes('series')) {
                var series_name = ''
              }
          
              else {
                var series_name = params.seriesName + '<br>'
              }
      
              if (params.seriesType === 'scatter') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                  + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                  +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                }
            
              }
  
              else if (params.seriesType === 'heatmap') {
                formatter = params.name + ', ' + option['yAxis'][0]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
              }
      
              else if (params.seriesType === 'scatter3D') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                    + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                    +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                    +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                }
              }
          
              else if (params.seriesType === 'radar') {
                formatter = params.name  + '<br>';
                for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                  if (ind_ !== option['radar']['indicator'].length - 1) {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                  }
                  else {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                  }
                }
              }
            return formatter;
            }
          }
        }
        else {
          for (var out_ind_ = 0; out_ind_ < option['series'].length; out_ind_++) {
            if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][out_ind_]['type'])) {
              if (option['series'][out_ind_]['tooltip']) {
              }
              else {
                option['series'][out_ind_]['tooltip'] = {}
              }
              option['series'][out_ind_]['tooltip']['formatter'] = function(params) {
                if (params.seriesName.includes('series')) {
                  var series_name = ''
                }
            
                else {
                  var series_name = params.seriesName + '<br>'
                }
        
                if (params.seriesType === 'scatter') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                  }
                }
    
                else if (params.seriesType === 'heatmap') {
                  if ('data' in option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]) {
                    formatter = params.name + ', ' + option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
                  }
                  else {
                    formatter = Math.round(params.data[2] * 10000) / 10000
                  }
                
                }
        
                else if (params.seriesType === 'scatter3D') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                      +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                  }
                }
            
                else if (params.seriesType === 'radar') {
                  formatter = params.name  + '<br>';
                  for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                    if (ind_ !== option['radar']['indicator'].length - 1) {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                    }
                    else {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                    }
                  }
                }
              return formatter;
              }
            }
          }
        }
      }
      return option;
    };

    function support_brush_event(option) {
      if (option['event']['type_'] === 'brushselected') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var last_selected = [];
        bind_chart.on(option['event']['type_'], (params) => {
          var brushed = [];
          var brushComponent = params.batch[0];
          for (var sIdx = 0; sIdx < brushComponent.selected.length; sIdx++) {
            var rawIndices = brushComponent.selected[sIdx].dataIndex;
            brushed.push(rawIndices);
          }
          var brushed_all = brushed[0];

          if (JSON.stringify(last_selected) !== JSON.stringify(brushed_all)) {

            // Update memory
            let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
              method: 'post',
              headers: {
                  'Content-Type': 'application/json;charset=utf-8;',
                  'Access-Control-Allow-Origin':'*',
                  'Access-Control-Allow-Credentials': 'true',
                  'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
              },
              body: JSON.stringify({'js_func_input':{'selected': brushed_all},
                                    'event_id': option['event']['event_id']})
            });
            var dom_dict = {}
            fetch(testRequest).then(response => {
              var result = response.json();
              result.then(res => {
                dom_dict[res['link_id']] = document.getElementById(res['link_id']);
                setInnerHTML(dom_dict[res['link_id']], res['html']);
              });
            });
            last_selected = brushed_all;
          }
                            
        // bind_chart.setOption(option);
        })
      }
      return option;
    };

    function support_click_event(option) {
      if (option['event']['type_'] === 'click') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        if (option['series'][0]['orient'] === 'vertical') {
          var value_idx = 0
        }
        else {
          var value_idx = 1
        }
    

        bind_chart.on(option['event']['type_'], (params) => {
          if (option['event']['task'] === 'singleselect') {
            for (var ind_2 = 0; ind_2 < option['series'][0]['data'].length; ind_2++) {
              if (option['series'][0]['data'][ind_2]['itemStyle']['color'] !== '#1f77b4') {
                option['series'][0]['data'][ind_2]['itemStyle']['color'] = '#1f77b4';
              }
            }
            var idx = option['series'][0]['x_value'].indexOf(params.value[value_idx])
            option['series'][0]['data'][idx]['itemStyle']['color'] = '#ff7f0e';

            var selected = params.value[value_idx];
          }
          else {
            console.log(params);
          }
      
          let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'selected': selected},
                                  'event_id': option['event']['event_id']})
          });
          var dom_dict = {}
          fetch(testRequest).then(response => {
            var result = response.json();
            result.then(res => {
              dom_dict[res['link_id']] = document.getElementById(res['link_id']);
              setInnerHTML(dom_dict[res['link_id']], res['html']);
            });
          });
          bind_chart.setOption(option);
        });
      }
      return option;
    };option = support_scientific_notation(option=option);option = custom_tooltip(option=option, dimension=2);option = custom_axis_label(option=option);option = auto_component_size(option=option);getScreenSize(option=option);

                myChart.setOption(option);
                window.addEventListener('resize', function () {
                    myChart.resize();
                    var option_copy = JSON.parse(JSON.stringify(option));
                    option_copy['figsize']['height'] = myChart.getHeight();
                    option_copy['figsize']['width'] = myChart.getWidth();
                    // option_copy = auto_component_size(option_copy);
                    myChart.setOption(option_copy);
                });
            <\/script>
            </body>
            </html>
        <style>
    .dg.main.taller-than-window .close-button {
        border-top: 1px solid #ddd;
    }

    .dg.main .close-button {
        background-color: #e8e8e8;
    }
 
    .dg.main .close-button:hover {
        background-color: #ddd;
    }

    .dg {
        color: #555;
        text-shadow: none !important;
    }

    .dg.main::-webkit-scrollbar {
        background: #fafafa;
    }

    .dg.main::-webkit-scrollbar-thumb {
        background: #bbb;
    }
 
    .dg li:not(.folder) {
        background: #fafafa;
        border-bottom: 1px solid #ddd;
    }
 
    .dg li.save-row .button {
        text-shadow: none !important;
    }

    .dg li.title {
        background: #e8e8e8 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;
    }

    .dg .cr.function:hover,.dg .cr.boolean:hover {
        background: #fff;
    }
 
    .dg .c input[type=text] {
        background: #e9e9e9;
    }
 
    .dg .c input[type=text]:hover {
        background: #eee;
    }
 
    .dg .c input[type=text]:focus {
        background: #eee;
        color: #555;
    }
 
    .dg .c .slider {
        background: #e9e9e9;
    }

    .dg .c .slider:hover {
        background: #eee;
    }<\/style>`);option = support_scientific_notation(option=option);option = custom_tooltip(option=option, dimension=2);option = custom_axis_label(option=option);option = auto_component_size(option=option);getScreenSize(option=option);

                if (option && typeof option === 'object') {
                    myChart.setOption(option);
                    }

                auto_axis_namegap(echarts_instance=myChart, auto_axis_list=[0], axis_type="2d");

            </script>
            </body>
            </html>
    
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 35-36

Test data drift between the first 1000 test samples and the second 1000 test samples

.. GENERATED FROM PYTHON SOURCE LINES 36-43

.. code-block:: Python

    results = ds.data_drift_test(dataset1="test",
                                 dataset2="test",
                                 sample_idx1=np.arange(1000),
                                 sample_idx2=np.arange(1000, 2000),
                                 distance_metric='PSI')
    results.plot("summary")






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

                <!DOCTYPE html>
                <html lang="en" style="height: 100%">
                <head>
                <meta charset="utf-8">
                </head>
                <body style="height: 100%; margin: 0">

            
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts-gl/2.0.8/echarts-gl.min.js"></script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>
                <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"></script>
            
                <div id="1737119431.453712" style="height: 600px; width: 600px; overflow: auto"></div>
            
                <script type="text/javascript">
                var dom = document.getElementById('1737119431.453712');
                dom.innerHTML = ""
                dom.setAttribute('_echarts_instance_', '')
                var myChart = echarts.init(dom, null, {
                    renderer: 'canvas',
                    useDirtyRect: false
                    });
                var app = {};

                var option;
        option = {"chart_id": "1737119431.453712", "link_id": null, "figname": "", "title": {"show": true, "text": "PSI", "link": "", "target": "blank", "textStyle": {"fontStyle": "normal", "fontWeight": "bolder", "fontFamily": "sans-serif", "fontSize": 15, "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "subtext": "", "sublink": "", "subtarget": "blank", "textAlign": "center", "textVerticalAlign": "auto", "padding": 0, "itemGap": 10, "z": 2, "left": "50.0%", "top": "5%", "right": "auto", "bottom": "auto", "backgroundColor": "transparent", "borderColor": "#ccc", "changed_name_key": {"id_": "id"}}, "grid": {"show": true, "width": "auto", "height": "auto", "z": 2, "left": "5%", "top": "10%", "right": "10%", "bottom": "5%", "borderColor": "#ccc", "borderWidth": 1, "containLabel": true, "backgroundColor": "transparent", "changed_name_key": {"id_": "id"}}, "legend": null, "brush": null, "yAxis": [{"show": true, "data": ["SEX", "FlagDefault", "PAY_4", "MARRIAGE", "EDUCATION", "PAY_5", "BILL_AMT4", "BILL_AMT5", "PAY_AMT6", "PAY_3", "PAY_1", "PAY_AMT4", "PAY_2", "PAY_6", "PAY_AMT3", "BILL_AMT1", "BILL_AMT3", "LIMIT_BAL", "PAY_AMT5", "BILL_AMT2", "BILL_AMT6", "PAY_AMT2", "AGE", "PAY_AMT1"], "type": "category", "position": "bottom", "name": "", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": "auto", "splitNumber": 5, "logBase": 10, "axisLine": {"show": false}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": true, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": 40.0}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "xAxis": [{"show": true, "type": "value", "position": "bottom", "name": "", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": 30, "min": -0.01096, "max": 0.04523, "splitNumber": 5, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": null}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "parallelAxis": null, "series": [{"type": "bar", "colorBy": "series", "z": 2, "legendHoverLink": true, "stack": "", "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "label": {"show": false, "color": "black", "position": null, "fontSize": 12}, "itemStyle": {}, "seriesLayoutBy": "column", "data": [{"value": [0.0004113504391273491, "SEX"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0006951143550851618, "FlagDefault"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.001548485256414035, "PAY_4"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.004277252703184527, "MARRIAGE"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.004982666860748231, "EDUCATION"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.005306248853429685, "PAY_5"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.005443708520600995, "BILL_AMT4"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0060918194022203985, "BILL_AMT5"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.006970972430502093, "PAY_AMT6"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0070201005549607835, "PAY_3"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.007601802564766807, "PAY_1"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.008260617626143612, "PAY_AMT4"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.008637885725796147, "PAY_2"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.011806382132473259, "PAY_6"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.012256153328128107, "PAY_AMT3"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.019011359706868024, "BILL_AMT1"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.022160348294631583, "BILL_AMT3"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.024325492377875586, "LIMIT_BAL"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.026489939565827826, "PAY_AMT5"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.02663796605629049, "BILL_AMT2"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.027972259063732515, "BILL_AMT6"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.029203058989271155, "PAY_AMT2"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.030753002431084347, "AGE"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.033836943466177986, "PAY_AMT1"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "#1f77b4", "coordinateSystem": "cartesian2d", "showBackground": true, "backgroundStyle": {"color": "rgba(180, 180, 180, 0.2)"}, "barWidth": "90%", "barGap": "0", "barCategoryGap": "20%", "largeThreshold": 400, "progressive": 5000, "progressiveThreshold": 3000, "progressiveChunkMode": "mod", "orient": "horizontal", "x_value": ["SEX", "FlagDefault", "PAY_4", "MARRIAGE", "EDUCATION", "PAY_5", "BILL_AMT4", "BILL_AMT5", "PAY_AMT6", "PAY_3", "PAY_1", "PAY_AMT4", "PAY_2", "PAY_6", "PAY_AMT3", "BILL_AMT1", "BILL_AMT3", "LIMIT_BAL", "PAY_AMT5", "BILL_AMT2", "BILL_AMT6", "PAY_AMT2", "AGE", "PAY_AMT1"], "tooltip_type": "axis", "hist": false, "data_value": [["SEX", "0.0004113504391273491"], ["FlagDefault", "0.0006951143550851618"], ["PAY_4", "0.001548485256414035"], ["MARRIAGE", "0.004277252703184527"], ["EDUCATION", "0.004982666860748231"], ["PAY_5", "0.005306248853429685"], ["BILL_AMT4", "0.005443708520600995"], ["BILL_AMT5", "0.0060918194022203985"], ["PAY_AMT6", "0.006970972430502093"], ["PAY_3", "0.0070201005549607835"], ["PAY_1", "0.007601802564766807"], ["PAY_AMT4", "0.008260617626143612"], ["PAY_2", "0.008637885725796147"], ["PAY_6", "0.011806382132473259"], ["PAY_AMT3", "0.012256153328128107"], ["BILL_AMT1", "0.019011359706868024"], ["BILL_AMT3", "0.022160348294631583"], ["LIMIT_BAL", "0.024325492377875586"], ["PAY_AMT5", "0.026489939565827826"], ["BILL_AMT2", "0.02663796605629049"], ["BILL_AMT6", "0.027972259063732515"], ["PAY_AMT2", "0.029203058989271155"], ["AGE", "0.030753002431084347"], ["PAY_AMT1", "0.033836943466177986"]]}], "visualMap": null, "toolbox": {"show": true, "orient": "horizontal", "itemSize": 15, "itemGap": 8, "showTitle": true, "feature": {"dataZoom": {}, "saveAsImage": {}}, "z": 2, "left": "auto", "top": "auto", "right": "1%", "bottom": "auto", "width": "auto", "height": "auto", "popup": true, "changed_name_key": {"id_": "id"}}, "tooltip": {"show": true, "custom_tooltip": false, "trigger": "item", "axisPointer": {"show": true}, "showContent": true, "triggerOn": "mousemove|click", "hideDelay": 100, "enterable": true, "renderMode": "html", "confine": true, "transitionDuration": 0.4, "precision": 4, "borderColor": "#333", "padding": 5, "order": "seriesAsc"}, "dataZoom": null, "event": null, "graphic": null, "radar": null, "figsize": {"width": 600, "height": 600}, "color": ["#1f77b4", "#aec7e8", "#ff7f0e", "#ffbb78", "#2ca02c", "#98df8a", "#d62728", "#ff9896", "#9467bd", "#c5b0d5", "#8c564b", "#c49c94", "#e377c2", "#f7b6d2", "#7f7f7f", "#c7c7c7", "#bcbd22", "#dbdb8d", "#17becf", "#9edae5"], "save_img": false, "auto_size": true, "style": {"overflow": "auto"}, "port": "5006"};function setInnerHTML(elm, html) {
      elm.innerHTML = html;
  
      Array.from(elm.querySelectorAll("script"))
        .forEach( oldScriptEl => {
          const newScriptEl = document.createElement("script");
      
          Array.from(oldScriptEl.attributes).forEach( attr => {
            newScriptEl.setAttribute(attr.name, attr.value) 
          });
      
          const scriptText = document.createTextNode(oldScriptEl.innerHTML);
          newScriptEl.appendChild(scriptText);
      
          oldScriptEl.parentNode.replaceChild(newScriptEl, oldScriptEl);
      });
    };

    function getScreenSize(option) {
      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_result_save', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'height': screen.height, 'width': screen.width},
                                  'event_id': 'screen_size'})
          });
          fetch(testRequest).then(response => {});
      return 
    }
    function support_scientific_notation(option) {
      if (Array.isArray(option['yAxis'])) {
        for (var tar_ind = 0; tar_ind < option['yAxis'].length; tar_ind++) {
          if (option['yAxis'][tar_ind]['type'] === 'value') {
            option['yAxis'][tar_ind]['axisLabel']['formatter'] = function(val) {
              const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                        '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                        '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
              function toSuperscript(val) {
                if (val.toString().length > 5 && !val.toString().includes('.')) {
                  val = Number(val).toExponential().toString();
                  if (val.includes('-')) {
                    val = val.split('-');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁻' + val1
                  }
                  else if (val.includes('+')) {
                    val = val.split('+');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁺' + val1
                  }
                }
                else {
                  return val
                }
              }
              return toSuperscript(val)
            }
          }
        }
      }
      else {
        if (option['yAxis']['type'] === 'value') {
          option['yAxis']['axisLabel']['formatter'] = function(val) {
            const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                    '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                    '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
            function toSuperscript(val) {
              if (val.toString().length > 5 && !val.toString().includes('.')) {
                val = Number(val).toExponential().toString();
                if (val.includes('-')) {
                  val = val.split('-');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁻' + val1
                }
                else if (val.includes('+')) {
                  val = val.split('+');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁺' + val1
                }
              }
              else {
                return val
              }
            }
            return toSuperscript(val)
          }
        }
      };
      return option;
    };

    function auto_component_size(option) {
      if (typeof option['figsize']['width'] === 'string' || option['figsize']['width'] instanceof String) {
        if (option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['width'].includes('px')) {
          var width = parseFloat(option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = option['figsize']['width']
      }

      if (typeof option['figsize']['height'] === 'string' || option['figsize']['height'] instanceof String) {
        if (option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['height'].includes('px')) {
          var height = parseFloat(option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height']
      }

      var relative_ratio = Math.min(width / 700, height / 400)
      if ('xAxis3D' in option) {
        var keys = ['xAxis3D', 'yAxis3D', 'zAxis3D']
      }
      else {
        var keys = ['xAxis', 'yAxis']
      }
      for (single_key of keys) {
        for (var ind = 0; ind < option[single_key].length; ind++) {
          option[single_key][ind]['nameTextStyle']['fontSize'] = Math.max(7, option[single_key][ind]['nameTextStyle']['fontSize'] * relative_ratio);
          option[single_key][ind]['axisLabel']['fontSize'] = Math.max(7, option[single_key][ind]['axisLabel']['fontSize'] * relative_ratio);
        }
      }
      if (option['series']) {
        for (var ind = 0; ind < option['series'].length; ind++) {
          if (['heatmap', 'bar'].includes(option['series'][ind]['type'])) {
            if (option['series'][ind]['label']) {
              option['series'][ind]['label']['fontSize'] = Math.max(7, option['series'][ind]['label']['fontSize'] * relative_ratio);
            }
          }
        }
      }
      if (option['title']) {
        if (Array.isArray(option['title'])) {
          for (var ind = 0; ind < option['title'].length; ind++) {
            option['title'][ind]['textStyle']['fontSize'] = Math.max(9, option['title'][ind]['textStyle']['fontSize'] * relative_ratio);
          }
        }
        else {
          option['title']['textStyle']['fontSize'] = Math.max(9, option['title']['textStyle']['fontSize'] * relative_ratio);
        }
      }
      if (option['legend']) {
        option['legend']['itemHeight'] = option['legend']['itemHeight'] * relative_ratio;
        option['legend']['itemWidth'] = option['legend']['itemWidth'] * relative_ratio;
        option['legend']['textStyle']['fontSize'] = Math.max(7, option['legend']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['visualMap']) {
        option['visualMap']['itemHeight'] = option['visualMap']['itemHeight'] * relative_ratio;
        option['visualMap']['itemWidth'] = option['visualMap']['itemWidth'] * relative_ratio;
        option['visualMap']['textStyle']['fontSize'] = Math.max(7, option['visualMap']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['toolbox']) {
        option['toolbox']['itemSize'] = Math.max(8, option['toolbox']['itemSize'] * relative_ratio)
        option['toolbox']['itemGap'] = Math.max(4, option['toolbox']['itemGap'] * relative_ratio);
      }
      if (option['graphic']) {
        for (var ind = 0; ind < option['graphic'].length; ind++) {
          for (var ind2 = 0; ind2 < option['graphic'][ind]['children'].length; ind2++) {
            var new_font = Math.max(7, 12 * relative_ratio);
            option['graphic'][ind]['children'][ind2]['style']['font'] = new_font.toString() + 'px Microsoft YaHei';
          }
        }
      }
      return option;
    }

    function save_img(echarts_instance, option) {
      const base64_str = echarts_instance.getDataURL({
          pixelRatio: 2,
          backgroundColor: '#fff',
          width: option['figsize']['width'],
          height: option['figsize']['height']
      });

      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_image_save', {
        method: 'post',
        headers: {
          'Content-Type': 'application/json;charset=utf-8;',
          'Access-Control-Allow-Origin':'*',
          'Access-Control-Allow-Credentials': 'true',
          'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
        },
        body: JSON.stringify({'figname': option['figname'],
                              'base64_str': base64_str})
      });
      fetch(testRequest).then(response => {});
    };


    function auto_axis_namegap(echarts_instance, auto_axis_list, axis_type) {
      const globalModel = echarts_instance._api.getModel()
      const figsize = globalModel.option.figsize
      const ctx = document.createElement('canvas').getContext('2d')
      if (typeof globalModel.option['figsize']['width'] === 'string' || globalModel.option['figsize']['width'] instanceof String) {
        if (globalModel.option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(globalModel.option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['width'].includes('px')) {
          var width = parseFloat(globalModel.option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = globalModel.option['figsize']['width'];
      }

      if (typeof globalModel.option['figsize']['height'] === 'string' || globalModel.option['figsize']['height'] instanceof String) {
        if (globalModel.option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(globalModel.option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['height'].includes('px')) {
          var height = parseFloat(globalModel.option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height'];
      }
      var relative_ratio = Math.min(width / 700, height / 400);
      if (axis_type==='2d') {
        const yAxisList = globalModel.option.yAxis
        const xAxisList = globalModel.option.xAxis

        for (var axis_idx of auto_axis_list) {
          const yAxis = yAxisList[axis_idx]
          const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
          const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
          ctx.save()
          ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
  
          const yAxisComponent = globalModel.getComponent('yAxis', axis_idx)?.axis
          if (yAxis.type === 'value') {
            var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
          }
          else {
            var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
          }
          var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
          axisLabelMargin = axisLabelMargin * relative_ratio
          yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
          ctx.restore()
        };
  
        for (var axis_idx of [...Array(xAxisList.length).keys()]) {
          var new_gap = Math.max(xAxisList[axis_idx].nameGap * relative_ratio, 12);
          if (figsize['height'] < 400) {
            new_gap = Math.min(20, new_gap);
          }
          xAxisList[axis_idx].nameGap = new_gap;
        }
  
        echarts_instance.setOption({
          yAxis: yAxisList,
          xAxis: xAxisList
        })
      }
      else {
        const yAxisList = globalModel.option.yAxis3D
        const xAxisList = globalModel.option.xAxis3D
        const zAxisList = globalModel.option.zAxis3D

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < xAxisList.length) {
            const xAxis = xAxisList[axis_idx]
            const fontSize = xAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = xAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const xAxisComponent = globalModel.getComponent('xAxis3D', axis_idx)?.axis
            if (xAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = xAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            xAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < yAxisList.length) {
            const yAxis = yAxisList[axis_idx]
            const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const yAxisComponent = globalModel.getComponent('yAxis3D', axis_idx)?.axis
            if (yAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < zAxisList.length) {
            const zAxis = zAxisList[axis_idx]
            const fontSize = zAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = zAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const zAxisComponent = globalModel.getComponent('zAxis3D', axis_idx)?.axis
            if (zAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = zAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            zAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };
        echarts_instance.setOption({
          yAxis3D: yAxisList,
          xAxis3D: xAxisList,
          zAxis3D: zAxisList
        });
        }
  
    };

    function custom_scatter_size(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['symbolSize'] === 'array_size') {
          var ind_ = option['series'][ind]['data_dict']['size']
          option['series'][ind]['symbolSize'] = function (data) {return data[ind_];}
        }
      }
      return option;
  
    };

    function show_scatter_label(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['label'] === 'show_label') {
          var ind_ = option['series'][ind]['data_dict']['label']
          option['series'][ind]['label'] = {
            show: true,
            formatter: function (params) {return params.data.value[ind_]; }
          }
        }
      }
      return option;
    };

    function hide_min_max_axis_label(option) {
      for (var ind = 0; ind < option['xAxis3D'].length; ind++) {
        if (option['xAxis3D'][ind]['type'] == 'value') {
          var x_min = option['xAxis3D'][ind]['min']
          var x_max = option['xAxis3D'][ind]['max']
          option['xAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==x_min || value==x_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['yAxis3D'].length; ind++) {
        if (option['yAxis3D'][ind]['type'] == 'value') {  
          var y_min = option['yAxis3D'][ind]['min']
          var y_max = option['yAxis3D'][ind]['max']
          option['yAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==y_min || value==y_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['zAxis3D'].length; ind++) {
        if (option['zAxis3D'][ind]['type'] == 'value') {
          var z_min = option['zAxis3D'][ind]['min']
          var z_max = option['zAxis3D'][ind]['max']
          option['zAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==z_min || value==z_max){}
            else {return value}
          }
       }
      }
      return option;
    }

    function custom_axis_label(option) {
      if (Array.isArray(option['xAxis'])) {
        for (var ind = 0; ind < option['xAxis'].length; ind++) {
          if (option['xAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['xAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['xAxis'][ind]['axisLabel']['formatter_func'].body)
            option['xAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['xAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['xAxis']['axisLabel']['formatter_func'].arguments,
                               option['xAxis']['axisLabel']['formatter_func'].body)
          option['xAxis']['axisLabel']['formatter'] = f
        }
      }
      if (Array.isArray(option['yAxis'])) {
        for (var ind = 0; ind < option['yAxis'].length; ind++) {
          if (option['yAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['yAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['yAxis'][ind]['axisLabel']['formatter_func'].body)
            option['yAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['yAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['yAxis']['axisLabel']['formatter_func'].arguments,
                               option['yAxis']['axisLabel']['formatter_func'].body)
          option['yAxis']['axisLabel']['formatter'] = f
        }
      }
      return option;
    }

    function custom_tooltip(option, dimension=2) {

      if (dimension === 2) {
        var xaxis_key = 'xAxis'
        var yaxis_key = 'yAxis'
      }

      else if (dimension === 3) {
        var xaxis_key = 'xAxis3D'
        var yaxis_key = 'yAxis3D'
        var zaxis_key = 'zAxis3D'
      }

      if (option['radar']) {
        var radar_names = []
        for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
          radar_names.push(option['radar']['indicator'][ind_]['name']) 
        }
      }
  
  
      if (option[xaxis_key]['name'] !== null && option[xaxis_key]['name'] !== '' && Array.isArray(option[xaxis_key])!==true) {
        var xaxis_name = option[xaxis_key]['name'];
      }
      else {
        var xaxis_name = 'X';
      }

      if (option[yaxis_key]['name'] !== null && option[yaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
        var yaxis_name = option[yaxis_key]['name'];
      }
      else {
        var yaxis_name = 'Y';
      }

      if (typeof zaxis_key !== 'undefined') {
        if (option[zaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
          var zaxis_name = option[zaxis_key]['name'];
        }
        else {
          var zaxis_name = 'Z';
        }
      }
  
      if (option['tooltip']) {
        if (option['tooltip']['precision']) {
          var precision = option['tooltip']['precision']
          option['tooltip']['valueFormatter'] = (value) =>  Math.round(Number(value) * (10**precision)) / (10**precision)
        }

        for (var ind_ = 0; ind_ < option['series'].length; ind_++) {
          if (option['series'][ind_]['tooltip']) {
            if (option['series'][ind_]['tooltip']['precision']) {
              var precision = option['series'][ind_]['tooltip']['precision']
              const fix = precision_ => value => Math.round(Number(value) * (10**precision_)) / (10**precision_),
              fix_p = fix(precision);
              option['series'][ind_]['tooltip']['valueFormatter'] = function (value) {
                return fix_p(value)
              } 
            }
          }
        }

        if (option['series'].length === 1) {
          if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][0]['type'])) {
            option['tooltip']['formatter'] = function(params) {
              if (params.seriesName.includes('series')) {
                var series_name = ''
              }
          
              else {
                var series_name = params.seriesName + '<br>'
              }
      
              if (params.seriesType === 'scatter') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                  + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                  +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                }
            
              }
  
              else if (params.seriesType === 'heatmap') {
                formatter = params.name + ', ' + option['yAxis'][0]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
              }
      
              else if (params.seriesType === 'scatter3D') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                    + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                    +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                    +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                }
              }
          
              else if (params.seriesType === 'radar') {
                formatter = params.name  + '<br>';
                for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                  if (ind_ !== option['radar']['indicator'].length - 1) {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                  }
                  else {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                  }
                }
              }
            return formatter;
            }
          }
        }
        else {
          for (var out_ind_ = 0; out_ind_ < option['series'].length; out_ind_++) {
            if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][out_ind_]['type'])) {
              if (option['series'][out_ind_]['tooltip']) {
              }
              else {
                option['series'][out_ind_]['tooltip'] = {}
              }
              option['series'][out_ind_]['tooltip']['formatter'] = function(params) {
                if (params.seriesName.includes('series')) {
                  var series_name = ''
                }
            
                else {
                  var series_name = params.seriesName + '<br>'
                }
        
                if (params.seriesType === 'scatter') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                  }
                }
    
                else if (params.seriesType === 'heatmap') {
                  if ('data' in option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]) {
                    formatter = params.name + ', ' + option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
                  }
                  else {
                    formatter = Math.round(params.data[2] * 10000) / 10000
                  }
                
                }
        
                else if (params.seriesType === 'scatter3D') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                      +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                  }
                }
            
                else if (params.seriesType === 'radar') {
                  formatter = params.name  + '<br>';
                  for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                    if (ind_ !== option['radar']['indicator'].length - 1) {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                    }
                    else {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                    }
                  }
                }
              return formatter;
              }
            }
          }
        }
      }
      return option;
    };

    function support_brush_event(option) {
      if (option['event']['type_'] === 'brushselected') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var last_selected = [];
        bind_chart.on(option['event']['type_'], (params) => {
          var brushed = [];
          var brushComponent = params.batch[0];
          for (var sIdx = 0; sIdx < brushComponent.selected.length; sIdx++) {
            var rawIndices = brushComponent.selected[sIdx].dataIndex;
            brushed.push(rawIndices);
          }
          var brushed_all = brushed[0];

          if (JSON.stringify(last_selected) !== JSON.stringify(brushed_all)) {

            // Update memory
            let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
              method: 'post',
              headers: {
                  'Content-Type': 'application/json;charset=utf-8;',
                  'Access-Control-Allow-Origin':'*',
                  'Access-Control-Allow-Credentials': 'true',
                  'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
              },
              body: JSON.stringify({'js_func_input':{'selected': brushed_all},
                                    'event_id': option['event']['event_id']})
            });
            var dom_dict = {}
            fetch(testRequest).then(response => {
              var result = response.json();
              result.then(res => {
                dom_dict[res['link_id']] = document.getElementById(res['link_id']);
                setInnerHTML(dom_dict[res['link_id']], res['html']);
              });
            });
            last_selected = brushed_all;
          }
                            
        // bind_chart.setOption(option);
        })
      }
      return option;
    };

    function support_click_event(option) {
      if (option['event']['type_'] === 'click') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        if (option['series'][0]['orient'] === 'vertical') {
          var value_idx = 0
        }
        else {
          var value_idx = 1
        }
    

        bind_chart.on(option['event']['type_'], (params) => {
          if (option['event']['task'] === 'singleselect') {
            for (var ind_2 = 0; ind_2 < option['series'][0]['data'].length; ind_2++) {
              if (option['series'][0]['data'][ind_2]['itemStyle']['color'] !== '#1f77b4') {
                option['series'][0]['data'][ind_2]['itemStyle']['color'] = '#1f77b4';
              }
            }
            var idx = option['series'][0]['x_value'].indexOf(params.value[value_idx])
            option['series'][0]['data'][idx]['itemStyle']['color'] = '#ff7f0e';

            var selected = params.value[value_idx];
          }
          else {
            console.log(params);
          }
      
          let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'selected': selected},
                                  'event_id': option['event']['event_id']})
          });
          var dom_dict = {}
          fetch(testRequest).then(response => {
            var result = response.json();
            result.then(res => {
              dom_dict[res['link_id']] = document.getElementById(res['link_id']);
              setInnerHTML(dom_dict[res['link_id']], res['html']);
            });
          });
          bind_chart.setOption(option);
        });
      }
      return option;
    };function support_popup(option, height, width, inner_html) {
      option['toolbox']['feature']['myFeature'] = {
        show: true,
        title: 'Open in new window',
        icon: 'image://http://127.0.0.1:5001/resources/popup_icon',
        onclick: function (){
          var height_ = Math.min(screen.height, Math.round(1.5 * parseInt(height.slice(0,-2))))
          var width_ = Math.min(screen.width, Math.round(1.5 * parseInt(width.slice(0,-2))))
          var left = (screen.width/2)-(width_/2);
          var top = (screen.height/2)-(height_/2);
          var win = window.open('template.html', '_blank',
            `height=${height_}px, width=${width_}px, top=${top}px, left=${left}px`,
          );
          win.document.write(`${inner_html}`);
          win.document.close();
        }
      };
      return option;
    };option = support_popup(option=option, height="600px", width="600px", inner_html=`

            <html lang="en" style="height: 100%; text-align: -webkit-center; align-content: center">
            <title>MoCharts</title>
            <head> <meta charset="utf-8"> </head>
            <body style="height: 100%; margin: 0">
        
        
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"><\/script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts-gl/2.0.8/echarts-gl.min.js"><\/script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"><\/script>
                <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"><\/script>
            

            <div id="1737119431.453712" style="height: 90%; width: 90%"></div>
            <script type="text/javascript">
                var dom = document.getElementById('1737119431.453712');
                var myChart = echarts.init(dom, null, {
                    renderer: 'canvas',
                    useDirtyRect: false
                    });
                var app = {};

                var option;
            option = {"chart_id": "1737119431.453712", "link_id": null, "figname": "", "title": {"show": true, "text": "PSI", "link": "", "target": "blank", "textStyle": {"fontStyle": "normal", "fontWeight": "bolder", "fontFamily": "sans-serif", "fontSize": 15, "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "subtext": "", "sublink": "", "subtarget": "blank", "textAlign": "center", "textVerticalAlign": "auto", "padding": 0, "itemGap": 10, "z": 2, "left": "50.0%", "top": "5%", "right": "auto", "bottom": "auto", "backgroundColor": "transparent", "borderColor": "#ccc", "changed_name_key": {"id_": "id"}}, "grid": {"show": true, "width": "auto", "height": "auto", "z": 2, "left": "5%", "top": "10%", "right": "10%", "bottom": "5%", "borderColor": "#ccc", "borderWidth": 1, "containLabel": true, "backgroundColor": "transparent", "changed_name_key": {"id_": "id"}}, "legend": null, "brush": null, "yAxis": [{"show": true, "data": ["SEX", "FlagDefault", "PAY_4", "MARRIAGE", "EDUCATION", "PAY_5", "BILL_AMT4", "BILL_AMT5", "PAY_AMT6", "PAY_3", "PAY_1", "PAY_AMT4", "PAY_2", "PAY_6", "PAY_AMT3", "BILL_AMT1", "BILL_AMT3", "LIMIT_BAL", "PAY_AMT5", "BILL_AMT2", "BILL_AMT6", "PAY_AMT2", "AGE", "PAY_AMT1"], "type": "category", "position": "bottom", "name": "", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": "auto", "splitNumber": 5, "logBase": 10, "axisLine": {"show": false}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": true, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": 40.0}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "xAxis": [{"show": true, "type": "value", "position": "bottom", "name": "", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": 30, "min": -0.01096, "max": 0.04523, "splitNumber": 5, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": null}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "parallelAxis": null, "series": [{"type": "bar", "colorBy": "series", "z": 2, "legendHoverLink": true, "stack": "", "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "label": {"show": false, "color": "black", "position": null, "fontSize": 12}, "itemStyle": {}, "seriesLayoutBy": "column", "data": [{"value": [0.0004113504391273491, "SEX"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0006951143550851618, "FlagDefault"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.001548485256414035, "PAY_4"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.004277252703184527, "MARRIAGE"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.004982666860748231, "EDUCATION"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.005306248853429685, "PAY_5"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.005443708520600995, "BILL_AMT4"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0060918194022203985, "BILL_AMT5"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.006970972430502093, "PAY_AMT6"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.0070201005549607835, "PAY_3"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.007601802564766807, "PAY_1"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.008260617626143612, "PAY_AMT4"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.008637885725796147, "PAY_2"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.011806382132473259, "PAY_6"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.012256153328128107, "PAY_AMT3"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.019011359706868024, "BILL_AMT1"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.022160348294631583, "BILL_AMT3"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.024325492377875586, "LIMIT_BAL"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.026489939565827826, "PAY_AMT5"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.02663796605629049, "BILL_AMT2"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.027972259063732515, "BILL_AMT6"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.029203058989271155, "PAY_AMT2"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.030753002431084347, "AGE"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": [0.033836943466177986, "PAY_AMT1"], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "#1f77b4", "coordinateSystem": "cartesian2d", "showBackground": true, "backgroundStyle": {"color": "rgba(180, 180, 180, 0.2)"}, "barWidth": "90%", "barGap": "0", "barCategoryGap": "20%", "largeThreshold": 400, "progressive": 5000, "progressiveThreshold": 3000, "progressiveChunkMode": "mod", "orient": "horizontal", "x_value": ["SEX", "FlagDefault", "PAY_4", "MARRIAGE", "EDUCATION", "PAY_5", "BILL_AMT4", "BILL_AMT5", "PAY_AMT6", "PAY_3", "PAY_1", "PAY_AMT4", "PAY_2", "PAY_6", "PAY_AMT3", "BILL_AMT1", "BILL_AMT3", "LIMIT_BAL", "PAY_AMT5", "BILL_AMT2", "BILL_AMT6", "PAY_AMT2", "AGE", "PAY_AMT1"], "tooltip_type": "axis", "hist": false, "data_value": [["SEX", "0.0004113504391273491"], ["FlagDefault", "0.0006951143550851618"], ["PAY_4", "0.001548485256414035"], ["MARRIAGE", "0.004277252703184527"], ["EDUCATION", "0.004982666860748231"], ["PAY_5", "0.005306248853429685"], ["BILL_AMT4", "0.005443708520600995"], ["BILL_AMT5", "0.0060918194022203985"], ["PAY_AMT6", "0.006970972430502093"], ["PAY_3", "0.0070201005549607835"], ["PAY_1", "0.007601802564766807"], ["PAY_AMT4", "0.008260617626143612"], ["PAY_2", "0.008637885725796147"], ["PAY_6", "0.011806382132473259"], ["PAY_AMT3", "0.012256153328128107"], ["BILL_AMT1", "0.019011359706868024"], ["BILL_AMT3", "0.022160348294631583"], ["LIMIT_BAL", "0.024325492377875586"], ["PAY_AMT5", "0.026489939565827826"], ["BILL_AMT2", "0.02663796605629049"], ["BILL_AMT6", "0.027972259063732515"], ["PAY_AMT2", "0.029203058989271155"], ["AGE", "0.030753002431084347"], ["PAY_AMT1", "0.033836943466177986"]]}], "visualMap": null, "toolbox": {"show": true, "orient": "horizontal", "itemSize": 15, "itemGap": 8, "showTitle": true, "feature": {"dataZoom": {}, "saveAsImage": {}}, "z": 2, "left": "auto", "top": "auto", "right": "1%", "bottom": "auto", "width": "auto", "height": "auto", "popup": true, "changed_name_key": {"id_": "id"}}, "tooltip": {"show": true, "custom_tooltip": false, "trigger": "item", "axisPointer": {"show": true}, "showContent": true, "triggerOn": "mousemove|click", "hideDelay": 100, "enterable": true, "renderMode": "html", "confine": true, "transitionDuration": 0.4, "precision": 4, "borderColor": "#333", "padding": 5, "order": "seriesAsc"}, "dataZoom": null, "event": null, "graphic": null, "radar": null, "figsize": {"width": 600, "height": 600}, "color": ["#1f77b4", "#aec7e8", "#ff7f0e", "#ffbb78", "#2ca02c", "#98df8a", "#d62728", "#ff9896", "#9467bd", "#c5b0d5", "#8c564b", "#c49c94", "#e377c2", "#f7b6d2", "#7f7f7f", "#c7c7c7", "#bcbd22", "#dbdb8d", "#17becf", "#9edae5"], "save_img": false, "auto_size": true, "style": {"overflow": "auto"}, "port": "5006"};function setInnerHTML(elm, html) {
      elm.innerHTML = html;
  
      Array.from(elm.querySelectorAll("script"))
        .forEach( oldScriptEl => {
          const newScriptEl = document.createElement("script");
      
          Array.from(oldScriptEl.attributes).forEach( attr => {
            newScriptEl.setAttribute(attr.name, attr.value) 
          });
      
          const scriptText = document.createTextNode(oldScriptEl.innerHTML);
          newScriptEl.appendChild(scriptText);
      
          oldScriptEl.parentNode.replaceChild(newScriptEl, oldScriptEl);
      });
    };

    function getScreenSize(option) {
      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_result_save', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'height': screen.height, 'width': screen.width},
                                  'event_id': 'screen_size'})
          });
          fetch(testRequest).then(response => {});
      return 
    }
    function support_scientific_notation(option) {
      if (Array.isArray(option['yAxis'])) {
        for (var tar_ind = 0; tar_ind < option['yAxis'].length; tar_ind++) {
          if (option['yAxis'][tar_ind]['type'] === 'value') {
            option['yAxis'][tar_ind]['axisLabel']['formatter'] = function(val) {
              const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                        '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                        '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
              function toSuperscript(val) {
                if (val.toString().length > 5 && !val.toString().includes('.')) {
                  val = Number(val).toExponential().toString();
                  if (val.includes('-')) {
                    val = val.split('-');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁻' + val1
                  }
                  else if (val.includes('+')) {
                    val = val.split('+');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁺' + val1
                  }
                }
                else {
                  return val
                }
              }
              return toSuperscript(val)
            }
          }
        }
      }
      else {
        if (option['yAxis']['type'] === 'value') {
          option['yAxis']['axisLabel']['formatter'] = function(val) {
            const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                    '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                    '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
            function toSuperscript(val) {
              if (val.toString().length > 5 && !val.toString().includes('.')) {
                val = Number(val).toExponential().toString();
                if (val.includes('-')) {
                  val = val.split('-');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁻' + val1
                }
                else if (val.includes('+')) {
                  val = val.split('+');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁺' + val1
                }
              }
              else {
                return val
              }
            }
            return toSuperscript(val)
          }
        }
      };
      return option;
    };

    function auto_component_size(option) {
      if (typeof option['figsize']['width'] === 'string' || option['figsize']['width'] instanceof String) {
        if (option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['width'].includes('px')) {
          var width = parseFloat(option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = option['figsize']['width']
      }

      if (typeof option['figsize']['height'] === 'string' || option['figsize']['height'] instanceof String) {
        if (option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['height'].includes('px')) {
          var height = parseFloat(option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height']
      }

      var relative_ratio = Math.min(width / 700, height / 400)
      if ('xAxis3D' in option) {
        var keys = ['xAxis3D', 'yAxis3D', 'zAxis3D']
      }
      else {
        var keys = ['xAxis', 'yAxis']
      }
      for (single_key of keys) {
        for (var ind = 0; ind < option[single_key].length; ind++) {
          option[single_key][ind]['nameTextStyle']['fontSize'] = Math.max(7, option[single_key][ind]['nameTextStyle']['fontSize'] * relative_ratio);
          option[single_key][ind]['axisLabel']['fontSize'] = Math.max(7, option[single_key][ind]['axisLabel']['fontSize'] * relative_ratio);
        }
      }
      if (option['series']) {
        for (var ind = 0; ind < option['series'].length; ind++) {
          if (['heatmap', 'bar'].includes(option['series'][ind]['type'])) {
            if (option['series'][ind]['label']) {
              option['series'][ind]['label']['fontSize'] = Math.max(7, option['series'][ind]['label']['fontSize'] * relative_ratio);
            }
          }
        }
      }
      if (option['title']) {
        if (Array.isArray(option['title'])) {
          for (var ind = 0; ind < option['title'].length; ind++) {
            option['title'][ind]['textStyle']['fontSize'] = Math.max(9, option['title'][ind]['textStyle']['fontSize'] * relative_ratio);
          }
        }
        else {
          option['title']['textStyle']['fontSize'] = Math.max(9, option['title']['textStyle']['fontSize'] * relative_ratio);
        }
      }
      if (option['legend']) {
        option['legend']['itemHeight'] = option['legend']['itemHeight'] * relative_ratio;
        option['legend']['itemWidth'] = option['legend']['itemWidth'] * relative_ratio;
        option['legend']['textStyle']['fontSize'] = Math.max(7, option['legend']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['visualMap']) {
        option['visualMap']['itemHeight'] = option['visualMap']['itemHeight'] * relative_ratio;
        option['visualMap']['itemWidth'] = option['visualMap']['itemWidth'] * relative_ratio;
        option['visualMap']['textStyle']['fontSize'] = Math.max(7, option['visualMap']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['toolbox']) {
        option['toolbox']['itemSize'] = Math.max(8, option['toolbox']['itemSize'] * relative_ratio)
        option['toolbox']['itemGap'] = Math.max(4, option['toolbox']['itemGap'] * relative_ratio);
      }
      if (option['graphic']) {
        for (var ind = 0; ind < option['graphic'].length; ind++) {
          for (var ind2 = 0; ind2 < option['graphic'][ind]['children'].length; ind2++) {
            var new_font = Math.max(7, 12 * relative_ratio);
            option['graphic'][ind]['children'][ind2]['style']['font'] = new_font.toString() + 'px Microsoft YaHei';
          }
        }
      }
      return option;
    }

    function save_img(echarts_instance, option) {
      const base64_str = echarts_instance.getDataURL({
          pixelRatio: 2,
          backgroundColor: '#fff',
          width: option['figsize']['width'],
          height: option['figsize']['height']
      });

      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_image_save', {
        method: 'post',
        headers: {
          'Content-Type': 'application/json;charset=utf-8;',
          'Access-Control-Allow-Origin':'*',
          'Access-Control-Allow-Credentials': 'true',
          'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
        },
        body: JSON.stringify({'figname': option['figname'],
                              'base64_str': base64_str})
      });
      fetch(testRequest).then(response => {});
    };


    function auto_axis_namegap(echarts_instance, auto_axis_list, axis_type) {
      const globalModel = echarts_instance._api.getModel()
      const figsize = globalModel.option.figsize
      const ctx = document.createElement('canvas').getContext('2d')
      if (typeof globalModel.option['figsize']['width'] === 'string' || globalModel.option['figsize']['width'] instanceof String) {
        if (globalModel.option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(globalModel.option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['width'].includes('px')) {
          var width = parseFloat(globalModel.option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = globalModel.option['figsize']['width'];
      }

      if (typeof globalModel.option['figsize']['height'] === 'string' || globalModel.option['figsize']['height'] instanceof String) {
        if (globalModel.option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(globalModel.option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['height'].includes('px')) {
          var height = parseFloat(globalModel.option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height'];
      }
      var relative_ratio = Math.min(width / 700, height / 400);
      if (axis_type==='2d') {
        const yAxisList = globalModel.option.yAxis
        const xAxisList = globalModel.option.xAxis

        for (var axis_idx of auto_axis_list) {
          const yAxis = yAxisList[axis_idx]
          const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
          const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
          ctx.save()
          ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
  
          const yAxisComponent = globalModel.getComponent('yAxis', axis_idx)?.axis
          if (yAxis.type === 'value') {
            var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
          }
          else {
            var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
          }
          var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
          axisLabelMargin = axisLabelMargin * relative_ratio
          yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
          ctx.restore()
        };
  
        for (var axis_idx of [...Array(xAxisList.length).keys()]) {
          var new_gap = Math.max(xAxisList[axis_idx].nameGap * relative_ratio, 12);
          if (figsize['height'] < 400) {
            new_gap = Math.min(20, new_gap);
          }
          xAxisList[axis_idx].nameGap = new_gap;
        }
  
        echarts_instance.setOption({
          yAxis: yAxisList,
          xAxis: xAxisList
        })
      }
      else {
        const yAxisList = globalModel.option.yAxis3D
        const xAxisList = globalModel.option.xAxis3D
        const zAxisList = globalModel.option.zAxis3D

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < xAxisList.length) {
            const xAxis = xAxisList[axis_idx]
            const fontSize = xAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = xAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const xAxisComponent = globalModel.getComponent('xAxis3D', axis_idx)?.axis
            if (xAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = xAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            xAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < yAxisList.length) {
            const yAxis = yAxisList[axis_idx]
            const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const yAxisComponent = globalModel.getComponent('yAxis3D', axis_idx)?.axis
            if (yAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < zAxisList.length) {
            const zAxis = zAxisList[axis_idx]
            const fontSize = zAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = zAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const zAxisComponent = globalModel.getComponent('zAxis3D', axis_idx)?.axis
            if (zAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = zAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            zAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };
        echarts_instance.setOption({
          yAxis3D: yAxisList,
          xAxis3D: xAxisList,
          zAxis3D: zAxisList
        });
        }
  
    };

    function custom_scatter_size(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['symbolSize'] === 'array_size') {
          var ind_ = option['series'][ind]['data_dict']['size']
          option['series'][ind]['symbolSize'] = function (data) {return data[ind_];}
        }
      }
      return option;
  
    };

    function show_scatter_label(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['label'] === 'show_label') {
          var ind_ = option['series'][ind]['data_dict']['label']
          option['series'][ind]['label'] = {
            show: true,
            formatter: function (params) {return params.data.value[ind_]; }
          }
        }
      }
      return option;
    };

    function hide_min_max_axis_label(option) {
      for (var ind = 0; ind < option['xAxis3D'].length; ind++) {
        if (option['xAxis3D'][ind]['type'] == 'value') {
          var x_min = option['xAxis3D'][ind]['min']
          var x_max = option['xAxis3D'][ind]['max']
          option['xAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==x_min || value==x_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['yAxis3D'].length; ind++) {
        if (option['yAxis3D'][ind]['type'] == 'value') {  
          var y_min = option['yAxis3D'][ind]['min']
          var y_max = option['yAxis3D'][ind]['max']
          option['yAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==y_min || value==y_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['zAxis3D'].length; ind++) {
        if (option['zAxis3D'][ind]['type'] == 'value') {
          var z_min = option['zAxis3D'][ind]['min']
          var z_max = option['zAxis3D'][ind]['max']
          option['zAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==z_min || value==z_max){}
            else {return value}
          }
       }
      }
      return option;
    }

    function custom_axis_label(option) {
      if (Array.isArray(option['xAxis'])) {
        for (var ind = 0; ind < option['xAxis'].length; ind++) {
          if (option['xAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['xAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['xAxis'][ind]['axisLabel']['formatter_func'].body)
            option['xAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['xAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['xAxis']['axisLabel']['formatter_func'].arguments,
                               option['xAxis']['axisLabel']['formatter_func'].body)
          option['xAxis']['axisLabel']['formatter'] = f
        }
      }
      if (Array.isArray(option['yAxis'])) {
        for (var ind = 0; ind < option['yAxis'].length; ind++) {
          if (option['yAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['yAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['yAxis'][ind]['axisLabel']['formatter_func'].body)
            option['yAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['yAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['yAxis']['axisLabel']['formatter_func'].arguments,
                               option['yAxis']['axisLabel']['formatter_func'].body)
          option['yAxis']['axisLabel']['formatter'] = f
        }
      }
      return option;
    }

    function custom_tooltip(option, dimension=2) {

      if (dimension === 2) {
        var xaxis_key = 'xAxis'
        var yaxis_key = 'yAxis'
      }

      else if (dimension === 3) {
        var xaxis_key = 'xAxis3D'
        var yaxis_key = 'yAxis3D'
        var zaxis_key = 'zAxis3D'
      }

      if (option['radar']) {
        var radar_names = []
        for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
          radar_names.push(option['radar']['indicator'][ind_]['name']) 
        }
      }
  
  
      if (option[xaxis_key]['name'] !== null && option[xaxis_key]['name'] !== '' && Array.isArray(option[xaxis_key])!==true) {
        var xaxis_name = option[xaxis_key]['name'];
      }
      else {
        var xaxis_name = 'X';
      }

      if (option[yaxis_key]['name'] !== null && option[yaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
        var yaxis_name = option[yaxis_key]['name'];
      }
      else {
        var yaxis_name = 'Y';
      }

      if (typeof zaxis_key !== 'undefined') {
        if (option[zaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
          var zaxis_name = option[zaxis_key]['name'];
        }
        else {
          var zaxis_name = 'Z';
        }
      }
  
      if (option['tooltip']) {
        if (option['tooltip']['precision']) {
          var precision = option['tooltip']['precision']
          option['tooltip']['valueFormatter'] = (value) =>  Math.round(Number(value) * (10**precision)) / (10**precision)
        }

        for (var ind_ = 0; ind_ < option['series'].length; ind_++) {
          if (option['series'][ind_]['tooltip']) {
            if (option['series'][ind_]['tooltip']['precision']) {
              var precision = option['series'][ind_]['tooltip']['precision']
              const fix = precision_ => value => Math.round(Number(value) * (10**precision_)) / (10**precision_),
              fix_p = fix(precision);
              option['series'][ind_]['tooltip']['valueFormatter'] = function (value) {
                return fix_p(value)
              } 
            }
          }
        }

        if (option['series'].length === 1) {
          if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][0]['type'])) {
            option['tooltip']['formatter'] = function(params) {
              if (params.seriesName.includes('series')) {
                var series_name = ''
              }
          
              else {
                var series_name = params.seriesName + '<br>'
              }
      
              if (params.seriesType === 'scatter') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                  + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                  +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                }
            
              }
  
              else if (params.seriesType === 'heatmap') {
                formatter = params.name + ', ' + option['yAxis'][0]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
              }
      
              else if (params.seriesType === 'scatter3D') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                    + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                    +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                    +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                }
              }
          
              else if (params.seriesType === 'radar') {
                formatter = params.name  + '<br>';
                for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                  if (ind_ !== option['radar']['indicator'].length - 1) {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                  }
                  else {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                  }
                }
              }
            return formatter;
            }
          }
        }
        else {
          for (var out_ind_ = 0; out_ind_ < option['series'].length; out_ind_++) {
            if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][out_ind_]['type'])) {
              if (option['series'][out_ind_]['tooltip']) {
              }
              else {
                option['series'][out_ind_]['tooltip'] = {}
              }
              option['series'][out_ind_]['tooltip']['formatter'] = function(params) {
                if (params.seriesName.includes('series')) {
                  var series_name = ''
                }
            
                else {
                  var series_name = params.seriesName + '<br>'
                }
        
                if (params.seriesType === 'scatter') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                  }
                }
    
                else if (params.seriesType === 'heatmap') {
                  if ('data' in option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]) {
                    formatter = params.name + ', ' + option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
                  }
                  else {
                    formatter = Math.round(params.data[2] * 10000) / 10000
                  }
                
                }
        
                else if (params.seriesType === 'scatter3D') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                      +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                  }
                }
            
                else if (params.seriesType === 'radar') {
                  formatter = params.name  + '<br>';
                  for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                    if (ind_ !== option['radar']['indicator'].length - 1) {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                    }
                    else {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                    }
                  }
                }
              return formatter;
              }
            }
          }
        }
      }
      return option;
    };

    function support_brush_event(option) {
      if (option['event']['type_'] === 'brushselected') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var last_selected = [];
        bind_chart.on(option['event']['type_'], (params) => {
          var brushed = [];
          var brushComponent = params.batch[0];
          for (var sIdx = 0; sIdx < brushComponent.selected.length; sIdx++) {
            var rawIndices = brushComponent.selected[sIdx].dataIndex;
            brushed.push(rawIndices);
          }
          var brushed_all = brushed[0];

          if (JSON.stringify(last_selected) !== JSON.stringify(brushed_all)) {

            // Update memory
            let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
              method: 'post',
              headers: {
                  'Content-Type': 'application/json;charset=utf-8;',
                  'Access-Control-Allow-Origin':'*',
                  'Access-Control-Allow-Credentials': 'true',
                  'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
              },
              body: JSON.stringify({'js_func_input':{'selected': brushed_all},
                                    'event_id': option['event']['event_id']})
            });
            var dom_dict = {}
            fetch(testRequest).then(response => {
              var result = response.json();
              result.then(res => {
                dom_dict[res['link_id']] = document.getElementById(res['link_id']);
                setInnerHTML(dom_dict[res['link_id']], res['html']);
              });
            });
            last_selected = brushed_all;
          }
                            
        // bind_chart.setOption(option);
        })
      }
      return option;
    };

    function support_click_event(option) {
      if (option['event']['type_'] === 'click') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        if (option['series'][0]['orient'] === 'vertical') {
          var value_idx = 0
        }
        else {
          var value_idx = 1
        }
    

        bind_chart.on(option['event']['type_'], (params) => {
          if (option['event']['task'] === 'singleselect') {
            for (var ind_2 = 0; ind_2 < option['series'][0]['data'].length; ind_2++) {
              if (option['series'][0]['data'][ind_2]['itemStyle']['color'] !== '#1f77b4') {
                option['series'][0]['data'][ind_2]['itemStyle']['color'] = '#1f77b4';
              }
            }
            var idx = option['series'][0]['x_value'].indexOf(params.value[value_idx])
            option['series'][0]['data'][idx]['itemStyle']['color'] = '#ff7f0e';

            var selected = params.value[value_idx];
          }
          else {
            console.log(params);
          }
      
          let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'selected': selected},
                                  'event_id': option['event']['event_id']})
          });
          var dom_dict = {}
          fetch(testRequest).then(response => {
            var result = response.json();
            result.then(res => {
              dom_dict[res['link_id']] = document.getElementById(res['link_id']);
              setInnerHTML(dom_dict[res['link_id']], res['html']);
            });
          });
          bind_chart.setOption(option);
        });
      }
      return option;
    };option = support_scientific_notation(option=option);option = custom_tooltip(option=option, dimension=2);option = custom_axis_label(option=option);option = auto_component_size(option=option);getScreenSize(option=option);

                myChart.setOption(option);
                window.addEventListener('resize', function () {
                    myChart.resize();
                    var option_copy = JSON.parse(JSON.stringify(option));
                    option_copy['figsize']['height'] = myChart.getHeight();
                    option_copy['figsize']['width'] = myChart.getWidth();
                    // option_copy = auto_component_size(option_copy);
                    myChart.setOption(option_copy);
                });
            <\/script>
            </body>
            </html>
        <style>
    .dg.main.taller-than-window .close-button {
        border-top: 1px solid #ddd;
    }

    .dg.main .close-button {
        background-color: #e8e8e8;
    }
 
    .dg.main .close-button:hover {
        background-color: #ddd;
    }

    .dg {
        color: #555;
        text-shadow: none !important;
    }

    .dg.main::-webkit-scrollbar {
        background: #fafafa;
    }

    .dg.main::-webkit-scrollbar-thumb {
        background: #bbb;
    }
 
    .dg li:not(.folder) {
        background: #fafafa;
        border-bottom: 1px solid #ddd;
    }
 
    .dg li.save-row .button {
        text-shadow: none !important;
    }

    .dg li.title {
        background: #e8e8e8 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;
    }

    .dg .cr.function:hover,.dg .cr.boolean:hover {
        background: #fff;
    }
 
    .dg .c input[type=text] {
        background: #e9e9e9;
    }
 
    .dg .c input[type=text]:hover {
        background: #eee;
    }
 
    .dg .c input[type=text]:focus {
        background: #eee;
        color: #555;
    }
 
    .dg .c .slider {
        background: #e9e9e9;
    }

    .dg .c .slider:hover {
        background: #eee;
    }<\/style>`);option = support_scientific_notation(option=option);option = custom_tooltip(option=option, dimension=2);option = custom_axis_label(option=option);option = auto_component_size(option=option);getScreenSize(option=option);

                if (option && typeof option === 'object') {
                    myChart.setOption(option);
                    }

                auto_axis_namegap(echarts_instance=myChart, auto_axis_list=[0], axis_type="2d");

            </script>
            </body>
            </html>
    
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 44-45

Density difference for variable PAY_1

.. GENERATED FROM PYTHON SOURCE LINES 45-47

.. code-block:: Python

    results.plot(("density", "PAY_1"))






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

                <!DOCTYPE html>
                <html lang="en" style="height: 100%">
                <head>
                <meta charset="utf-8">
                </head>
                <body style="height: 100%; margin: 0">

            
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts-gl/2.0.8/echarts-gl.min.js"></script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>
                <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"></script>
            
                <div id="1737119431.4929342" style="height: 600px; width: 600px; overflow: auto"></div>
            
                <script type="text/javascript">
                var dom = document.getElementById('1737119431.4929342');
                dom.innerHTML = ""
                dom.setAttribute('_echarts_instance_', '')
                var myChart = echarts.init(dom, null, {
                    renderer: 'canvas',
                    useDirtyRect: false
                    });
                var app = {};

                var option;
        option = {"chart_id": "1737119431.4929342", "link_id": null, "figname": "", "title": {"show": true, "text": "Density Comparison (PSI = 0.0076)", "link": "", "target": "blank", "textStyle": {"fontStyle": "normal", "fontWeight": "bolder", "fontFamily": "sans-serif", "fontSize": 15, "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "subtext": "", "sublink": "", "subtarget": "blank", "textAlign": "center", "textVerticalAlign": "auto", "padding": 0, "itemGap": 10, "z": 2, "left": "45.0%", "top": "5%", "right": "auto", "bottom": "auto", "backgroundColor": "transparent", "borderColor": "#ccc", "changed_name_key": {"id_": "id"}}, "grid": {"show": true, "width": "auto", "height": "auto", "z": 2, "left": "5%", "top": "10%", "right": "20%", "bottom": "5%", "borderColor": "#ccc", "borderWidth": 1, "containLabel": true, "backgroundColor": "transparent", "changed_name_key": {"id_": "id"}}, "legend": {"show": true, "type": "plain", "width": "auto", "height": "auto", "orient": "vertical", "align": "auto", "itemWidth": 25, "itemHeight": 14, "symbolRotate": "inherit", "selectedMode": true, "padding": 5, "itemGap": 10, "z": 4, "left": "auto", "top": "10%", "right": "1%", "bottom": "auto", "borderColor": "#ccc", "borderWidth": 1, "inactiveColor": "#ccc", "inactiveBorderColor": "#ccc", "inactiveBorderWidth": "auto", "selected": {}, "textStyle": {"overflow": "truncate", "fontSize": 12}, "pageButtonItemGap": 5, "pageButtonPosition": "end", "pageFormatter": "{current}/{total}", "pageIconColor": "#2f4554", "pageIconInactiveColor": "#aaa", "pageIconSize": 15, "animationDurationUpdate": 800, "selectorItemGap": 7, "selectorButtonGap": 10}, "brush": null, "yAxis": [{"show": true, "data": [0.004522267946761812, 0.0187386177917925, 0.059329738032196475, 0.14353602864642329, 0.26534020900749195, 0.3747997009972538, 0.40453364868719843, 0.3336879668302203, 0.21082769417086641, 0.10511930766592362, 0.056769077223862395, 0.0853905084372491, 0.22193213669039571, 0.4925810110296943, 0.8427244672594745, 1.1023687788673422, 1.10190286776841, 0.8416439624286144, 0.4914195868957033, 0.2205206951159634, 0.08154331538799983, 0.043982587859912214, 0.0705346632248715, 0.13892683269734896, 0.21941056901590353, 0.26574415429496895, 0.2460058433612596, 0.17404799264016502, 0.09432657279506448, 0.040391097398141736, 0.01892609652068195, 0.02490395492608956, 0.05574434060950553, 0.10615543344003658, 0.15577451550702318, 0.1747727862114743, 0.14983949722333434, 0.09816518847840917, 0.04917732853825372, 0.019015191142558233, 0.006377787285307265, 0.003925183610069793, 0.0064949068205373784, 0.01121410210733381, 0.015215863401770592, 0.015808528993340995, 0.01255203173972915, 0.007617223091275986, 0.003543374874030605, 0.0013139699513094233, 0.0005729401398566798, 0.0007319234298128871, 0.0014389027254565689, 0.0023547925421940415, 0.0029641792982575584, 0.00285247300322563, 0.002097527872682572, 0.0011785518394478098, 0.0005059916360683611, 0.00016599370084026876, 4.160959541966132e-05, 7.969828826964529e-06, 1.1664284667699617e-06, 1.3044301901240685e-07, 1.1146465821518168e-08, 7.277917882094182e-10, 3.6310374554168635e-11, 1.3842289311541509e-12, 4.032169038762336e-14, 8.97476642350661e-16, 1.5263748227486024e-17, 1.9835942858097223e-19, 1.9696910923518197e-21, 1.4947702770433563e-23, 6.231186577679566e-25, 8.250521911169525e-23, 9.695383349355151e-21, 8.705709772889878e-19, 5.97306168001113e-17, 3.1314352032082065e-15, 1.2544214598503966e-13, 3.839698604252864e-12, 8.980580542272026e-11, 1.604964031030437e-09, 2.191693455914562e-08, 2.2869039958865217e-07, 1.8233484456458347e-06, 1.1108234117374888e-05, 5.17099351336616e-05, 0.00018393169666277412, 0.0004999110959189017, 0.001038203745034095, 0.0016475022686883315, 0.0019976668685544327, 0.0018508606736843923, 0.0013103219136078607, 0.0007088198903422486, 0.0002929863605254065, 9.253638415404716e-05, 2.23321873913631e-05], "type": "value", "position": "bottom", "name": "", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": "auto", "min": -0.36, "max": 1.46, "splitNumber": 5, "logBase": 10, "axisLine": {"show": false}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": 40.0}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "xAxis": [{"show": true, "data": [-1.5953534690899125, -1.4924170353709243, -1.389480601651936, -1.2865441679329481, -1.18360773421396, -1.0806713004949717, -0.9777348667759836, -0.8747984330569956, -0.7718619993380074, -0.6689255656190192, -0.565989131900031, -0.463052698181043, -0.3601162644620548, -0.2571798307430666, -0.15424339702407863, -0.051306963305090436, 0.05162947041389776, 0.15456590413288596, 0.25750233785187415, 0.3604387715708621, 0.46337520528985054, 0.5663116390088385, 0.6692480727278265, 0.7721845064468149, 0.8751209401658029, 0.9780573738847909, 1.0809938076037793, 1.1839302413227673, 1.2868666750417552, 1.3898031087607436, 1.4927395424797316, 1.59567597619872, 1.698612409917708, 1.801548843636696, 1.9044852773556844, 2.0074217110746724, 2.110358144793661, 2.2132945785126488, 2.3162310122316367, 2.419167445950625, 2.5221038796696136, 2.625040313388601, 2.7279767471075895, 2.830913180826578, 2.9338496145455655, 3.036786048264554, 3.1397224819835423, 3.24265891570253, 3.3455953494215183, 3.4485317831405067, 3.551468216859494, 3.6544046505784826, 3.757341084297471, 3.8602775180164586, 3.963213951735447, 4.066150385454435, 4.1690868191734225, 4.272023252892412, 4.374959686611399, 4.477896120330389, 4.580832554049376, 4.683768987768364, 4.786705421487353, 4.8896418552063405, 4.992578288925328, 5.095514722644317, 5.198451156363305, 5.301387590082292, 5.404324023801282, 5.507260457520269, 5.610196891239257, 5.713133324958246, 5.816069758677234, 5.919006192396221, 6.0219426261152105, 6.124879059834198, 6.2278154935531855, 6.330751927272175, 6.433688360991162, 6.53662479471015, 6.639561228429139, 6.742497662148127, 6.845434095867114, 6.948370529586104, 7.051306963305091, 7.154243397024079, 7.257179830743068, 7.3601162644620555, 7.463052698181043, 7.565989131900032, 7.66892556561902, 7.771861999338007, 7.874798433056997, 7.977734866775984, 8.080671300494972, 8.183607734213961, 8.286544167932949, 8.389480601651936, 8.492417035370925, 8.595353469089913], "type": "value", "position": "bottom", "name": "PAY_1", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": 30, "min": -3.6335, "max": 10.6335, "splitNumber": 5, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": null}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "parallelAxis": null, "series": [{"type": "line", "name": "test", "colorBy": "series", "z": 2, "legendHoverLink": true, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "areaStyle": {}, "emphasis": {"focus": "series"}, "seriesLayoutBy": "column", "data": [[-1.5953534690899125, 0.004522267946761812], [-1.4924170353709243, 0.0187386177917925], [-1.389480601651936, 0.059329738032196475], [-1.2865441679329481, 0.14353602864642329], [-1.18360773421396, 0.26534020900749195], [-1.0806713004949717, 0.3747997009972538], [-0.9777348667759836, 0.40453364868719843], [-0.8747984330569956, 0.3336879668302203], [-0.7718619993380074, 0.21082769417086641], [-0.6689255656190192, 0.10511930766592362], [-0.565989131900031, 0.056769077223862395], [-0.463052698181043, 0.0853905084372491], [-0.3601162644620548, 0.22193213669039571], [-0.2571798307430666, 0.4925810110296943], [-0.15424339702407863, 0.8427244672594745], [-0.051306963305090436, 1.1023687788673422], [0.05162947041389776, 1.10190286776841], [0.15456590413288596, 0.8416439624286144], [0.25750233785187415, 0.4914195868957033], [0.3604387715708621, 0.2205206951159634], [0.46337520528985054, 0.08154331538799983], [0.5663116390088385, 0.043982587859912214], [0.6692480727278265, 0.0705346632248715], [0.7721845064468149, 0.13892683269734896], [0.8751209401658029, 0.21941056901590353], [0.9780573738847909, 0.26574415429496895], [1.0809938076037793, 0.2460058433612596], [1.1839302413227673, 0.17404799264016502], [1.2868666750417552, 0.09432657279506448], [1.3898031087607436, 0.040391097398141736], [1.4927395424797316, 0.01892609652068195], [1.59567597619872, 0.02490395492608956], [1.698612409917708, 0.05574434060950553], [1.801548843636696, 0.10615543344003658], [1.9044852773556844, 0.15577451550702318], [2.0074217110746724, 0.1747727862114743], [2.110358144793661, 0.14983949722333434], [2.2132945785126488, 0.09816518847840917], [2.3162310122316367, 0.04917732853825372], [2.419167445950625, 0.019015191142558233], [2.5221038796696136, 0.006377787285307265], [2.625040313388601, 0.003925183610069793], [2.7279767471075895, 0.0064949068205373784], [2.830913180826578, 0.01121410210733381], [2.9338496145455655, 0.015215863401770592], [3.036786048264554, 0.015808528993340995], [3.1397224819835423, 0.01255203173972915], [3.24265891570253, 0.007617223091275986], [3.3455953494215183, 0.003543374874030605], [3.4485317831405067, 0.0013139699513094233], [3.551468216859494, 0.0005729401398566798], [3.6544046505784826, 0.0007319234298128871], [3.757341084297471, 0.0014389027254565689], [3.8602775180164586, 0.0023547925421940415], [3.963213951735447, 0.0029641792982575584], [4.066150385454435, 0.00285247300322563], [4.1690868191734225, 0.002097527872682572], [4.272023252892412, 0.0011785518394478098], [4.374959686611399, 0.0005059916360683611], [4.477896120330389, 0.00016599370084026876], [4.580832554049376, 4.160959541966132e-05], [4.683768987768364, 7.969828826964529e-06], [4.786705421487353, 1.1664284667699617e-06], [4.8896418552063405, 1.3044301901240685e-07], [4.992578288925328, 1.1146465821518168e-08], [5.095514722644317, 7.277917882094182e-10], [5.198451156363305, 3.6310374554168635e-11], [5.301387590082292, 1.3842289311541509e-12], [5.404324023801282, 4.032169038762336e-14], [5.507260457520269, 8.97476642350661e-16], [5.610196891239257, 1.5263748227486024e-17], [5.713133324958246, 1.9835942858097223e-19], [5.816069758677234, 1.9696910923518197e-21], [5.919006192396221, 1.4947702770433563e-23], [6.0219426261152105, 6.231186577679566e-25], [6.124879059834198, 8.250521911169525e-23], [6.2278154935531855, 9.695383349355151e-21], [6.330751927272175, 8.705709772889878e-19], [6.433688360991162, 5.97306168001113e-17], [6.53662479471015, 3.1314352032082065e-15], [6.639561228429139, 1.2544214598503966e-13], [6.742497662148127, 3.839698604252864e-12], [6.845434095867114, 8.980580542272026e-11], [6.948370529586104, 1.604964031030437e-09], [7.051306963305091, 2.191693455914562e-08], [7.154243397024079, 2.2869039958865217e-07], [7.257179830743068, 1.8233484456458347e-06], [7.3601162644620555, 1.1108234117374888e-05], [7.463052698181043, 5.17099351336616e-05], [7.565989131900032, 0.00018393169666277412], [7.66892556561902, 0.0004999110959189017], [7.771861999338007, 0.001038203745034095], [7.874798433056997, 0.0016475022686883315], [7.977734866775984, 0.0019976668685544327], [8.080671300494972, 0.0018508606736843923], [8.183607734213961, 0.0013103219136078607], [8.286544167932949, 0.0007088198903422486], [8.389480601651936, 0.0002929863605254065], [8.492417035370925, 9.253638415404716e-05], [8.595353469089913, 2.23321873913631e-05]], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "linear", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "symbol": "none", "coordinateSystem": "cartesian2d", "symbolSize": 4, "symbolOffset": [0, 0], "showSymbol": true, "showAllSymbol": "auto", "smooth": true, "xlim": [-1.5953534690899125, 8.595353469089913], "tooltip_trigger": "item"}], "visualMap": null, "toolbox": {"show": true, "orient": "horizontal", "itemSize": 15, "itemGap": 8, "showTitle": true, "feature": {"dataZoom": {}, "saveAsImage": {}}, "z": 2, "left": "auto", "top": "auto", "right": "1%", "bottom": "auto", "width": "auto", "height": "auto", "popup": true, "changed_name_key": {"id_": "id"}}, "tooltip": {"show": true, "custom_tooltip": false, "trigger": "item", "axisPointer": {"show": true}, "showContent": true, "triggerOn": "mousemove|click", "hideDelay": 100, "enterable": true, "renderMode": "html", "confine": true, "transitionDuration": 0.4, "precision": 4, "borderColor": "#333", "padding": 5, "order": "seriesAsc"}, "dataZoom": null, "event": null, "graphic": null, "radar": null, "figsize": {"width": 600, "height": 600}, "color": ["#1f77b4", "#aec7e8", "#ff7f0e", "#ffbb78", "#2ca02c", "#98df8a", "#d62728", "#ff9896", "#9467bd", "#c5b0d5", "#8c564b", "#c49c94", "#e377c2", "#f7b6d2", "#7f7f7f", "#c7c7c7", "#bcbd22", "#dbdb8d", "#17becf", "#9edae5"], "save_img": false, "auto_size": true, "style": {"overflow": "auto"}, "port": "5006"};function setInnerHTML(elm, html) {
      elm.innerHTML = html;
  
      Array.from(elm.querySelectorAll("script"))
        .forEach( oldScriptEl => {
          const newScriptEl = document.createElement("script");
      
          Array.from(oldScriptEl.attributes).forEach( attr => {
            newScriptEl.setAttribute(attr.name, attr.value) 
          });
      
          const scriptText = document.createTextNode(oldScriptEl.innerHTML);
          newScriptEl.appendChild(scriptText);
      
          oldScriptEl.parentNode.replaceChild(newScriptEl, oldScriptEl);
      });
    };

    function getScreenSize(option) {
      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_result_save', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'height': screen.height, 'width': screen.width},
                                  'event_id': 'screen_size'})
          });
          fetch(testRequest).then(response => {});
      return 
    }
    function support_scientific_notation(option) {
      if (Array.isArray(option['yAxis'])) {
        for (var tar_ind = 0; tar_ind < option['yAxis'].length; tar_ind++) {
          if (option['yAxis'][tar_ind]['type'] === 'value') {
            option['yAxis'][tar_ind]['axisLabel']['formatter'] = function(val) {
              const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                        '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                        '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
              function toSuperscript(val) {
                if (val.toString().length > 5 && !val.toString().includes('.')) {
                  val = Number(val).toExponential().toString();
                  if (val.includes('-')) {
                    val = val.split('-');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁻' + val1
                  }
                  else if (val.includes('+')) {
                    val = val.split('+');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁺' + val1
                  }
                }
                else {
                  return val
                }
              }
              return toSuperscript(val)
            }
          }
        }
      }
      else {
        if (option['yAxis']['type'] === 'value') {
          option['yAxis']['axisLabel']['formatter'] = function(val) {
            const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                    '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                    '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
            function toSuperscript(val) {
              if (val.toString().length > 5 && !val.toString().includes('.')) {
                val = Number(val).toExponential().toString();
                if (val.includes('-')) {
                  val = val.split('-');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁻' + val1
                }
                else if (val.includes('+')) {
                  val = val.split('+');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁺' + val1
                }
              }
              else {
                return val
              }
            }
            return toSuperscript(val)
          }
        }
      };
      return option;
    };

    function auto_component_size(option) {
      if (typeof option['figsize']['width'] === 'string' || option['figsize']['width'] instanceof String) {
        if (option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['width'].includes('px')) {
          var width = parseFloat(option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = option['figsize']['width']
      }

      if (typeof option['figsize']['height'] === 'string' || option['figsize']['height'] instanceof String) {
        if (option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['height'].includes('px')) {
          var height = parseFloat(option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height']
      }

      var relative_ratio = Math.min(width / 700, height / 400)
      if ('xAxis3D' in option) {
        var keys = ['xAxis3D', 'yAxis3D', 'zAxis3D']
      }
      else {
        var keys = ['xAxis', 'yAxis']
      }
      for (single_key of keys) {
        for (var ind = 0; ind < option[single_key].length; ind++) {
          option[single_key][ind]['nameTextStyle']['fontSize'] = Math.max(7, option[single_key][ind]['nameTextStyle']['fontSize'] * relative_ratio);
          option[single_key][ind]['axisLabel']['fontSize'] = Math.max(7, option[single_key][ind]['axisLabel']['fontSize'] * relative_ratio);
        }
      }
      if (option['series']) {
        for (var ind = 0; ind < option['series'].length; ind++) {
          if (['heatmap', 'bar'].includes(option['series'][ind]['type'])) {
            if (option['series'][ind]['label']) {
              option['series'][ind]['label']['fontSize'] = Math.max(7, option['series'][ind]['label']['fontSize'] * relative_ratio);
            }
          }
        }
      }
      if (option['title']) {
        if (Array.isArray(option['title'])) {
          for (var ind = 0; ind < option['title'].length; ind++) {
            option['title'][ind]['textStyle']['fontSize'] = Math.max(9, option['title'][ind]['textStyle']['fontSize'] * relative_ratio);
          }
        }
        else {
          option['title']['textStyle']['fontSize'] = Math.max(9, option['title']['textStyle']['fontSize'] * relative_ratio);
        }
      }
      if (option['legend']) {
        option['legend']['itemHeight'] = option['legend']['itemHeight'] * relative_ratio;
        option['legend']['itemWidth'] = option['legend']['itemWidth'] * relative_ratio;
        option['legend']['textStyle']['fontSize'] = Math.max(7, option['legend']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['visualMap']) {
        option['visualMap']['itemHeight'] = option['visualMap']['itemHeight'] * relative_ratio;
        option['visualMap']['itemWidth'] = option['visualMap']['itemWidth'] * relative_ratio;
        option['visualMap']['textStyle']['fontSize'] = Math.max(7, option['visualMap']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['toolbox']) {
        option['toolbox']['itemSize'] = Math.max(8, option['toolbox']['itemSize'] * relative_ratio)
        option['toolbox']['itemGap'] = Math.max(4, option['toolbox']['itemGap'] * relative_ratio);
      }
      if (option['graphic']) {
        for (var ind = 0; ind < option['graphic'].length; ind++) {
          for (var ind2 = 0; ind2 < option['graphic'][ind]['children'].length; ind2++) {
            var new_font = Math.max(7, 12 * relative_ratio);
            option['graphic'][ind]['children'][ind2]['style']['font'] = new_font.toString() + 'px Microsoft YaHei';
          }
        }
      }
      return option;
    }

    function save_img(echarts_instance, option) {
      const base64_str = echarts_instance.getDataURL({
          pixelRatio: 2,
          backgroundColor: '#fff',
          width: option['figsize']['width'],
          height: option['figsize']['height']
      });

      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_image_save', {
        method: 'post',
        headers: {
          'Content-Type': 'application/json;charset=utf-8;',
          'Access-Control-Allow-Origin':'*',
          'Access-Control-Allow-Credentials': 'true',
          'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
        },
        body: JSON.stringify({'figname': option['figname'],
                              'base64_str': base64_str})
      });
      fetch(testRequest).then(response => {});
    };


    function auto_axis_namegap(echarts_instance, auto_axis_list, axis_type) {
      const globalModel = echarts_instance._api.getModel()
      const figsize = globalModel.option.figsize
      const ctx = document.createElement('canvas').getContext('2d')
      if (typeof globalModel.option['figsize']['width'] === 'string' || globalModel.option['figsize']['width'] instanceof String) {
        if (globalModel.option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(globalModel.option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['width'].includes('px')) {
          var width = parseFloat(globalModel.option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = globalModel.option['figsize']['width'];
      }

      if (typeof globalModel.option['figsize']['height'] === 'string' || globalModel.option['figsize']['height'] instanceof String) {
        if (globalModel.option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(globalModel.option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['height'].includes('px')) {
          var height = parseFloat(globalModel.option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height'];
      }
      var relative_ratio = Math.min(width / 700, height / 400);
      if (axis_type==='2d') {
        const yAxisList = globalModel.option.yAxis
        const xAxisList = globalModel.option.xAxis

        for (var axis_idx of auto_axis_list) {
          const yAxis = yAxisList[axis_idx]
          const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
          const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
          ctx.save()
          ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
  
          const yAxisComponent = globalModel.getComponent('yAxis', axis_idx)?.axis
          if (yAxis.type === 'value') {
            var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
          }
          else {
            var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
          }
          var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
          axisLabelMargin = axisLabelMargin * relative_ratio
          yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
          ctx.restore()
        };
  
        for (var axis_idx of [...Array(xAxisList.length).keys()]) {
          var new_gap = Math.max(xAxisList[axis_idx].nameGap * relative_ratio, 12);
          if (figsize['height'] < 400) {
            new_gap = Math.min(20, new_gap);
          }
          xAxisList[axis_idx].nameGap = new_gap;
        }
  
        echarts_instance.setOption({
          yAxis: yAxisList,
          xAxis: xAxisList
        })
      }
      else {
        const yAxisList = globalModel.option.yAxis3D
        const xAxisList = globalModel.option.xAxis3D
        const zAxisList = globalModel.option.zAxis3D

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < xAxisList.length) {
            const xAxis = xAxisList[axis_idx]
            const fontSize = xAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = xAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const xAxisComponent = globalModel.getComponent('xAxis3D', axis_idx)?.axis
            if (xAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = xAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            xAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < yAxisList.length) {
            const yAxis = yAxisList[axis_idx]
            const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const yAxisComponent = globalModel.getComponent('yAxis3D', axis_idx)?.axis
            if (yAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < zAxisList.length) {
            const zAxis = zAxisList[axis_idx]
            const fontSize = zAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = zAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const zAxisComponent = globalModel.getComponent('zAxis3D', axis_idx)?.axis
            if (zAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = zAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            zAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };
        echarts_instance.setOption({
          yAxis3D: yAxisList,
          xAxis3D: xAxisList,
          zAxis3D: zAxisList
        });
        }
  
    };

    function custom_scatter_size(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['symbolSize'] === 'array_size') {
          var ind_ = option['series'][ind]['data_dict']['size']
          option['series'][ind]['symbolSize'] = function (data) {return data[ind_];}
        }
      }
      return option;
  
    };

    function show_scatter_label(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['label'] === 'show_label') {
          var ind_ = option['series'][ind]['data_dict']['label']
          option['series'][ind]['label'] = {
            show: true,
            formatter: function (params) {return params.data.value[ind_]; }
          }
        }
      }
      return option;
    };

    function hide_min_max_axis_label(option) {
      for (var ind = 0; ind < option['xAxis3D'].length; ind++) {
        if (option['xAxis3D'][ind]['type'] == 'value') {
          var x_min = option['xAxis3D'][ind]['min']
          var x_max = option['xAxis3D'][ind]['max']
          option['xAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==x_min || value==x_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['yAxis3D'].length; ind++) {
        if (option['yAxis3D'][ind]['type'] == 'value') {  
          var y_min = option['yAxis3D'][ind]['min']
          var y_max = option['yAxis3D'][ind]['max']
          option['yAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==y_min || value==y_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['zAxis3D'].length; ind++) {
        if (option['zAxis3D'][ind]['type'] == 'value') {
          var z_min = option['zAxis3D'][ind]['min']
          var z_max = option['zAxis3D'][ind]['max']
          option['zAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==z_min || value==z_max){}
            else {return value}
          }
       }
      }
      return option;
    }

    function custom_axis_label(option) {
      if (Array.isArray(option['xAxis'])) {
        for (var ind = 0; ind < option['xAxis'].length; ind++) {
          if (option['xAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['xAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['xAxis'][ind]['axisLabel']['formatter_func'].body)
            option['xAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['xAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['xAxis']['axisLabel']['formatter_func'].arguments,
                               option['xAxis']['axisLabel']['formatter_func'].body)
          option['xAxis']['axisLabel']['formatter'] = f
        }
      }
      if (Array.isArray(option['yAxis'])) {
        for (var ind = 0; ind < option['yAxis'].length; ind++) {
          if (option['yAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['yAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['yAxis'][ind]['axisLabel']['formatter_func'].body)
            option['yAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['yAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['yAxis']['axisLabel']['formatter_func'].arguments,
                               option['yAxis']['axisLabel']['formatter_func'].body)
          option['yAxis']['axisLabel']['formatter'] = f
        }
      }
      return option;
    }

    function custom_tooltip(option, dimension=2) {

      if (dimension === 2) {
        var xaxis_key = 'xAxis'
        var yaxis_key = 'yAxis'
      }

      else if (dimension === 3) {
        var xaxis_key = 'xAxis3D'
        var yaxis_key = 'yAxis3D'
        var zaxis_key = 'zAxis3D'
      }

      if (option['radar']) {
        var radar_names = []
        for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
          radar_names.push(option['radar']['indicator'][ind_]['name']) 
        }
      }
  
  
      if (option[xaxis_key]['name'] !== null && option[xaxis_key]['name'] !== '' && Array.isArray(option[xaxis_key])!==true) {
        var xaxis_name = option[xaxis_key]['name'];
      }
      else {
        var xaxis_name = 'X';
      }

      if (option[yaxis_key]['name'] !== null && option[yaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
        var yaxis_name = option[yaxis_key]['name'];
      }
      else {
        var yaxis_name = 'Y';
      }

      if (typeof zaxis_key !== 'undefined') {
        if (option[zaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
          var zaxis_name = option[zaxis_key]['name'];
        }
        else {
          var zaxis_name = 'Z';
        }
      }
  
      if (option['tooltip']) {
        if (option['tooltip']['precision']) {
          var precision = option['tooltip']['precision']
          option['tooltip']['valueFormatter'] = (value) =>  Math.round(Number(value) * (10**precision)) / (10**precision)
        }

        for (var ind_ = 0; ind_ < option['series'].length; ind_++) {
          if (option['series'][ind_]['tooltip']) {
            if (option['series'][ind_]['tooltip']['precision']) {
              var precision = option['series'][ind_]['tooltip']['precision']
              const fix = precision_ => value => Math.round(Number(value) * (10**precision_)) / (10**precision_),
              fix_p = fix(precision);
              option['series'][ind_]['tooltip']['valueFormatter'] = function (value) {
                return fix_p(value)
              } 
            }
          }
        }

        if (option['series'].length === 1) {
          if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][0]['type'])) {
            option['tooltip']['formatter'] = function(params) {
              if (params.seriesName.includes('series')) {
                var series_name = ''
              }
          
              else {
                var series_name = params.seriesName + '<br>'
              }
      
              if (params.seriesType === 'scatter') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                  + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                  +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                }
            
              }
  
              else if (params.seriesType === 'heatmap') {
                formatter = params.name + ', ' + option['yAxis'][0]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
              }
      
              else if (params.seriesType === 'scatter3D') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                    + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                    +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                    +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                }
              }
          
              else if (params.seriesType === 'radar') {
                formatter = params.name  + '<br>';
                for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                  if (ind_ !== option['radar']['indicator'].length - 1) {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                  }
                  else {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                  }
                }
              }
            return formatter;
            }
          }
        }
        else {
          for (var out_ind_ = 0; out_ind_ < option['series'].length; out_ind_++) {
            if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][out_ind_]['type'])) {
              if (option['series'][out_ind_]['tooltip']) {
              }
              else {
                option['series'][out_ind_]['tooltip'] = {}
              }
              option['series'][out_ind_]['tooltip']['formatter'] = function(params) {
                if (params.seriesName.includes('series')) {
                  var series_name = ''
                }
            
                else {
                  var series_name = params.seriesName + '<br>'
                }
        
                if (params.seriesType === 'scatter') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                  }
                }
    
                else if (params.seriesType === 'heatmap') {
                  if ('data' in option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]) {
                    formatter = params.name + ', ' + option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
                  }
                  else {
                    formatter = Math.round(params.data[2] * 10000) / 10000
                  }
                
                }
        
                else if (params.seriesType === 'scatter3D') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                      +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                  }
                }
            
                else if (params.seriesType === 'radar') {
                  formatter = params.name  + '<br>';
                  for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                    if (ind_ !== option['radar']['indicator'].length - 1) {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                    }
                    else {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                    }
                  }
                }
              return formatter;
              }
            }
          }
        }
      }
      return option;
    };

    function support_brush_event(option) {
      if (option['event']['type_'] === 'brushselected') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var last_selected = [];
        bind_chart.on(option['event']['type_'], (params) => {
          var brushed = [];
          var brushComponent = params.batch[0];
          for (var sIdx = 0; sIdx < brushComponent.selected.length; sIdx++) {
            var rawIndices = brushComponent.selected[sIdx].dataIndex;
            brushed.push(rawIndices);
          }
          var brushed_all = brushed[0];

          if (JSON.stringify(last_selected) !== JSON.stringify(brushed_all)) {

            // Update memory
            let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
              method: 'post',
              headers: {
                  'Content-Type': 'application/json;charset=utf-8;',
                  'Access-Control-Allow-Origin':'*',
                  'Access-Control-Allow-Credentials': 'true',
                  'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
              },
              body: JSON.stringify({'js_func_input':{'selected': brushed_all},
                                    'event_id': option['event']['event_id']})
            });
            var dom_dict = {}
            fetch(testRequest).then(response => {
              var result = response.json();
              result.then(res => {
                dom_dict[res['link_id']] = document.getElementById(res['link_id']);
                setInnerHTML(dom_dict[res['link_id']], res['html']);
              });
            });
            last_selected = brushed_all;
          }
                            
        // bind_chart.setOption(option);
        })
      }
      return option;
    };

    function support_click_event(option) {
      if (option['event']['type_'] === 'click') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        if (option['series'][0]['orient'] === 'vertical') {
          var value_idx = 0
        }
        else {
          var value_idx = 1
        }
    

        bind_chart.on(option['event']['type_'], (params) => {
          if (option['event']['task'] === 'singleselect') {
            for (var ind_2 = 0; ind_2 < option['series'][0]['data'].length; ind_2++) {
              if (option['series'][0]['data'][ind_2]['itemStyle']['color'] !== '#1f77b4') {
                option['series'][0]['data'][ind_2]['itemStyle']['color'] = '#1f77b4';
              }
            }
            var idx = option['series'][0]['x_value'].indexOf(params.value[value_idx])
            option['series'][0]['data'][idx]['itemStyle']['color'] = '#ff7f0e';

            var selected = params.value[value_idx];
          }
          else {
            console.log(params);
          }
      
          let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'selected': selected},
                                  'event_id': option['event']['event_id']})
          });
          var dom_dict = {}
          fetch(testRequest).then(response => {
            var result = response.json();
            result.then(res => {
              dom_dict[res['link_id']] = document.getElementById(res['link_id']);
              setInnerHTML(dom_dict[res['link_id']], res['html']);
            });
          });
          bind_chart.setOption(option);
        });
      }
      return option;
    };function support_popup(option, height, width, inner_html) {
      option['toolbox']['feature']['myFeature'] = {
        show: true,
        title: 'Open in new window',
        icon: 'image://http://127.0.0.1:5001/resources/popup_icon',
        onclick: function (){
          var height_ = Math.min(screen.height, Math.round(1.5 * parseInt(height.slice(0,-2))))
          var width_ = Math.min(screen.width, Math.round(1.5 * parseInt(width.slice(0,-2))))
          var left = (screen.width/2)-(width_/2);
          var top = (screen.height/2)-(height_/2);
          var win = window.open('template.html', '_blank',
            `height=${height_}px, width=${width_}px, top=${top}px, left=${left}px`,
          );
          win.document.write(`${inner_html}`);
          win.document.close();
        }
      };
      return option;
    };option = support_popup(option=option, height="600px", width="600px", inner_html=`

            <html lang="en" style="height: 100%; text-align: -webkit-center; align-content: center">
            <title>MoCharts</title>
            <head> <meta charset="utf-8"> </head>
            <body style="height: 100%; margin: 0">
        
        
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"><\/script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts-gl/2.0.8/echarts-gl.min.js"><\/script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"><\/script>
                <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"><\/script>
            

            <div id="1737119431.4929342" style="height: 90%; width: 90%"></div>
            <script type="text/javascript">
                var dom = document.getElementById('1737119431.4929342');
                var myChart = echarts.init(dom, null, {
                    renderer: 'canvas',
                    useDirtyRect: false
                    });
                var app = {};

                var option;
            option = {"chart_id": "1737119431.4929342", "link_id": null, "figname": "", "title": {"show": true, "text": "Density Comparison (PSI = 0.0076)", "link": "", "target": "blank", "textStyle": {"fontStyle": "normal", "fontWeight": "bolder", "fontFamily": "sans-serif", "fontSize": 15, "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "subtext": "", "sublink": "", "subtarget": "blank", "textAlign": "center", "textVerticalAlign": "auto", "padding": 0, "itemGap": 10, "z": 2, "left": "45.0%", "top": "5%", "right": "auto", "bottom": "auto", "backgroundColor": "transparent", "borderColor": "#ccc", "changed_name_key": {"id_": "id"}}, "grid": {"show": true, "width": "auto", "height": "auto", "z": 2, "left": "5%", "top": "10%", "right": "20%", "bottom": "5%", "borderColor": "#ccc", "borderWidth": 1, "containLabel": true, "backgroundColor": "transparent", "changed_name_key": {"id_": "id"}}, "legend": {"show": true, "type": "plain", "width": "auto", "height": "auto", "orient": "vertical", "align": "auto", "itemWidth": 25, "itemHeight": 14, "symbolRotate": "inherit", "selectedMode": true, "padding": 5, "itemGap": 10, "z": 4, "left": "auto", "top": "10%", "right": "1%", "bottom": "auto", "borderColor": "#ccc", "borderWidth": 1, "inactiveColor": "#ccc", "inactiveBorderColor": "#ccc", "inactiveBorderWidth": "auto", "selected": {}, "textStyle": {"overflow": "truncate", "fontSize": 12}, "pageButtonItemGap": 5, "pageButtonPosition": "end", "pageFormatter": "{current}/{total}", "pageIconColor": "#2f4554", "pageIconInactiveColor": "#aaa", "pageIconSize": 15, "animationDurationUpdate": 800, "selectorItemGap": 7, "selectorButtonGap": 10}, "brush": null, "yAxis": [{"show": true, "data": [0.004522267946761812, 0.0187386177917925, 0.059329738032196475, 0.14353602864642329, 0.26534020900749195, 0.3747997009972538, 0.40453364868719843, 0.3336879668302203, 0.21082769417086641, 0.10511930766592362, 0.056769077223862395, 0.0853905084372491, 0.22193213669039571, 0.4925810110296943, 0.8427244672594745, 1.1023687788673422, 1.10190286776841, 0.8416439624286144, 0.4914195868957033, 0.2205206951159634, 0.08154331538799983, 0.043982587859912214, 0.0705346632248715, 0.13892683269734896, 0.21941056901590353, 0.26574415429496895, 0.2460058433612596, 0.17404799264016502, 0.09432657279506448, 0.040391097398141736, 0.01892609652068195, 0.02490395492608956, 0.05574434060950553, 0.10615543344003658, 0.15577451550702318, 0.1747727862114743, 0.14983949722333434, 0.09816518847840917, 0.04917732853825372, 0.019015191142558233, 0.006377787285307265, 0.003925183610069793, 0.0064949068205373784, 0.01121410210733381, 0.015215863401770592, 0.015808528993340995, 0.01255203173972915, 0.007617223091275986, 0.003543374874030605, 0.0013139699513094233, 0.0005729401398566798, 0.0007319234298128871, 0.0014389027254565689, 0.0023547925421940415, 0.0029641792982575584, 0.00285247300322563, 0.002097527872682572, 0.0011785518394478098, 0.0005059916360683611, 0.00016599370084026876, 4.160959541966132e-05, 7.969828826964529e-06, 1.1664284667699617e-06, 1.3044301901240685e-07, 1.1146465821518168e-08, 7.277917882094182e-10, 3.6310374554168635e-11, 1.3842289311541509e-12, 4.032169038762336e-14, 8.97476642350661e-16, 1.5263748227486024e-17, 1.9835942858097223e-19, 1.9696910923518197e-21, 1.4947702770433563e-23, 6.231186577679566e-25, 8.250521911169525e-23, 9.695383349355151e-21, 8.705709772889878e-19, 5.97306168001113e-17, 3.1314352032082065e-15, 1.2544214598503966e-13, 3.839698604252864e-12, 8.980580542272026e-11, 1.604964031030437e-09, 2.191693455914562e-08, 2.2869039958865217e-07, 1.8233484456458347e-06, 1.1108234117374888e-05, 5.17099351336616e-05, 0.00018393169666277412, 0.0004999110959189017, 0.001038203745034095, 0.0016475022686883315, 0.0019976668685544327, 0.0018508606736843923, 0.0013103219136078607, 0.0007088198903422486, 0.0002929863605254065, 9.253638415404716e-05, 2.23321873913631e-05], "type": "value", "position": "bottom", "name": "", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": "auto", "min": -0.36, "max": 1.46, "splitNumber": 5, "logBase": 10, "axisLine": {"show": false}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": 40.0}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "xAxis": [{"show": true, "data": [-1.5953534690899125, -1.4924170353709243, -1.389480601651936, -1.2865441679329481, -1.18360773421396, -1.0806713004949717, -0.9777348667759836, -0.8747984330569956, -0.7718619993380074, -0.6689255656190192, -0.565989131900031, -0.463052698181043, -0.3601162644620548, -0.2571798307430666, -0.15424339702407863, -0.051306963305090436, 0.05162947041389776, 0.15456590413288596, 0.25750233785187415, 0.3604387715708621, 0.46337520528985054, 0.5663116390088385, 0.6692480727278265, 0.7721845064468149, 0.8751209401658029, 0.9780573738847909, 1.0809938076037793, 1.1839302413227673, 1.2868666750417552, 1.3898031087607436, 1.4927395424797316, 1.59567597619872, 1.698612409917708, 1.801548843636696, 1.9044852773556844, 2.0074217110746724, 2.110358144793661, 2.2132945785126488, 2.3162310122316367, 2.419167445950625, 2.5221038796696136, 2.625040313388601, 2.7279767471075895, 2.830913180826578, 2.9338496145455655, 3.036786048264554, 3.1397224819835423, 3.24265891570253, 3.3455953494215183, 3.4485317831405067, 3.551468216859494, 3.6544046505784826, 3.757341084297471, 3.8602775180164586, 3.963213951735447, 4.066150385454435, 4.1690868191734225, 4.272023252892412, 4.374959686611399, 4.477896120330389, 4.580832554049376, 4.683768987768364, 4.786705421487353, 4.8896418552063405, 4.992578288925328, 5.095514722644317, 5.198451156363305, 5.301387590082292, 5.404324023801282, 5.507260457520269, 5.610196891239257, 5.713133324958246, 5.816069758677234, 5.919006192396221, 6.0219426261152105, 6.124879059834198, 6.2278154935531855, 6.330751927272175, 6.433688360991162, 6.53662479471015, 6.639561228429139, 6.742497662148127, 6.845434095867114, 6.948370529586104, 7.051306963305091, 7.154243397024079, 7.257179830743068, 7.3601162644620555, 7.463052698181043, 7.565989131900032, 7.66892556561902, 7.771861999338007, 7.874798433056997, 7.977734866775984, 8.080671300494972, 8.183607734213961, 8.286544167932949, 8.389480601651936, 8.492417035370925, 8.595353469089913], "type": "value", "position": "bottom", "name": "PAY_1", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": 30, "min": -3.6335, "max": 10.6335, "splitNumber": 5, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": null}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "parallelAxis": null, "series": [{"type": "line", "name": "test", "colorBy": "series", "z": 2, "legendHoverLink": true, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "areaStyle": {}, "emphasis": {"focus": "series"}, "seriesLayoutBy": "column", "data": [[-1.5953534690899125, 0.004522267946761812], [-1.4924170353709243, 0.0187386177917925], [-1.389480601651936, 0.059329738032196475], [-1.2865441679329481, 0.14353602864642329], [-1.18360773421396, 0.26534020900749195], [-1.0806713004949717, 0.3747997009972538], [-0.9777348667759836, 0.40453364868719843], [-0.8747984330569956, 0.3336879668302203], [-0.7718619993380074, 0.21082769417086641], [-0.6689255656190192, 0.10511930766592362], [-0.565989131900031, 0.056769077223862395], [-0.463052698181043, 0.0853905084372491], [-0.3601162644620548, 0.22193213669039571], [-0.2571798307430666, 0.4925810110296943], [-0.15424339702407863, 0.8427244672594745], [-0.051306963305090436, 1.1023687788673422], [0.05162947041389776, 1.10190286776841], [0.15456590413288596, 0.8416439624286144], [0.25750233785187415, 0.4914195868957033], [0.3604387715708621, 0.2205206951159634], [0.46337520528985054, 0.08154331538799983], [0.5663116390088385, 0.043982587859912214], [0.6692480727278265, 0.0705346632248715], [0.7721845064468149, 0.13892683269734896], [0.8751209401658029, 0.21941056901590353], [0.9780573738847909, 0.26574415429496895], [1.0809938076037793, 0.2460058433612596], [1.1839302413227673, 0.17404799264016502], [1.2868666750417552, 0.09432657279506448], [1.3898031087607436, 0.040391097398141736], [1.4927395424797316, 0.01892609652068195], [1.59567597619872, 0.02490395492608956], [1.698612409917708, 0.05574434060950553], [1.801548843636696, 0.10615543344003658], [1.9044852773556844, 0.15577451550702318], [2.0074217110746724, 0.1747727862114743], [2.110358144793661, 0.14983949722333434], [2.2132945785126488, 0.09816518847840917], [2.3162310122316367, 0.04917732853825372], [2.419167445950625, 0.019015191142558233], [2.5221038796696136, 0.006377787285307265], [2.625040313388601, 0.003925183610069793], [2.7279767471075895, 0.0064949068205373784], [2.830913180826578, 0.01121410210733381], [2.9338496145455655, 0.015215863401770592], [3.036786048264554, 0.015808528993340995], [3.1397224819835423, 0.01255203173972915], [3.24265891570253, 0.007617223091275986], [3.3455953494215183, 0.003543374874030605], [3.4485317831405067, 0.0013139699513094233], [3.551468216859494, 0.0005729401398566798], [3.6544046505784826, 0.0007319234298128871], [3.757341084297471, 0.0014389027254565689], [3.8602775180164586, 0.0023547925421940415], [3.963213951735447, 0.0029641792982575584], [4.066150385454435, 0.00285247300322563], [4.1690868191734225, 0.002097527872682572], [4.272023252892412, 0.0011785518394478098], [4.374959686611399, 0.0005059916360683611], [4.477896120330389, 0.00016599370084026876], [4.580832554049376, 4.160959541966132e-05], [4.683768987768364, 7.969828826964529e-06], [4.786705421487353, 1.1664284667699617e-06], [4.8896418552063405, 1.3044301901240685e-07], [4.992578288925328, 1.1146465821518168e-08], [5.095514722644317, 7.277917882094182e-10], [5.198451156363305, 3.6310374554168635e-11], [5.301387590082292, 1.3842289311541509e-12], [5.404324023801282, 4.032169038762336e-14], [5.507260457520269, 8.97476642350661e-16], [5.610196891239257, 1.5263748227486024e-17], [5.713133324958246, 1.9835942858097223e-19], [5.816069758677234, 1.9696910923518197e-21], [5.919006192396221, 1.4947702770433563e-23], [6.0219426261152105, 6.231186577679566e-25], [6.124879059834198, 8.250521911169525e-23], [6.2278154935531855, 9.695383349355151e-21], [6.330751927272175, 8.705709772889878e-19], [6.433688360991162, 5.97306168001113e-17], [6.53662479471015, 3.1314352032082065e-15], [6.639561228429139, 1.2544214598503966e-13], [6.742497662148127, 3.839698604252864e-12], [6.845434095867114, 8.980580542272026e-11], [6.948370529586104, 1.604964031030437e-09], [7.051306963305091, 2.191693455914562e-08], [7.154243397024079, 2.2869039958865217e-07], [7.257179830743068, 1.8233484456458347e-06], [7.3601162644620555, 1.1108234117374888e-05], [7.463052698181043, 5.17099351336616e-05], [7.565989131900032, 0.00018393169666277412], [7.66892556561902, 0.0004999110959189017], [7.771861999338007, 0.001038203745034095], [7.874798433056997, 0.0016475022686883315], [7.977734866775984, 0.0019976668685544327], [8.080671300494972, 0.0018508606736843923], [8.183607734213961, 0.0013103219136078607], [8.286544167932949, 0.0007088198903422486], [8.389480601651936, 0.0002929863605254065], [8.492417035370925, 9.253638415404716e-05], [8.595353469089913, 2.23321873913631e-05]], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "linear", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "symbol": "none", "coordinateSystem": "cartesian2d", "symbolSize": 4, "symbolOffset": [0, 0], "showSymbol": true, "showAllSymbol": "auto", "smooth": true, "xlim": [-1.5953534690899125, 8.595353469089913], "tooltip_trigger": "item"}], "visualMap": null, "toolbox": {"show": true, "orient": "horizontal", "itemSize": 15, "itemGap": 8, "showTitle": true, "feature": {"dataZoom": {}, "saveAsImage": {}}, "z": 2, "left": "auto", "top": "auto", "right": "1%", "bottom": "auto", "width": "auto", "height": "auto", "popup": true, "changed_name_key": {"id_": "id"}}, "tooltip": {"show": true, "custom_tooltip": false, "trigger": "item", "axisPointer": {"show": true}, "showContent": true, "triggerOn": "mousemove|click", "hideDelay": 100, "enterable": true, "renderMode": "html", "confine": true, "transitionDuration": 0.4, "precision": 4, "borderColor": "#333", "padding": 5, "order": "seriesAsc"}, "dataZoom": null, "event": null, "graphic": null, "radar": null, "figsize": {"width": 600, "height": 600}, "color": ["#1f77b4", "#aec7e8", "#ff7f0e", "#ffbb78", "#2ca02c", "#98df8a", "#d62728", "#ff9896", "#9467bd", "#c5b0d5", "#8c564b", "#c49c94", "#e377c2", "#f7b6d2", "#7f7f7f", "#c7c7c7", "#bcbd22", "#dbdb8d", "#17becf", "#9edae5"], "save_img": false, "auto_size": true, "style": {"overflow": "auto"}, "port": "5006"};function setInnerHTML(elm, html) {
      elm.innerHTML = html;
  
      Array.from(elm.querySelectorAll("script"))
        .forEach( oldScriptEl => {
          const newScriptEl = document.createElement("script");
      
          Array.from(oldScriptEl.attributes).forEach( attr => {
            newScriptEl.setAttribute(attr.name, attr.value) 
          });
      
          const scriptText = document.createTextNode(oldScriptEl.innerHTML);
          newScriptEl.appendChild(scriptText);
      
          oldScriptEl.parentNode.replaceChild(newScriptEl, oldScriptEl);
      });
    };

    function getScreenSize(option) {
      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_result_save', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'height': screen.height, 'width': screen.width},
                                  'event_id': 'screen_size'})
          });
          fetch(testRequest).then(response => {});
      return 
    }
    function support_scientific_notation(option) {
      if (Array.isArray(option['yAxis'])) {
        for (var tar_ind = 0; tar_ind < option['yAxis'].length; tar_ind++) {
          if (option['yAxis'][tar_ind]['type'] === 'value') {
            option['yAxis'][tar_ind]['axisLabel']['formatter'] = function(val) {
              const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                        '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                        '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
              function toSuperscript(val) {
                if (val.toString().length > 5 && !val.toString().includes('.')) {
                  val = Number(val).toExponential().toString();
                  if (val.includes('-')) {
                    val = val.split('-');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁻' + val1
                  }
                  else if (val.includes('+')) {
                    val = val.split('+');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁺' + val1
                  }
                }
                else {
                  return val
                }
              }
              return toSuperscript(val)
            }
          }
        }
      }
      else {
        if (option['yAxis']['type'] === 'value') {
          option['yAxis']['axisLabel']['formatter'] = function(val) {
            const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                    '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                    '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
            function toSuperscript(val) {
              if (val.toString().length > 5 && !val.toString().includes('.')) {
                val = Number(val).toExponential().toString();
                if (val.includes('-')) {
                  val = val.split('-');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁻' + val1
                }
                else if (val.includes('+')) {
                  val = val.split('+');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁺' + val1
                }
              }
              else {
                return val
              }
            }
            return toSuperscript(val)
          }
        }
      };
      return option;
    };

    function auto_component_size(option) {
      if (typeof option['figsize']['width'] === 'string' || option['figsize']['width'] instanceof String) {
        if (option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['width'].includes('px')) {
          var width = parseFloat(option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = option['figsize']['width']
      }

      if (typeof option['figsize']['height'] === 'string' || option['figsize']['height'] instanceof String) {
        if (option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['height'].includes('px')) {
          var height = parseFloat(option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height']
      }

      var relative_ratio = Math.min(width / 700, height / 400)
      if ('xAxis3D' in option) {
        var keys = ['xAxis3D', 'yAxis3D', 'zAxis3D']
      }
      else {
        var keys = ['xAxis', 'yAxis']
      }
      for (single_key of keys) {
        for (var ind = 0; ind < option[single_key].length; ind++) {
          option[single_key][ind]['nameTextStyle']['fontSize'] = Math.max(7, option[single_key][ind]['nameTextStyle']['fontSize'] * relative_ratio);
          option[single_key][ind]['axisLabel']['fontSize'] = Math.max(7, option[single_key][ind]['axisLabel']['fontSize'] * relative_ratio);
        }
      }
      if (option['series']) {
        for (var ind = 0; ind < option['series'].length; ind++) {
          if (['heatmap', 'bar'].includes(option['series'][ind]['type'])) {
            if (option['series'][ind]['label']) {
              option['series'][ind]['label']['fontSize'] = Math.max(7, option['series'][ind]['label']['fontSize'] * relative_ratio);
            }
          }
        }
      }
      if (option['title']) {
        if (Array.isArray(option['title'])) {
          for (var ind = 0; ind < option['title'].length; ind++) {
            option['title'][ind]['textStyle']['fontSize'] = Math.max(9, option['title'][ind]['textStyle']['fontSize'] * relative_ratio);
          }
        }
        else {
          option['title']['textStyle']['fontSize'] = Math.max(9, option['title']['textStyle']['fontSize'] * relative_ratio);
        }
      }
      if (option['legend']) {
        option['legend']['itemHeight'] = option['legend']['itemHeight'] * relative_ratio;
        option['legend']['itemWidth'] = option['legend']['itemWidth'] * relative_ratio;
        option['legend']['textStyle']['fontSize'] = Math.max(7, option['legend']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['visualMap']) {
        option['visualMap']['itemHeight'] = option['visualMap']['itemHeight'] * relative_ratio;
        option['visualMap']['itemWidth'] = option['visualMap']['itemWidth'] * relative_ratio;
        option['visualMap']['textStyle']['fontSize'] = Math.max(7, option['visualMap']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['toolbox']) {
        option['toolbox']['itemSize'] = Math.max(8, option['toolbox']['itemSize'] * relative_ratio)
        option['toolbox']['itemGap'] = Math.max(4, option['toolbox']['itemGap'] * relative_ratio);
      }
      if (option['graphic']) {
        for (var ind = 0; ind < option['graphic'].length; ind++) {
          for (var ind2 = 0; ind2 < option['graphic'][ind]['children'].length; ind2++) {
            var new_font = Math.max(7, 12 * relative_ratio);
            option['graphic'][ind]['children'][ind2]['style']['font'] = new_font.toString() + 'px Microsoft YaHei';
          }
        }
      }
      return option;
    }

    function save_img(echarts_instance, option) {
      const base64_str = echarts_instance.getDataURL({
          pixelRatio: 2,
          backgroundColor: '#fff',
          width: option['figsize']['width'],
          height: option['figsize']['height']
      });

      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_image_save', {
        method: 'post',
        headers: {
          'Content-Type': 'application/json;charset=utf-8;',
          'Access-Control-Allow-Origin':'*',
          'Access-Control-Allow-Credentials': 'true',
          'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
        },
        body: JSON.stringify({'figname': option['figname'],
                              'base64_str': base64_str})
      });
      fetch(testRequest).then(response => {});
    };


    function auto_axis_namegap(echarts_instance, auto_axis_list, axis_type) {
      const globalModel = echarts_instance._api.getModel()
      const figsize = globalModel.option.figsize
      const ctx = document.createElement('canvas').getContext('2d')
      if (typeof globalModel.option['figsize']['width'] === 'string' || globalModel.option['figsize']['width'] instanceof String) {
        if (globalModel.option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(globalModel.option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['width'].includes('px')) {
          var width = parseFloat(globalModel.option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = globalModel.option['figsize']['width'];
      }

      if (typeof globalModel.option['figsize']['height'] === 'string' || globalModel.option['figsize']['height'] instanceof String) {
        if (globalModel.option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(globalModel.option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['height'].includes('px')) {
          var height = parseFloat(globalModel.option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height'];
      }
      var relative_ratio = Math.min(width / 700, height / 400);
      if (axis_type==='2d') {
        const yAxisList = globalModel.option.yAxis
        const xAxisList = globalModel.option.xAxis

        for (var axis_idx of auto_axis_list) {
          const yAxis = yAxisList[axis_idx]
          const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
          const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
          ctx.save()
          ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
  
          const yAxisComponent = globalModel.getComponent('yAxis', axis_idx)?.axis
          if (yAxis.type === 'value') {
            var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
          }
          else {
            var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
          }
          var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
          axisLabelMargin = axisLabelMargin * relative_ratio
          yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
          ctx.restore()
        };
  
        for (var axis_idx of [...Array(xAxisList.length).keys()]) {
          var new_gap = Math.max(xAxisList[axis_idx].nameGap * relative_ratio, 12);
          if (figsize['height'] < 400) {
            new_gap = Math.min(20, new_gap);
          }
          xAxisList[axis_idx].nameGap = new_gap;
        }
  
        echarts_instance.setOption({
          yAxis: yAxisList,
          xAxis: xAxisList
        })
      }
      else {
        const yAxisList = globalModel.option.yAxis3D
        const xAxisList = globalModel.option.xAxis3D
        const zAxisList = globalModel.option.zAxis3D

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < xAxisList.length) {
            const xAxis = xAxisList[axis_idx]
            const fontSize = xAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = xAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const xAxisComponent = globalModel.getComponent('xAxis3D', axis_idx)?.axis
            if (xAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = xAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            xAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < yAxisList.length) {
            const yAxis = yAxisList[axis_idx]
            const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const yAxisComponent = globalModel.getComponent('yAxis3D', axis_idx)?.axis
            if (yAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < zAxisList.length) {
            const zAxis = zAxisList[axis_idx]
            const fontSize = zAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = zAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const zAxisComponent = globalModel.getComponent('zAxis3D', axis_idx)?.axis
            if (zAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = zAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            zAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };
        echarts_instance.setOption({
          yAxis3D: yAxisList,
          xAxis3D: xAxisList,
          zAxis3D: zAxisList
        });
        }
  
    };

    function custom_scatter_size(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['symbolSize'] === 'array_size') {
          var ind_ = option['series'][ind]['data_dict']['size']
          option['series'][ind]['symbolSize'] = function (data) {return data[ind_];}
        }
      }
      return option;
  
    };

    function show_scatter_label(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['label'] === 'show_label') {
          var ind_ = option['series'][ind]['data_dict']['label']
          option['series'][ind]['label'] = {
            show: true,
            formatter: function (params) {return params.data.value[ind_]; }
          }
        }
      }
      return option;
    };

    function hide_min_max_axis_label(option) {
      for (var ind = 0; ind < option['xAxis3D'].length; ind++) {
        if (option['xAxis3D'][ind]['type'] == 'value') {
          var x_min = option['xAxis3D'][ind]['min']
          var x_max = option['xAxis3D'][ind]['max']
          option['xAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==x_min || value==x_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['yAxis3D'].length; ind++) {
        if (option['yAxis3D'][ind]['type'] == 'value') {  
          var y_min = option['yAxis3D'][ind]['min']
          var y_max = option['yAxis3D'][ind]['max']
          option['yAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==y_min || value==y_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['zAxis3D'].length; ind++) {
        if (option['zAxis3D'][ind]['type'] == 'value') {
          var z_min = option['zAxis3D'][ind]['min']
          var z_max = option['zAxis3D'][ind]['max']
          option['zAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==z_min || value==z_max){}
            else {return value}
          }
       }
      }
      return option;
    }

    function custom_axis_label(option) {
      if (Array.isArray(option['xAxis'])) {
        for (var ind = 0; ind < option['xAxis'].length; ind++) {
          if (option['xAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['xAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['xAxis'][ind]['axisLabel']['formatter_func'].body)
            option['xAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['xAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['xAxis']['axisLabel']['formatter_func'].arguments,
                               option['xAxis']['axisLabel']['formatter_func'].body)
          option['xAxis']['axisLabel']['formatter'] = f
        }
      }
      if (Array.isArray(option['yAxis'])) {
        for (var ind = 0; ind < option['yAxis'].length; ind++) {
          if (option['yAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['yAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['yAxis'][ind]['axisLabel']['formatter_func'].body)
            option['yAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['yAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['yAxis']['axisLabel']['formatter_func'].arguments,
                               option['yAxis']['axisLabel']['formatter_func'].body)
          option['yAxis']['axisLabel']['formatter'] = f
        }
      }
      return option;
    }

    function custom_tooltip(option, dimension=2) {

      if (dimension === 2) {
        var xaxis_key = 'xAxis'
        var yaxis_key = 'yAxis'
      }

      else if (dimension === 3) {
        var xaxis_key = 'xAxis3D'
        var yaxis_key = 'yAxis3D'
        var zaxis_key = 'zAxis3D'
      }

      if (option['radar']) {
        var radar_names = []
        for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
          radar_names.push(option['radar']['indicator'][ind_]['name']) 
        }
      }
  
  
      if (option[xaxis_key]['name'] !== null && option[xaxis_key]['name'] !== '' && Array.isArray(option[xaxis_key])!==true) {
        var xaxis_name = option[xaxis_key]['name'];
      }
      else {
        var xaxis_name = 'X';
      }

      if (option[yaxis_key]['name'] !== null && option[yaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
        var yaxis_name = option[yaxis_key]['name'];
      }
      else {
        var yaxis_name = 'Y';
      }

      if (typeof zaxis_key !== 'undefined') {
        if (option[zaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
          var zaxis_name = option[zaxis_key]['name'];
        }
        else {
          var zaxis_name = 'Z';
        }
      }
  
      if (option['tooltip']) {
        if (option['tooltip']['precision']) {
          var precision = option['tooltip']['precision']
          option['tooltip']['valueFormatter'] = (value) =>  Math.round(Number(value) * (10**precision)) / (10**precision)
        }

        for (var ind_ = 0; ind_ < option['series'].length; ind_++) {
          if (option['series'][ind_]['tooltip']) {
            if (option['series'][ind_]['tooltip']['precision']) {
              var precision = option['series'][ind_]['tooltip']['precision']
              const fix = precision_ => value => Math.round(Number(value) * (10**precision_)) / (10**precision_),
              fix_p = fix(precision);
              option['series'][ind_]['tooltip']['valueFormatter'] = function (value) {
                return fix_p(value)
              } 
            }
          }
        }

        if (option['series'].length === 1) {
          if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][0]['type'])) {
            option['tooltip']['formatter'] = function(params) {
              if (params.seriesName.includes('series')) {
                var series_name = ''
              }
          
              else {
                var series_name = params.seriesName + '<br>'
              }
      
              if (params.seriesType === 'scatter') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                  + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                  +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                }
            
              }
  
              else if (params.seriesType === 'heatmap') {
                formatter = params.name + ', ' + option['yAxis'][0]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
              }
      
              else if (params.seriesType === 'scatter3D') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                    + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                    +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                    +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                }
              }
          
              else if (params.seriesType === 'radar') {
                formatter = params.name  + '<br>';
                for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                  if (ind_ !== option['radar']['indicator'].length - 1) {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                  }
                  else {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                  }
                }
              }
            return formatter;
            }
          }
        }
        else {
          for (var out_ind_ = 0; out_ind_ < option['series'].length; out_ind_++) {
            if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][out_ind_]['type'])) {
              if (option['series'][out_ind_]['tooltip']) {
              }
              else {
                option['series'][out_ind_]['tooltip'] = {}
              }
              option['series'][out_ind_]['tooltip']['formatter'] = function(params) {
                if (params.seriesName.includes('series')) {
                  var series_name = ''
                }
            
                else {
                  var series_name = params.seriesName + '<br>'
                }
        
                if (params.seriesType === 'scatter') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                  }
                }
    
                else if (params.seriesType === 'heatmap') {
                  if ('data' in option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]) {
                    formatter = params.name + ', ' + option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
                  }
                  else {
                    formatter = Math.round(params.data[2] * 10000) / 10000
                  }
                
                }
        
                else if (params.seriesType === 'scatter3D') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                      +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                  }
                }
            
                else if (params.seriesType === 'radar') {
                  formatter = params.name  + '<br>';
                  for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                    if (ind_ !== option['radar']['indicator'].length - 1) {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                    }
                    else {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                    }
                  }
                }
              return formatter;
              }
            }
          }
        }
      }
      return option;
    };

    function support_brush_event(option) {
      if (option['event']['type_'] === 'brushselected') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var last_selected = [];
        bind_chart.on(option['event']['type_'], (params) => {
          var brushed = [];
          var brushComponent = params.batch[0];
          for (var sIdx = 0; sIdx < brushComponent.selected.length; sIdx++) {
            var rawIndices = brushComponent.selected[sIdx].dataIndex;
            brushed.push(rawIndices);
          }
          var brushed_all = brushed[0];

          if (JSON.stringify(last_selected) !== JSON.stringify(brushed_all)) {

            // Update memory
            let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
              method: 'post',
              headers: {
                  'Content-Type': 'application/json;charset=utf-8;',
                  'Access-Control-Allow-Origin':'*',
                  'Access-Control-Allow-Credentials': 'true',
                  'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
              },
              body: JSON.stringify({'js_func_input':{'selected': brushed_all},
                                    'event_id': option['event']['event_id']})
            });
            var dom_dict = {}
            fetch(testRequest).then(response => {
              var result = response.json();
              result.then(res => {
                dom_dict[res['link_id']] = document.getElementById(res['link_id']);
                setInnerHTML(dom_dict[res['link_id']], res['html']);
              });
            });
            last_selected = brushed_all;
          }
                            
        // bind_chart.setOption(option);
        })
      }
      return option;
    };

    function support_click_event(option) {
      if (option['event']['type_'] === 'click') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        if (option['series'][0]['orient'] === 'vertical') {
          var value_idx = 0
        }
        else {
          var value_idx = 1
        }
    

        bind_chart.on(option['event']['type_'], (params) => {
          if (option['event']['task'] === 'singleselect') {
            for (var ind_2 = 0; ind_2 < option['series'][0]['data'].length; ind_2++) {
              if (option['series'][0]['data'][ind_2]['itemStyle']['color'] !== '#1f77b4') {
                option['series'][0]['data'][ind_2]['itemStyle']['color'] = '#1f77b4';
              }
            }
            var idx = option['series'][0]['x_value'].indexOf(params.value[value_idx])
            option['series'][0]['data'][idx]['itemStyle']['color'] = '#ff7f0e';

            var selected = params.value[value_idx];
          }
          else {
            console.log(params);
          }
      
          let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'selected': selected},
                                  'event_id': option['event']['event_id']})
          });
          var dom_dict = {}
          fetch(testRequest).then(response => {
            var result = response.json();
            result.then(res => {
              dom_dict[res['link_id']] = document.getElementById(res['link_id']);
              setInnerHTML(dom_dict[res['link_id']], res['html']);
            });
          });
          bind_chart.setOption(option);
        });
      }
      return option;
    };option = support_scientific_notation(option=option);option = custom_tooltip(option=option, dimension=2);option = custom_axis_label(option=option);option = auto_component_size(option=option);getScreenSize(option=option);

                myChart.setOption(option);
                window.addEventListener('resize', function () {
                    myChart.resize();
                    var option_copy = JSON.parse(JSON.stringify(option));
                    option_copy['figsize']['height'] = myChart.getHeight();
                    option_copy['figsize']['width'] = myChart.getWidth();
                    // option_copy = auto_component_size(option_copy);
                    myChart.setOption(option_copy);
                });
            <\/script>
            </body>
            </html>
        <style>
    .dg.main.taller-than-window .close-button {
        border-top: 1px solid #ddd;
    }

    .dg.main .close-button {
        background-color: #e8e8e8;
    }
 
    .dg.main .close-button:hover {
        background-color: #ddd;
    }

    .dg {
        color: #555;
        text-shadow: none !important;
    }

    .dg.main::-webkit-scrollbar {
        background: #fafafa;
    }

    .dg.main::-webkit-scrollbar-thumb {
        background: #bbb;
    }
 
    .dg li:not(.folder) {
        background: #fafafa;
        border-bottom: 1px solid #ddd;
    }
 
    .dg li.save-row .button {
        text-shadow: none !important;
    }

    .dg li.title {
        background: #e8e8e8 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;
    }

    .dg .cr.function:hover,.dg .cr.boolean:hover {
        background: #fff;
    }
 
    .dg .c input[type=text] {
        background: #e9e9e9;
    }
 
    .dg .c input[type=text]:hover {
        background: #eee;
    }
 
    .dg .c input[type=text]:focus {
        background: #eee;
        color: #555;
    }
 
    .dg .c .slider {
        background: #e9e9e9;
    }

    .dg .c .slider:hover {
        background: #eee;
    }<\/style>`);option = support_scientific_notation(option=option);option = custom_tooltip(option=option, dimension=2);option = custom_axis_label(option=option);option = auto_component_size(option=option);getScreenSize(option=option);

                if (option && typeof option === 'object') {
                    myChart.setOption(option);
                    }

                auto_axis_namegap(echarts_instance=myChart, auto_axis_list=[0], axis_type="2d");

            </script>
            </body>
            </html>
    
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 48-49

Density difference for variable EDUCATION

.. GENERATED FROM PYTHON SOURCE LINES 49-50

.. code-block:: Python

    results.plot(("density", "EDUCATION"))





.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

                <!DOCTYPE html>
                <html lang="en" style="height: 100%">
                <head>
                <meta charset="utf-8">
                </head>
                <body style="height: 100%; margin: 0">

            
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts-gl/2.0.8/echarts-gl.min.js"></script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>
                <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"></script>
            
                <div id="1737119431.5332484" style="height: 600px; width: 600px; overflow: auto"></div>
            
                <script type="text/javascript">
                var dom = document.getElementById('1737119431.5332484');
                dom.innerHTML = ""
                dom.setAttribute('_echarts_instance_', '')
                var myChart = echarts.init(dom, null, {
                    renderer: 'canvas',
                    useDirtyRect: false
                    });
                var app = {};

                var option;
        option = {"chart_id": "1737119431.5332484", "link_id": null, "figname": "", "title": {"show": true, "text": "Density Comparison (PSI = 0.0050)", "link": "", "target": "blank", "textStyle": {"fontStyle": "normal", "fontWeight": "bolder", "fontFamily": "sans-serif", "fontSize": 15, "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "subtext": "", "sublink": "", "subtarget": "blank", "textAlign": "center", "textVerticalAlign": "auto", "padding": 0, "itemGap": 10, "z": 2, "left": "45.0%", "top": "5%", "right": "auto", "bottom": "auto", "backgroundColor": "transparent", "borderColor": "#ccc", "changed_name_key": {"id_": "id"}}, "grid": {"show": true, "width": "auto", "height": "auto", "z": 2, "left": "5%", "top": "10%", "right": "20%", "bottom": "5%", "borderColor": "#ccc", "borderWidth": 1, "containLabel": true, "backgroundColor": "transparent", "changed_name_key": {"id_": "id"}}, "legend": {"show": true, "type": "plain", "width": "auto", "height": "auto", "orient": "vertical", "align": "auto", "itemWidth": 25, "itemHeight": 14, "symbolRotate": "inherit", "selectedMode": true, "padding": 5, "itemGap": 10, "z": 4, "left": "auto", "top": "10%", "right": "1%", "bottom": "auto", "borderColor": "#ccc", "borderWidth": 1, "inactiveColor": "#ccc", "inactiveBorderColor": "#ccc", "inactiveBorderWidth": "auto", "selected": {}, "textStyle": {"overflow": "truncate", "fontSize": 12}, "pageButtonItemGap": 5, "pageButtonPosition": "end", "pageFormatter": "{current}/{total}", "pageIconColor": "#2f4554", "pageIconInactiveColor": "#aaa", "pageIconSize": 15, "animationDurationUpdate": 800, "selectorItemGap": 7, "selectorButtonGap": 10}, "brush": null, "yAxis": [{"show": true, "type": "value", "position": "bottom", "name": "Percentage", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": "auto", "min": -0.1584, "max": 0.6214, "splitNumber": 5, "logBase": 10, "axisLine": {"show": false}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": 40.0}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "xAxis": [{"show": true, "data": ["0.0", "1.0", "2.0", "3.0"], "type": "category", "position": "bottom", "name": "EDUCATION", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": 30, "splitNumber": 5, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": true, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": null}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "parallelAxis": null, "series": [{"type": "bar", "name": "test", "colorBy": "series", "z": 2, "legendHoverLink": true, "stack": "", "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "label": {"show": false, "color": "black", "position": null, "fontSize": 12}, "itemStyle": {}, "seriesLayoutBy": "column", "data": [{"value": ["0.0", 0.01], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["1.0", 0.357], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["2.0", 0.468], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["3.0", 0.165], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["0.0", 0.009], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["1.0", 0.391], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["2.0", 0.445], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["3.0", 0.155], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["0.0", 0.0], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["1.0", 0.0], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["2.0", 0.0], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["3.0", 0.0], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "#1f77b4", "coordinateSystem": "cartesian2d", "showBackground": true, "backgroundStyle": {"color": "rgba(180, 180, 180, 0.2)"}, "barWidth": "90%", "barGap": "0", "barCategoryGap": "20%", "largeThreshold": 400, "progressive": 5000, "progressiveThreshold": 3000, "progressiveChunkMode": "mod", "orient": "vertical", "x_value": ["0.0", "1.0", "2.0", "3.0", "0.0", "1.0", "2.0", "3.0", "0.0", "1.0", "2.0", "3.0"], "tooltip_type": "axis", "hist": false, "data_value": [["0.0", "0.01"], ["1.0", "0.357"], ["2.0", "0.468"], ["3.0", "0.165"], ["0.0", "0.009"], ["1.0", "0.391"], ["2.0", "0.445"], ["3.0", "0.155"], ["0.0", "0.0"], ["1.0", "0.0"], ["2.0", "0.0"], ["3.0", "0.0"]]}], "visualMap": null, "toolbox": {"show": true, "orient": "horizontal", "itemSize": 15, "itemGap": 8, "showTitle": true, "feature": {"dataZoom": {}, "saveAsImage": {}}, "z": 2, "left": "auto", "top": "auto", "right": "1%", "bottom": "auto", "width": "auto", "height": "auto", "popup": true, "changed_name_key": {"id_": "id"}}, "tooltip": {"show": true, "custom_tooltip": false, "trigger": "item", "axisPointer": {"show": true}, "showContent": true, "triggerOn": "mousemove|click", "hideDelay": 100, "enterable": true, "renderMode": "html", "confine": true, "transitionDuration": 0.4, "precision": 4, "borderColor": "#333", "padding": 5, "order": "seriesAsc"}, "dataZoom": null, "event": null, "graphic": null, "radar": null, "figsize": {"width": 600, "height": 600}, "color": ["#1f77b4", "#aec7e8", "#ff7f0e", "#ffbb78", "#2ca02c", "#98df8a", "#d62728", "#ff9896", "#9467bd", "#c5b0d5", "#8c564b", "#c49c94", "#e377c2", "#f7b6d2", "#7f7f7f", "#c7c7c7", "#bcbd22", "#dbdb8d", "#17becf", "#9edae5"], "save_img": false, "auto_size": true, "style": {"overflow": "auto"}, "port": "5006"};function setInnerHTML(elm, html) {
      elm.innerHTML = html;
  
      Array.from(elm.querySelectorAll("script"))
        .forEach( oldScriptEl => {
          const newScriptEl = document.createElement("script");
      
          Array.from(oldScriptEl.attributes).forEach( attr => {
            newScriptEl.setAttribute(attr.name, attr.value) 
          });
      
          const scriptText = document.createTextNode(oldScriptEl.innerHTML);
          newScriptEl.appendChild(scriptText);
      
          oldScriptEl.parentNode.replaceChild(newScriptEl, oldScriptEl);
      });
    };

    function getScreenSize(option) {
      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_result_save', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'height': screen.height, 'width': screen.width},
                                  'event_id': 'screen_size'})
          });
          fetch(testRequest).then(response => {});
      return 
    }
    function support_scientific_notation(option) {
      if (Array.isArray(option['yAxis'])) {
        for (var tar_ind = 0; tar_ind < option['yAxis'].length; tar_ind++) {
          if (option['yAxis'][tar_ind]['type'] === 'value') {
            option['yAxis'][tar_ind]['axisLabel']['formatter'] = function(val) {
              const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                        '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                        '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
              function toSuperscript(val) {
                if (val.toString().length > 5 && !val.toString().includes('.')) {
                  val = Number(val).toExponential().toString();
                  if (val.includes('-')) {
                    val = val.split('-');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁻' + val1
                  }
                  else if (val.includes('+')) {
                    val = val.split('+');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁺' + val1
                  }
                }
                else {
                  return val
                }
              }
              return toSuperscript(val)
            }
          }
        }
      }
      else {
        if (option['yAxis']['type'] === 'value') {
          option['yAxis']['axisLabel']['formatter'] = function(val) {
            const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                    '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                    '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
            function toSuperscript(val) {
              if (val.toString().length > 5 && !val.toString().includes('.')) {
                val = Number(val).toExponential().toString();
                if (val.includes('-')) {
                  val = val.split('-');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁻' + val1
                }
                else if (val.includes('+')) {
                  val = val.split('+');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁺' + val1
                }
              }
              else {
                return val
              }
            }
            return toSuperscript(val)
          }
        }
      };
      return option;
    };

    function auto_component_size(option) {
      if (typeof option['figsize']['width'] === 'string' || option['figsize']['width'] instanceof String) {
        if (option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['width'].includes('px')) {
          var width = parseFloat(option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = option['figsize']['width']
      }

      if (typeof option['figsize']['height'] === 'string' || option['figsize']['height'] instanceof String) {
        if (option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['height'].includes('px')) {
          var height = parseFloat(option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height']
      }

      var relative_ratio = Math.min(width / 700, height / 400)
      if ('xAxis3D' in option) {
        var keys = ['xAxis3D', 'yAxis3D', 'zAxis3D']
      }
      else {
        var keys = ['xAxis', 'yAxis']
      }
      for (single_key of keys) {
        for (var ind = 0; ind < option[single_key].length; ind++) {
          option[single_key][ind]['nameTextStyle']['fontSize'] = Math.max(7, option[single_key][ind]['nameTextStyle']['fontSize'] * relative_ratio);
          option[single_key][ind]['axisLabel']['fontSize'] = Math.max(7, option[single_key][ind]['axisLabel']['fontSize'] * relative_ratio);
        }
      }
      if (option['series']) {
        for (var ind = 0; ind < option['series'].length; ind++) {
          if (['heatmap', 'bar'].includes(option['series'][ind]['type'])) {
            if (option['series'][ind]['label']) {
              option['series'][ind]['label']['fontSize'] = Math.max(7, option['series'][ind]['label']['fontSize'] * relative_ratio);
            }
          }
        }
      }
      if (option['title']) {
        if (Array.isArray(option['title'])) {
          for (var ind = 0; ind < option['title'].length; ind++) {
            option['title'][ind]['textStyle']['fontSize'] = Math.max(9, option['title'][ind]['textStyle']['fontSize'] * relative_ratio);
          }
        }
        else {
          option['title']['textStyle']['fontSize'] = Math.max(9, option['title']['textStyle']['fontSize'] * relative_ratio);
        }
      }
      if (option['legend']) {
        option['legend']['itemHeight'] = option['legend']['itemHeight'] * relative_ratio;
        option['legend']['itemWidth'] = option['legend']['itemWidth'] * relative_ratio;
        option['legend']['textStyle']['fontSize'] = Math.max(7, option['legend']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['visualMap']) {
        option['visualMap']['itemHeight'] = option['visualMap']['itemHeight'] * relative_ratio;
        option['visualMap']['itemWidth'] = option['visualMap']['itemWidth'] * relative_ratio;
        option['visualMap']['textStyle']['fontSize'] = Math.max(7, option['visualMap']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['toolbox']) {
        option['toolbox']['itemSize'] = Math.max(8, option['toolbox']['itemSize'] * relative_ratio)
        option['toolbox']['itemGap'] = Math.max(4, option['toolbox']['itemGap'] * relative_ratio);
      }
      if (option['graphic']) {
        for (var ind = 0; ind < option['graphic'].length; ind++) {
          for (var ind2 = 0; ind2 < option['graphic'][ind]['children'].length; ind2++) {
            var new_font = Math.max(7, 12 * relative_ratio);
            option['graphic'][ind]['children'][ind2]['style']['font'] = new_font.toString() + 'px Microsoft YaHei';
          }
        }
      }
      return option;
    }

    function save_img(echarts_instance, option) {
      const base64_str = echarts_instance.getDataURL({
          pixelRatio: 2,
          backgroundColor: '#fff',
          width: option['figsize']['width'],
          height: option['figsize']['height']
      });

      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_image_save', {
        method: 'post',
        headers: {
          'Content-Type': 'application/json;charset=utf-8;',
          'Access-Control-Allow-Origin':'*',
          'Access-Control-Allow-Credentials': 'true',
          'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
        },
        body: JSON.stringify({'figname': option['figname'],
                              'base64_str': base64_str})
      });
      fetch(testRequest).then(response => {});
    };


    function auto_axis_namegap(echarts_instance, auto_axis_list, axis_type) {
      const globalModel = echarts_instance._api.getModel()
      const figsize = globalModel.option.figsize
      const ctx = document.createElement('canvas').getContext('2d')
      if (typeof globalModel.option['figsize']['width'] === 'string' || globalModel.option['figsize']['width'] instanceof String) {
        if (globalModel.option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(globalModel.option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['width'].includes('px')) {
          var width = parseFloat(globalModel.option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = globalModel.option['figsize']['width'];
      }

      if (typeof globalModel.option['figsize']['height'] === 'string' || globalModel.option['figsize']['height'] instanceof String) {
        if (globalModel.option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(globalModel.option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['height'].includes('px')) {
          var height = parseFloat(globalModel.option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height'];
      }
      var relative_ratio = Math.min(width / 700, height / 400);
      if (axis_type==='2d') {
        const yAxisList = globalModel.option.yAxis
        const xAxisList = globalModel.option.xAxis

        for (var axis_idx of auto_axis_list) {
          const yAxis = yAxisList[axis_idx]
          const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
          const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
          ctx.save()
          ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
  
          const yAxisComponent = globalModel.getComponent('yAxis', axis_idx)?.axis
          if (yAxis.type === 'value') {
            var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
          }
          else {
            var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
          }
          var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
          axisLabelMargin = axisLabelMargin * relative_ratio
          yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
          ctx.restore()
        };
  
        for (var axis_idx of [...Array(xAxisList.length).keys()]) {
          var new_gap = Math.max(xAxisList[axis_idx].nameGap * relative_ratio, 12);
          if (figsize['height'] < 400) {
            new_gap = Math.min(20, new_gap);
          }
          xAxisList[axis_idx].nameGap = new_gap;
        }
  
        echarts_instance.setOption({
          yAxis: yAxisList,
          xAxis: xAxisList
        })
      }
      else {
        const yAxisList = globalModel.option.yAxis3D
        const xAxisList = globalModel.option.xAxis3D
        const zAxisList = globalModel.option.zAxis3D

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < xAxisList.length) {
            const xAxis = xAxisList[axis_idx]
            const fontSize = xAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = xAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const xAxisComponent = globalModel.getComponent('xAxis3D', axis_idx)?.axis
            if (xAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = xAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            xAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < yAxisList.length) {
            const yAxis = yAxisList[axis_idx]
            const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const yAxisComponent = globalModel.getComponent('yAxis3D', axis_idx)?.axis
            if (yAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < zAxisList.length) {
            const zAxis = zAxisList[axis_idx]
            const fontSize = zAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = zAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const zAxisComponent = globalModel.getComponent('zAxis3D', axis_idx)?.axis
            if (zAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = zAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            zAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };
        echarts_instance.setOption({
          yAxis3D: yAxisList,
          xAxis3D: xAxisList,
          zAxis3D: zAxisList
        });
        }
  
    };

    function custom_scatter_size(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['symbolSize'] === 'array_size') {
          var ind_ = option['series'][ind]['data_dict']['size']
          option['series'][ind]['symbolSize'] = function (data) {return data[ind_];}
        }
      }
      return option;
  
    };

    function show_scatter_label(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['label'] === 'show_label') {
          var ind_ = option['series'][ind]['data_dict']['label']
          option['series'][ind]['label'] = {
            show: true,
            formatter: function (params) {return params.data.value[ind_]; }
          }
        }
      }
      return option;
    };

    function hide_min_max_axis_label(option) {
      for (var ind = 0; ind < option['xAxis3D'].length; ind++) {
        if (option['xAxis3D'][ind]['type'] == 'value') {
          var x_min = option['xAxis3D'][ind]['min']
          var x_max = option['xAxis3D'][ind]['max']
          option['xAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==x_min || value==x_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['yAxis3D'].length; ind++) {
        if (option['yAxis3D'][ind]['type'] == 'value') {  
          var y_min = option['yAxis3D'][ind]['min']
          var y_max = option['yAxis3D'][ind]['max']
          option['yAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==y_min || value==y_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['zAxis3D'].length; ind++) {
        if (option['zAxis3D'][ind]['type'] == 'value') {
          var z_min = option['zAxis3D'][ind]['min']
          var z_max = option['zAxis3D'][ind]['max']
          option['zAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==z_min || value==z_max){}
            else {return value}
          }
       }
      }
      return option;
    }

    function custom_axis_label(option) {
      if (Array.isArray(option['xAxis'])) {
        for (var ind = 0; ind < option['xAxis'].length; ind++) {
          if (option['xAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['xAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['xAxis'][ind]['axisLabel']['formatter_func'].body)
            option['xAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['xAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['xAxis']['axisLabel']['formatter_func'].arguments,
                               option['xAxis']['axisLabel']['formatter_func'].body)
          option['xAxis']['axisLabel']['formatter'] = f
        }
      }
      if (Array.isArray(option['yAxis'])) {
        for (var ind = 0; ind < option['yAxis'].length; ind++) {
          if (option['yAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['yAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['yAxis'][ind]['axisLabel']['formatter_func'].body)
            option['yAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['yAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['yAxis']['axisLabel']['formatter_func'].arguments,
                               option['yAxis']['axisLabel']['formatter_func'].body)
          option['yAxis']['axisLabel']['formatter'] = f
        }
      }
      return option;
    }

    function custom_tooltip(option, dimension=2) {

      if (dimension === 2) {
        var xaxis_key = 'xAxis'
        var yaxis_key = 'yAxis'
      }

      else if (dimension === 3) {
        var xaxis_key = 'xAxis3D'
        var yaxis_key = 'yAxis3D'
        var zaxis_key = 'zAxis3D'
      }

      if (option['radar']) {
        var radar_names = []
        for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
          radar_names.push(option['radar']['indicator'][ind_]['name']) 
        }
      }
  
  
      if (option[xaxis_key]['name'] !== null && option[xaxis_key]['name'] !== '' && Array.isArray(option[xaxis_key])!==true) {
        var xaxis_name = option[xaxis_key]['name'];
      }
      else {
        var xaxis_name = 'X';
      }

      if (option[yaxis_key]['name'] !== null && option[yaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
        var yaxis_name = option[yaxis_key]['name'];
      }
      else {
        var yaxis_name = 'Y';
      }

      if (typeof zaxis_key !== 'undefined') {
        if (option[zaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
          var zaxis_name = option[zaxis_key]['name'];
        }
        else {
          var zaxis_name = 'Z';
        }
      }
  
      if (option['tooltip']) {
        if (option['tooltip']['precision']) {
          var precision = option['tooltip']['precision']
          option['tooltip']['valueFormatter'] = (value) =>  Math.round(Number(value) * (10**precision)) / (10**precision)
        }

        for (var ind_ = 0; ind_ < option['series'].length; ind_++) {
          if (option['series'][ind_]['tooltip']) {
            if (option['series'][ind_]['tooltip']['precision']) {
              var precision = option['series'][ind_]['tooltip']['precision']
              const fix = precision_ => value => Math.round(Number(value) * (10**precision_)) / (10**precision_),
              fix_p = fix(precision);
              option['series'][ind_]['tooltip']['valueFormatter'] = function (value) {
                return fix_p(value)
              } 
            }
          }
        }

        if (option['series'].length === 1) {
          if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][0]['type'])) {
            option['tooltip']['formatter'] = function(params) {
              if (params.seriesName.includes('series')) {
                var series_name = ''
              }
          
              else {
                var series_name = params.seriesName + '<br>'
              }
      
              if (params.seriesType === 'scatter') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                  + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                  +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                }
            
              }
  
              else if (params.seriesType === 'heatmap') {
                formatter = params.name + ', ' + option['yAxis'][0]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
              }
      
              else if (params.seriesType === 'scatter3D') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                    + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                    +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                    +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                }
              }
          
              else if (params.seriesType === 'radar') {
                formatter = params.name  + '<br>';
                for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                  if (ind_ !== option['radar']['indicator'].length - 1) {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                  }
                  else {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                  }
                }
              }
            return formatter;
            }
          }
        }
        else {
          for (var out_ind_ = 0; out_ind_ < option['series'].length; out_ind_++) {
            if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][out_ind_]['type'])) {
              if (option['series'][out_ind_]['tooltip']) {
              }
              else {
                option['series'][out_ind_]['tooltip'] = {}
              }
              option['series'][out_ind_]['tooltip']['formatter'] = function(params) {
                if (params.seriesName.includes('series')) {
                  var series_name = ''
                }
            
                else {
                  var series_name = params.seriesName + '<br>'
                }
        
                if (params.seriesType === 'scatter') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                  }
                }
    
                else if (params.seriesType === 'heatmap') {
                  if ('data' in option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]) {
                    formatter = params.name + ', ' + option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
                  }
                  else {
                    formatter = Math.round(params.data[2] * 10000) / 10000
                  }
                
                }
        
                else if (params.seriesType === 'scatter3D') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                      +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                  }
                }
            
                else if (params.seriesType === 'radar') {
                  formatter = params.name  + '<br>';
                  for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                    if (ind_ !== option['radar']['indicator'].length - 1) {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                    }
                    else {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                    }
                  }
                }
              return formatter;
              }
            }
          }
        }
      }
      return option;
    };

    function support_brush_event(option) {
      if (option['event']['type_'] === 'brushselected') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var last_selected = [];
        bind_chart.on(option['event']['type_'], (params) => {
          var brushed = [];
          var brushComponent = params.batch[0];
          for (var sIdx = 0; sIdx < brushComponent.selected.length; sIdx++) {
            var rawIndices = brushComponent.selected[sIdx].dataIndex;
            brushed.push(rawIndices);
          }
          var brushed_all = brushed[0];

          if (JSON.stringify(last_selected) !== JSON.stringify(brushed_all)) {

            // Update memory
            let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
              method: 'post',
              headers: {
                  'Content-Type': 'application/json;charset=utf-8;',
                  'Access-Control-Allow-Origin':'*',
                  'Access-Control-Allow-Credentials': 'true',
                  'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
              },
              body: JSON.stringify({'js_func_input':{'selected': brushed_all},
                                    'event_id': option['event']['event_id']})
            });
            var dom_dict = {}
            fetch(testRequest).then(response => {
              var result = response.json();
              result.then(res => {
                dom_dict[res['link_id']] = document.getElementById(res['link_id']);
                setInnerHTML(dom_dict[res['link_id']], res['html']);
              });
            });
            last_selected = brushed_all;
          }
                            
        // bind_chart.setOption(option);
        })
      }
      return option;
    };

    function support_click_event(option) {
      if (option['event']['type_'] === 'click') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        if (option['series'][0]['orient'] === 'vertical') {
          var value_idx = 0
        }
        else {
          var value_idx = 1
        }
    

        bind_chart.on(option['event']['type_'], (params) => {
          if (option['event']['task'] === 'singleselect') {
            for (var ind_2 = 0; ind_2 < option['series'][0]['data'].length; ind_2++) {
              if (option['series'][0]['data'][ind_2]['itemStyle']['color'] !== '#1f77b4') {
                option['series'][0]['data'][ind_2]['itemStyle']['color'] = '#1f77b4';
              }
            }
            var idx = option['series'][0]['x_value'].indexOf(params.value[value_idx])
            option['series'][0]['data'][idx]['itemStyle']['color'] = '#ff7f0e';

            var selected = params.value[value_idx];
          }
          else {
            console.log(params);
          }
      
          let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'selected': selected},
                                  'event_id': option['event']['event_id']})
          });
          var dom_dict = {}
          fetch(testRequest).then(response => {
            var result = response.json();
            result.then(res => {
              dom_dict[res['link_id']] = document.getElementById(res['link_id']);
              setInnerHTML(dom_dict[res['link_id']], res['html']);
            });
          });
          bind_chart.setOption(option);
        });
      }
      return option;
    };function support_popup(option, height, width, inner_html) {
      option['toolbox']['feature']['myFeature'] = {
        show: true,
        title: 'Open in new window',
        icon: 'image://http://127.0.0.1:5001/resources/popup_icon',
        onclick: function (){
          var height_ = Math.min(screen.height, Math.round(1.5 * parseInt(height.slice(0,-2))))
          var width_ = Math.min(screen.width, Math.round(1.5 * parseInt(width.slice(0,-2))))
          var left = (screen.width/2)-(width_/2);
          var top = (screen.height/2)-(height_/2);
          var win = window.open('template.html', '_blank',
            `height=${height_}px, width=${width_}px, top=${top}px, left=${left}px`,
          );
          win.document.write(`${inner_html}`);
          win.document.close();
        }
      };
      return option;
    };option = support_popup(option=option, height="600px", width="600px", inner_html=`

            <html lang="en" style="height: 100%; text-align: -webkit-center; align-content: center">
            <title>MoCharts</title>
            <head> <meta charset="utf-8"> </head>
            <body style="height: 100%; margin: 0">
        
        
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"><\/script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts-gl/2.0.8/echarts-gl.min.js"><\/script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"><\/script>
                <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"><\/script>
            

            <div id="1737119431.5332484" style="height: 90%; width: 90%"></div>
            <script type="text/javascript">
                var dom = document.getElementById('1737119431.5332484');
                var myChart = echarts.init(dom, null, {
                    renderer: 'canvas',
                    useDirtyRect: false
                    });
                var app = {};

                var option;
            option = {"chart_id": "1737119431.5332484", "link_id": null, "figname": "", "title": {"show": true, "text": "Density Comparison (PSI = 0.0050)", "link": "", "target": "blank", "textStyle": {"fontStyle": "normal", "fontWeight": "bolder", "fontFamily": "sans-serif", "fontSize": 15, "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "subtext": "", "sublink": "", "subtarget": "blank", "textAlign": "center", "textVerticalAlign": "auto", "padding": 0, "itemGap": 10, "z": 2, "left": "45.0%", "top": "5%", "right": "auto", "bottom": "auto", "backgroundColor": "transparent", "borderColor": "#ccc", "changed_name_key": {"id_": "id"}}, "grid": {"show": true, "width": "auto", "height": "auto", "z": 2, "left": "5%", "top": "10%", "right": "20%", "bottom": "5%", "borderColor": "#ccc", "borderWidth": 1, "containLabel": true, "backgroundColor": "transparent", "changed_name_key": {"id_": "id"}}, "legend": {"show": true, "type": "plain", "width": "auto", "height": "auto", "orient": "vertical", "align": "auto", "itemWidth": 25, "itemHeight": 14, "symbolRotate": "inherit", "selectedMode": true, "padding": 5, "itemGap": 10, "z": 4, "left": "auto", "top": "10%", "right": "1%", "bottom": "auto", "borderColor": "#ccc", "borderWidth": 1, "inactiveColor": "#ccc", "inactiveBorderColor": "#ccc", "inactiveBorderWidth": "auto", "selected": {}, "textStyle": {"overflow": "truncate", "fontSize": 12}, "pageButtonItemGap": 5, "pageButtonPosition": "end", "pageFormatter": "{current}/{total}", "pageIconColor": "#2f4554", "pageIconInactiveColor": "#aaa", "pageIconSize": 15, "animationDurationUpdate": 800, "selectorItemGap": 7, "selectorButtonGap": 10}, "brush": null, "yAxis": [{"show": true, "type": "value", "position": "bottom", "name": "Percentage", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": "auto", "min": -0.1584, "max": 0.6214, "splitNumber": 5, "logBase": 10, "axisLine": {"show": false}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": 40.0}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "xAxis": [{"show": true, "data": ["0.0", "1.0", "2.0", "3.0"], "type": "category", "position": "bottom", "name": "EDUCATION", "nameLocation": "center", "nameTextStyle": {"color": "black", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": 30, "splitNumber": 5, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": true, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "...", "width": null}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "2d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "parallelAxis": null, "series": [{"type": "bar", "name": "test", "colorBy": "series", "z": 2, "legendHoverLink": true, "stack": "", "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "label": {"show": false, "color": "black", "position": null, "fontSize": 12}, "itemStyle": {}, "seriesLayoutBy": "column", "data": [{"value": ["0.0", 0.01], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["1.0", 0.357], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["2.0", 0.468], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["3.0", 0.165], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["0.0", 0.009], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["1.0", 0.391], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["2.0", 0.445], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["3.0", 0.155], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["0.0", 0.0], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["1.0", 0.0], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["2.0", 0.0], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}, {"value": ["3.0", 0.0], "itemStyle": {"color": "#1f77b4"}, "visualMap": false}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "#1f77b4", "coordinateSystem": "cartesian2d", "showBackground": true, "backgroundStyle": {"color": "rgba(180, 180, 180, 0.2)"}, "barWidth": "90%", "barGap": "0", "barCategoryGap": "20%", "largeThreshold": 400, "progressive": 5000, "progressiveThreshold": 3000, "progressiveChunkMode": "mod", "orient": "vertical", "x_value": ["0.0", "1.0", "2.0", "3.0", "0.0", "1.0", "2.0", "3.0", "0.0", "1.0", "2.0", "3.0"], "tooltip_type": "axis", "hist": false, "data_value": [["0.0", "0.01"], ["1.0", "0.357"], ["2.0", "0.468"], ["3.0", "0.165"], ["0.0", "0.009"], ["1.0", "0.391"], ["2.0", "0.445"], ["3.0", "0.155"], ["0.0", "0.0"], ["1.0", "0.0"], ["2.0", "0.0"], ["3.0", "0.0"]]}], "visualMap": null, "toolbox": {"show": true, "orient": "horizontal", "itemSize": 15, "itemGap": 8, "showTitle": true, "feature": {"dataZoom": {}, "saveAsImage": {}}, "z": 2, "left": "auto", "top": "auto", "right": "1%", "bottom": "auto", "width": "auto", "height": "auto", "popup": true, "changed_name_key": {"id_": "id"}}, "tooltip": {"show": true, "custom_tooltip": false, "trigger": "item", "axisPointer": {"show": true}, "showContent": true, "triggerOn": "mousemove|click", "hideDelay": 100, "enterable": true, "renderMode": "html", "confine": true, "transitionDuration": 0.4, "precision": 4, "borderColor": "#333", "padding": 5, "order": "seriesAsc"}, "dataZoom": null, "event": null, "graphic": null, "radar": null, "figsize": {"width": 600, "height": 600}, "color": ["#1f77b4", "#aec7e8", "#ff7f0e", "#ffbb78", "#2ca02c", "#98df8a", "#d62728", "#ff9896", "#9467bd", "#c5b0d5", "#8c564b", "#c49c94", "#e377c2", "#f7b6d2", "#7f7f7f", "#c7c7c7", "#bcbd22", "#dbdb8d", "#17becf", "#9edae5"], "save_img": false, "auto_size": true, "style": {"overflow": "auto"}, "port": "5006"};function setInnerHTML(elm, html) {
      elm.innerHTML = html;
  
      Array.from(elm.querySelectorAll("script"))
        .forEach( oldScriptEl => {
          const newScriptEl = document.createElement("script");
      
          Array.from(oldScriptEl.attributes).forEach( attr => {
            newScriptEl.setAttribute(attr.name, attr.value) 
          });
      
          const scriptText = document.createTextNode(oldScriptEl.innerHTML);
          newScriptEl.appendChild(scriptText);
      
          oldScriptEl.parentNode.replaceChild(newScriptEl, oldScriptEl);
      });
    };

    function getScreenSize(option) {
      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_result_save', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'height': screen.height, 'width': screen.width},
                                  'event_id': 'screen_size'})
          });
          fetch(testRequest).then(response => {});
      return 
    }
    function support_scientific_notation(option) {
      if (Array.isArray(option['yAxis'])) {
        for (var tar_ind = 0; tar_ind < option['yAxis'].length; tar_ind++) {
          if (option['yAxis'][tar_ind]['type'] === 'value') {
            option['yAxis'][tar_ind]['axisLabel']['formatter'] = function(val) {
              const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                        '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                        '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
              function toSuperscript(val) {
                if (val.toString().length > 5 && !val.toString().includes('.')) {
                  val = Number(val).toExponential().toString();
                  if (val.includes('-')) {
                    val = val.split('-');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁻' + val1
                  }
                  else if (val.includes('+')) {
                    val = val.split('+');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁺' + val1
                  }
                }
                else {
                  return val
                }
              }
              return toSuperscript(val)
            }
          }
        }
      }
      else {
        if (option['yAxis']['type'] === 'value') {
          option['yAxis']['axisLabel']['formatter'] = function(val) {
            const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                    '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                    '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
            function toSuperscript(val) {
              if (val.toString().length > 5 && !val.toString().includes('.')) {
                val = Number(val).toExponential().toString();
                if (val.includes('-')) {
                  val = val.split('-');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁻' + val1
                }
                else if (val.includes('+')) {
                  val = val.split('+');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁺' + val1
                }
              }
              else {
                return val
              }
            }
            return toSuperscript(val)
          }
        }
      };
      return option;
    };

    function auto_component_size(option) {
      if (typeof option['figsize']['width'] === 'string' || option['figsize']['width'] instanceof String) {
        if (option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['width'].includes('px')) {
          var width = parseFloat(option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = option['figsize']['width']
      }

      if (typeof option['figsize']['height'] === 'string' || option['figsize']['height'] instanceof String) {
        if (option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['height'].includes('px')) {
          var height = parseFloat(option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height']
      }

      var relative_ratio = Math.min(width / 700, height / 400)
      if ('xAxis3D' in option) {
        var keys = ['xAxis3D', 'yAxis3D', 'zAxis3D']
      }
      else {
        var keys = ['xAxis', 'yAxis']
      }
      for (single_key of keys) {
        for (var ind = 0; ind < option[single_key].length; ind++) {
          option[single_key][ind]['nameTextStyle']['fontSize'] = Math.max(7, option[single_key][ind]['nameTextStyle']['fontSize'] * relative_ratio);
          option[single_key][ind]['axisLabel']['fontSize'] = Math.max(7, option[single_key][ind]['axisLabel']['fontSize'] * relative_ratio);
        }
      }
      if (option['series']) {
        for (var ind = 0; ind < option['series'].length; ind++) {
          if (['heatmap', 'bar'].includes(option['series'][ind]['type'])) {
            if (option['series'][ind]['label']) {
              option['series'][ind]['label']['fontSize'] = Math.max(7, option['series'][ind]['label']['fontSize'] * relative_ratio);
            }
          }
        }
      }
      if (option['title']) {
        if (Array.isArray(option['title'])) {
          for (var ind = 0; ind < option['title'].length; ind++) {
            option['title'][ind]['textStyle']['fontSize'] = Math.max(9, option['title'][ind]['textStyle']['fontSize'] * relative_ratio);
          }
        }
        else {
          option['title']['textStyle']['fontSize'] = Math.max(9, option['title']['textStyle']['fontSize'] * relative_ratio);
        }
      }
      if (option['legend']) {
        option['legend']['itemHeight'] = option['legend']['itemHeight'] * relative_ratio;
        option['legend']['itemWidth'] = option['legend']['itemWidth'] * relative_ratio;
        option['legend']['textStyle']['fontSize'] = Math.max(7, option['legend']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['visualMap']) {
        option['visualMap']['itemHeight'] = option['visualMap']['itemHeight'] * relative_ratio;
        option['visualMap']['itemWidth'] = option['visualMap']['itemWidth'] * relative_ratio;
        option['visualMap']['textStyle']['fontSize'] = Math.max(7, option['visualMap']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['toolbox']) {
        option['toolbox']['itemSize'] = Math.max(8, option['toolbox']['itemSize'] * relative_ratio)
        option['toolbox']['itemGap'] = Math.max(4, option['toolbox']['itemGap'] * relative_ratio);
      }
      if (option['graphic']) {
        for (var ind = 0; ind < option['graphic'].length; ind++) {
          for (var ind2 = 0; ind2 < option['graphic'][ind]['children'].length; ind2++) {
            var new_font = Math.max(7, 12 * relative_ratio);
            option['graphic'][ind]['children'][ind2]['style']['font'] = new_font.toString() + 'px Microsoft YaHei';
          }
        }
      }
      return option;
    }

    function save_img(echarts_instance, option) {
      const base64_str = echarts_instance.getDataURL({
          pixelRatio: 2,
          backgroundColor: '#fff',
          width: option['figsize']['width'],
          height: option['figsize']['height']
      });

      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_image_save', {
        method: 'post',
        headers: {
          'Content-Type': 'application/json;charset=utf-8;',
          'Access-Control-Allow-Origin':'*',
          'Access-Control-Allow-Credentials': 'true',
          'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
        },
        body: JSON.stringify({'figname': option['figname'],
                              'base64_str': base64_str})
      });
      fetch(testRequest).then(response => {});
    };


    function auto_axis_namegap(echarts_instance, auto_axis_list, axis_type) {
      const globalModel = echarts_instance._api.getModel()
      const figsize = globalModel.option.figsize
      const ctx = document.createElement('canvas').getContext('2d')
      if (typeof globalModel.option['figsize']['width'] === 'string' || globalModel.option['figsize']['width'] instanceof String) {
        if (globalModel.option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(globalModel.option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['width'].includes('px')) {
          var width = parseFloat(globalModel.option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = globalModel.option['figsize']['width'];
      }

      if (typeof globalModel.option['figsize']['height'] === 'string' || globalModel.option['figsize']['height'] instanceof String) {
        if (globalModel.option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(globalModel.option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['height'].includes('px')) {
          var height = parseFloat(globalModel.option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height'];
      }
      var relative_ratio = Math.min(width / 700, height / 400);
      if (axis_type==='2d') {
        const yAxisList = globalModel.option.yAxis
        const xAxisList = globalModel.option.xAxis

        for (var axis_idx of auto_axis_list) {
          const yAxis = yAxisList[axis_idx]
          const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
          const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
          ctx.save()
          ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
  
          const yAxisComponent = globalModel.getComponent('yAxis', axis_idx)?.axis
          if (yAxis.type === 'value') {
            var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
          }
          else {
            var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
          }
          var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
          axisLabelMargin = axisLabelMargin * relative_ratio
          yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
          ctx.restore()
        };
  
        for (var axis_idx of [...Array(xAxisList.length).keys()]) {
          var new_gap = Math.max(xAxisList[axis_idx].nameGap * relative_ratio, 12);
          if (figsize['height'] < 400) {
            new_gap = Math.min(20, new_gap);
          }
          xAxisList[axis_idx].nameGap = new_gap;
        }
  
        echarts_instance.setOption({
          yAxis: yAxisList,
          xAxis: xAxisList
        })
      }
      else {
        const yAxisList = globalModel.option.yAxis3D
        const xAxisList = globalModel.option.xAxis3D
        const zAxisList = globalModel.option.zAxis3D

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < xAxisList.length) {
            const xAxis = xAxisList[axis_idx]
            const fontSize = xAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = xAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const xAxisComponent = globalModel.getComponent('xAxis3D', axis_idx)?.axis
            if (xAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = xAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            xAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < yAxisList.length) {
            const yAxis = yAxisList[axis_idx]
            const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const yAxisComponent = globalModel.getComponent('yAxis3D', axis_idx)?.axis
            if (yAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < zAxisList.length) {
            const zAxis = zAxisList[axis_idx]
            const fontSize = zAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = zAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const zAxisComponent = globalModel.getComponent('zAxis3D', axis_idx)?.axis
            if (zAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = zAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            zAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };
        echarts_instance.setOption({
          yAxis3D: yAxisList,
          xAxis3D: xAxisList,
          zAxis3D: zAxisList
        });
        }
  
    };

    function custom_scatter_size(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['symbolSize'] === 'array_size') {
          var ind_ = option['series'][ind]['data_dict']['size']
          option['series'][ind]['symbolSize'] = function (data) {return data[ind_];}
        }
      }
      return option;
  
    };

    function show_scatter_label(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['label'] === 'show_label') {
          var ind_ = option['series'][ind]['data_dict']['label']
          option['series'][ind]['label'] = {
            show: true,
            formatter: function (params) {return params.data.value[ind_]; }
          }
        }
      }
      return option;
    };

    function hide_min_max_axis_label(option) {
      for (var ind = 0; ind < option['xAxis3D'].length; ind++) {
        if (option['xAxis3D'][ind]['type'] == 'value') {
          var x_min = option['xAxis3D'][ind]['min']
          var x_max = option['xAxis3D'][ind]['max']
          option['xAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==x_min || value==x_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['yAxis3D'].length; ind++) {
        if (option['yAxis3D'][ind]['type'] == 'value') {  
          var y_min = option['yAxis3D'][ind]['min']
          var y_max = option['yAxis3D'][ind]['max']
          option['yAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==y_min || value==y_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['zAxis3D'].length; ind++) {
        if (option['zAxis3D'][ind]['type'] == 'value') {
          var z_min = option['zAxis3D'][ind]['min']
          var z_max = option['zAxis3D'][ind]['max']
          option['zAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==z_min || value==z_max){}
            else {return value}
          }
       }
      }
      return option;
    }

    function custom_axis_label(option) {
      if (Array.isArray(option['xAxis'])) {
        for (var ind = 0; ind < option['xAxis'].length; ind++) {
          if (option['xAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['xAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['xAxis'][ind]['axisLabel']['formatter_func'].body)
            option['xAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['xAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['xAxis']['axisLabel']['formatter_func'].arguments,
                               option['xAxis']['axisLabel']['formatter_func'].body)
          option['xAxis']['axisLabel']['formatter'] = f
        }
      }
      if (Array.isArray(option['yAxis'])) {
        for (var ind = 0; ind < option['yAxis'].length; ind++) {
          if (option['yAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['yAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['yAxis'][ind]['axisLabel']['formatter_func'].body)
            option['yAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['yAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['yAxis']['axisLabel']['formatter_func'].arguments,
                               option['yAxis']['axisLabel']['formatter_func'].body)
          option['yAxis']['axisLabel']['formatter'] = f
        }
      }
      return option;
    }

    function custom_tooltip(option, dimension=2) {

      if (dimension === 2) {
        var xaxis_key = 'xAxis'
        var yaxis_key = 'yAxis'
      }

      else if (dimension === 3) {
        var xaxis_key = 'xAxis3D'
        var yaxis_key = 'yAxis3D'
        var zaxis_key = 'zAxis3D'
      }

      if (option['radar']) {
        var radar_names = []
        for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
          radar_names.push(option['radar']['indicator'][ind_]['name']) 
        }
      }
  
  
      if (option[xaxis_key]['name'] !== null && option[xaxis_key]['name'] !== '' && Array.isArray(option[xaxis_key])!==true) {
        var xaxis_name = option[xaxis_key]['name'];
      }
      else {
        var xaxis_name = 'X';
      }

      if (option[yaxis_key]['name'] !== null && option[yaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
        var yaxis_name = option[yaxis_key]['name'];
      }
      else {
        var yaxis_name = 'Y';
      }

      if (typeof zaxis_key !== 'undefined') {
        if (option[zaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
          var zaxis_name = option[zaxis_key]['name'];
        }
        else {
          var zaxis_name = 'Z';
        }
      }
  
      if (option['tooltip']) {
        if (option['tooltip']['precision']) {
          var precision = option['tooltip']['precision']
          option['tooltip']['valueFormatter'] = (value) =>  Math.round(Number(value) * (10**precision)) / (10**precision)
        }

        for (var ind_ = 0; ind_ < option['series'].length; ind_++) {
          if (option['series'][ind_]['tooltip']) {
            if (option['series'][ind_]['tooltip']['precision']) {
              var precision = option['series'][ind_]['tooltip']['precision']
              const fix = precision_ => value => Math.round(Number(value) * (10**precision_)) / (10**precision_),
              fix_p = fix(precision);
              option['series'][ind_]['tooltip']['valueFormatter'] = function (value) {
                return fix_p(value)
              } 
            }
          }
        }

        if (option['series'].length === 1) {
          if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][0]['type'])) {
            option['tooltip']['formatter'] = function(params) {
              if (params.seriesName.includes('series')) {
                var series_name = ''
              }
          
              else {
                var series_name = params.seriesName + '<br>'
              }
      
              if (params.seriesType === 'scatter') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                  + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                  +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                }
            
              }
  
              else if (params.seriesType === 'heatmap') {
                formatter = params.name + ', ' + option['yAxis'][0]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
              }
      
              else if (params.seriesType === 'scatter3D') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                    + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                    +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                    +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                }
              }
          
              else if (params.seriesType === 'radar') {
                formatter = params.name  + '<br>';
                for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                  if (ind_ !== option['radar']['indicator'].length - 1) {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                  }
                  else {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                  }
                }
              }
            return formatter;
            }
          }
        }
        else {
          for (var out_ind_ = 0; out_ind_ < option['series'].length; out_ind_++) {
            if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][out_ind_]['type'])) {
              if (option['series'][out_ind_]['tooltip']) {
              }
              else {
                option['series'][out_ind_]['tooltip'] = {}
              }
              option['series'][out_ind_]['tooltip']['formatter'] = function(params) {
                if (params.seriesName.includes('series')) {
                  var series_name = ''
                }
            
                else {
                  var series_name = params.seriesName + '<br>'
                }
        
                if (params.seriesType === 'scatter') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                  }
                }
    
                else if (params.seriesType === 'heatmap') {
                  if ('data' in option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]) {
                    formatter = params.name + ', ' + option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
                  }
                  else {
                    formatter = Math.round(params.data[2] * 10000) / 10000
                  }
                
                }
        
                else if (params.seriesType === 'scatter3D') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                      +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                  }
                }
            
                else if (params.seriesType === 'radar') {
                  formatter = params.name  + '<br>';
                  for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                    if (ind_ !== option['radar']['indicator'].length - 1) {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                    }
                    else {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                    }
                  }
                }
              return formatter;
              }
            }
          }
        }
      }
      return option;
    };

    function support_brush_event(option) {
      if (option['event']['type_'] === 'brushselected') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var last_selected = [];
        bind_chart.on(option['event']['type_'], (params) => {
          var brushed = [];
          var brushComponent = params.batch[0];
          for (var sIdx = 0; sIdx < brushComponent.selected.length; sIdx++) {
            var rawIndices = brushComponent.selected[sIdx].dataIndex;
            brushed.push(rawIndices);
          }
          var brushed_all = brushed[0];

          if (JSON.stringify(last_selected) !== JSON.stringify(brushed_all)) {

            // Update memory
            let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
              method: 'post',
              headers: {
                  'Content-Type': 'application/json;charset=utf-8;',
                  'Access-Control-Allow-Origin':'*',
                  'Access-Control-Allow-Credentials': 'true',
                  'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
              },
              body: JSON.stringify({'js_func_input':{'selected': brushed_all},
                                    'event_id': option['event']['event_id']})
            });
            var dom_dict = {}
            fetch(testRequest).then(response => {
              var result = response.json();
              result.then(res => {
                dom_dict[res['link_id']] = document.getElementById(res['link_id']);
                setInnerHTML(dom_dict[res['link_id']], res['html']);
              });
            });
            last_selected = brushed_all;
          }
                            
        // bind_chart.setOption(option);
        })
      }
      return option;
    };

    function support_click_event(option) {
      if (option['event']['type_'] === 'click') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        if (option['series'][0]['orient'] === 'vertical') {
          var value_idx = 0
        }
        else {
          var value_idx = 1
        }
    

        bind_chart.on(option['event']['type_'], (params) => {
          if (option['event']['task'] === 'singleselect') {
            for (var ind_2 = 0; ind_2 < option['series'][0]['data'].length; ind_2++) {
              if (option['series'][0]['data'][ind_2]['itemStyle']['color'] !== '#1f77b4') {
                option['series'][0]['data'][ind_2]['itemStyle']['color'] = '#1f77b4';
              }
            }
            var idx = option['series'][0]['x_value'].indexOf(params.value[value_idx])
            option['series'][0]['data'][idx]['itemStyle']['color'] = '#ff7f0e';

            var selected = params.value[value_idx];
          }
          else {
            console.log(params);
          }
      
          let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'selected': selected},
                                  'event_id': option['event']['event_id']})
          });
          var dom_dict = {}
          fetch(testRequest).then(response => {
            var result = response.json();
            result.then(res => {
              dom_dict[res['link_id']] = document.getElementById(res['link_id']);
              setInnerHTML(dom_dict[res['link_id']], res['html']);
            });
          });
          bind_chart.setOption(option);
        });
      }
      return option;
    };option = support_scientific_notation(option=option);option = custom_tooltip(option=option, dimension=2);option = custom_axis_label(option=option);option = auto_component_size(option=option);getScreenSize(option=option);

                myChart.setOption(option);
                window.addEventListener('resize', function () {
                    myChart.resize();
                    var option_copy = JSON.parse(JSON.stringify(option));
                    option_copy['figsize']['height'] = myChart.getHeight();
                    option_copy['figsize']['width'] = myChart.getWidth();
                    // option_copy = auto_component_size(option_copy);
                    myChart.setOption(option_copy);
                });
            <\/script>
            </body>
            </html>
        <style>
    .dg.main.taller-than-window .close-button {
        border-top: 1px solid #ddd;
    }

    .dg.main .close-button {
        background-color: #e8e8e8;
    }
 
    .dg.main .close-button:hover {
        background-color: #ddd;
    }

    .dg {
        color: #555;
        text-shadow: none !important;
    }

    .dg.main::-webkit-scrollbar {
        background: #fafafa;
    }

    .dg.main::-webkit-scrollbar-thumb {
        background: #bbb;
    }
 
    .dg li:not(.folder) {
        background: #fafafa;
        border-bottom: 1px solid #ddd;
    }
 
    .dg li.save-row .button {
        text-shadow: none !important;
    }

    .dg li.title {
        background: #e8e8e8 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;
    }

    .dg .cr.function:hover,.dg .cr.boolean:hover {
        background: #fff;
    }
 
    .dg .c input[type=text] {
        background: #e9e9e9;
    }
 
    .dg .c input[type=text]:hover {
        background: #eee;
    }
 
    .dg .c input[type=text]:focus {
        background: #eee;
        color: #555;
    }
 
    .dg .c .slider {
        background: #e9e9e9;
    }

    .dg .c .slider:hover {
        background: #eee;
    }<\/style>`);option = support_scientific_notation(option=option);option = custom_tooltip(option=option, dimension=2);option = custom_axis_label(option=option);option = auto_component_size(option=option);getScreenSize(option=option);

                if (option && typeof option === 'object') {
                    myChart.setOption(option);
                    }

                auto_axis_namegap(echarts_instance=myChart, auto_axis_list=[0], axis_type="2d");

            </script>
            </body>
            </html>
    
    </div>
    <br />
    <br />


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 18.358 seconds)


.. _sphx_glr_download__source_auto_galleries_data_plot_5_drift_test.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_5_drift_test.ipynb <plot_5_drift_test.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_5_drift_test.py <plot_5_drift_test.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_5_drift_test.zip <plot_5_drift_test.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
